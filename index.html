<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDGs „Ç∞„É≠„Éº„Éê„É´„Éü„ÉÉ„Ç∑„Éß„É≥</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            overflow: hidden;
            touch-action: none;
        }
        .game-container {
            display: grid;
            grid-template-rows: 80px 1fr 120px;
            height: 100vh;
            gap: 10px;
            padding: 10px;
        }
        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        .city-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .city-flag {
            font-size: 32px;
        }
        .city-details h2 {
            color: #2c3e50;
            margin-bottom: 4px;
        }
        .city-details .mission {
            font-size: 14px;
            color: #7f8c8d;
        }
        .resources {
            display: flex;
            gap: 20px;
        }
        .resource {
            text-align: center;
        }
        .resource-value {
            font-size: 20px;
            font-weight: bold;
            color: #2c3e50;
        }
        .resource-label {
            font-size: 12px;
            color: #7f8c8d;
        }
        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            gap: 15px;
        }
        .panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            overflow-y: auto;
        }
        .city-view {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
        }
        #city3d {
            width: 100%;
            height: 100%;
        }
        .construction-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        .building-option {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .building-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(116, 185, 255, 0.4);
        }
        .building-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }
        .tech-tree {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
        }
        .tech-level {
            margin-bottom: 15px;
        }
        .tech-items {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .tech-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 12px;
            border-radius: 10px;
            font-size: 12px;
        }
        .event-log {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
        }
        .event-item {
            padding: 8px;
            margin: 5px 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            font-size: 12px;
        }
        .control-bar {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        .control-button {
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        .control-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 184, 148, 0.4);
        }
        .turn-info {
            text-align: center;
        }
        .turn-number {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        .progress-container {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 8px;
            margin: 10px 0;
        }
        .progress-bar {
            height: 8px;
            background: linear-gradient(90deg, #00b894, #fdcb6e, #e17055);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        .sdgs-badge {
            display: inline-block;
            background: #FFD700;
            color: #000;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
            margin: 2px;
        }
        .floating-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
            padding: 15px 20px;
            border-radius: 15px;
            z-index: 1000;
            animation: slideInRight 0.5s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .construction-effect {
            position: absolute;
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, #FFD700 20%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            z-index: 100;
            animation: constructPulse 1s ease-out;
        }
        @keyframes constructPulse {
            0% { transform: scale(0.8); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- „Éò„ÉÉ„ÉÄ„Éº: ÈÉΩÂ∏ÇÊÉÖÂ†±„Å®Ë≥áÊ∫ê -->
        <div class="header">
            <div class="city-info">
                <div class="city-flag">üáØüáµ</div>
                <div class="city-details">
                    <h2>Êù±‰∫¨„Éü„ÉÉ„Ç∑„Éß„É≥</h2>
                    <div class="mission">„Ç´„Éº„Éú„É≥„Éã„É•„Éº„Éà„É©„É´2030 - CO2ÊéíÂá∫Èáè70%ÂâäÊ∏õ</div>
                </div>
            </div>
            <div class="resources">
                <div class="resource">
                    <div class="resource-value" id="budget">2,500,000</div>
                    <div class="resource-label">‰∫àÁÆó</div>
                </div>
                <div class="resource">
                    <div class="resource-value" id="energy">78%</div>
                    <div class="resource-label">„Ç®„Éç„É´„ÇÆ„Éº</div>
                </div>
                <div class="resource">
                    <div class="resource-value" id="environment">65%</div>
                    <div class="resource-label">Áí∞Â¢É</div>
                </div>
                <div class="resource">
                    <div class="resource-value" id="water">85%</div>
                    <div class="resource-label">Ê∞¥Ë≥áÊ∫ê</div>
                </div>
            </div>
        </div>

        <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
        <div class="main-content">
            <!-- Â∑¶„Éë„Éç„É´: Âª∫Ë®≠„É°„Éã„É•„Éº -->
            <div class="panel">
                <h3 style="color: #2c3e50; margin-bottom: 20px;">üèóÔ∏è ÊñΩË®≠Âª∫Ë®≠</h3>
                
                <div class="construction-grid">
                    <div class="building-option" onclick="constructBuilding('residential')">
                        <div class="building-icon">üè†</div>
                        <div>‰ΩèÂÆÖ</div>
                        <div style="font-size: 10px; opacity: 0.8;">‰∫∫Âè£+1000</div>
                    </div>
                    <div class="building-option" onclick="constructBuilding('commercial')">
                        <div class="building-icon">üè™</div>
                        <div>ÂïÜÊ•≠</div>
                        <div style="font-size: 10px; opacity: 0.8;">ÂèéÂÖ•+5000</div>
                    </div>
                    <div class="building-option" onclick="constructBuilding('solar')">
                        <div class="building-icon">‚òÄÔ∏è</div>
                        <div>Â§™ÈôΩÂÖâ</div>
                        <div style="font-size: 10px; opacity: 0.8;">„Ç®„Éç„É´„ÇÆ„Éº+15%</div>
                    </div>
                    <div class="building-option" onclick="constructBuilding('wind')">
                        <div class="building-icon">üå¨Ô∏è</div>
                        <div>È¢®Âäõ</div>
                        <div style="font-size: 10px; opacity: 0.8;">„Ç®„Éç„É´„ÇÆ„Éº+20%</div>
                    </div>
                    <div class="building-option" onclick="constructBuilding('park')">
                        <div class="building-icon">üå≥</div>
                        <div>ÂÖ¨Âúí</div>
                        <div style="font-size: 10px; opacity: 0.8;">Áí∞Â¢É+10%</div>
                    </div>
                    <div class="building-option" onclick="constructBuilding('water_plant')">
                        <div class="building-icon">üíß</div>
                        <div>ÊµÑÊ∞¥Â†¥</div>
                        <div style="font-size: 10px; opacity: 0.8;">Ê∞¥Ë≥áÊ∫ê+25%</div>
                    </div>
                    <div class="building-option" onclick="constructBuilding('recycling')">
                        <div class="building-icon">‚ôªÔ∏è</div>
                        <div>„É™„Çµ„Ç§„ÇØ„É´</div>
                        <div style="font-size: 10px; opacity: 0.8;">ÂªÉÊ£ÑÁâ©-15%</div>
                    </div>
                    <div class="building-option" onclick="constructBuilding('research')">
                        <div class="building-icon">üî¨</div>
                        <div>Á†îÁ©∂ÊâÄ</div>
                        <div style="font-size: 10px; opacity: 0.8;">ÊäÄË°ì+10%</div>
                    </div>
                </div>

                <div class="tech-tree">
                    <h4 style="color: #2c3e50; margin-bottom: 15px;">üîß ÊäÄË°ì„ÉÑ„É™„Éº</h4>
                    <div class="tech-level">
                        <div style="font-size: 12px; margin-bottom: 8px; color: #7f8c8d;">„É¨„Éô„É´1</div>
                        <div class="tech-items">
                            <div class="tech-item">ÁúÅ„Ç®„ÉçÂÆ∂Èõª</div>
                            <div class="tech-item">Â§™ÈôΩÂÖâÁô∫Èõª</div>
                            <div class="tech-item">„É™„Çµ„Ç§„ÇØ„É´</div>
                        </div>
                    </div>
                    <div class="tech-level">
                        <div style="font-size: 12px; margin-bottom: 8px; color: #7f8c8d;">„É¨„Éô„É´2</div>
                        <div class="tech-items">
                            <div class="tech-item" style="opacity: 0.5;">„Çπ„Éû„Éº„Éà„Ç∞„É™„ÉÉ„Éâ</div>
                            <div class="tech-item" style="opacity: 0.5;">Ê∞¥„É™„Çµ„Ç§„ÇØ„É´</div>
                            <div class="tech-item" style="opacity: 0.5;">ÈõªÊ∞óËá™ÂãïËªä</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ‰∏≠Â§Æ: 3DÈÉΩÂ∏Ç„Éì„É•„Éº -->
            <div class="city-view">
                <div id="city3d"></div>
                <div id="constructionEffects"></div>
            </div>

            <!-- Âè≥„Éë„Éç„É´: „Éü„ÉÉ„Ç∑„Éß„É≥„Å®„Ç§„Éô„É≥„Éà -->
            <div class="panel">
                <h3 style="color: #2c3e50; margin-bottom: 20px;">üéØ „Éü„ÉÉ„Ç∑„Éß„É≥ÈÄ≤Êçó</h3>
                
                <div class="progress-container">
                    <div style="display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 5px;">
                        <span>CO2ÂâäÊ∏õÁõÆÊ®ô</span>
                        <span>45% / 70%</span>
                    </div>
                    <div class="progress-bar" style="width: 64%"></div>
                </div>

                <div style="margin: 20px 0;">
                    <h4 style="color: #2c3e50; margin-bottom: 10px;">üèÜ SDGsÁõÆÊ®ô</h4>
                    <div>
                        <span class="sdgs-badge">7: „Ç®„Éç„É´„ÇÆ„Éº</span>
                        <span class="sdgs-badge">11: ÊåÅÁ∂öÂèØËÉΩ„Å™ÈÉΩÂ∏Ç</span>
                        <span class="sdgs-badge">13: Ê∞óÂÄôÂ§âÂãï</span>
                    </div>
                </div>

                <div class="event-log">
                    <h4 style="color: #2c3e50; margin-bottom: 10px;">üìù „Ç§„Éô„É≥„Éà„É≠„Ç∞</h4>
                    <div class="event-item">üè≠ Â∑•Ê•≠Âú∞Âå∫„ÇíÂª∫Ë®≠„Åó„Åæ„Åó„Åü</div>
                    <div class="event-item">‚òÄÔ∏è Â§™ÈôΩÂÖâÁô∫ÈõªÊâÄ„ÅåÂÆåÊàê</div>
                    <div class="event-item">üíß Ê∞¥ÈúÄË¶Å„Åå10%Â¢óÂä†</div>
                    <div class="event-item">üåø Áí∞Â¢ÉÊåáÊ®ô„ÅåÊîπÂñÑ„Åó„Åæ„Åó„Åü</div>
                </div>

                <div style="margin-top: 20px; padding: 15px; background: rgba(116, 185, 255, 0.1); border-radius: 10px;">
                    <h4 style="color: #2c3e50; margin-bottom: 8px;">üåç ÂõΩÈöõÊäÄË°ì</h4>
                    <div style="font-size: 12px; line-height: 1.4;">
                        „Éâ„Ç§„ÉÑ„ÅÆ„Ç®„Éç„É´„ÇÆ„ÉºËª¢ÊèõÊäÄË°ì„ÅåÂà©Áî®ÂèØËÉΩ
                        <span class="sdgs-badge" style="background: #74b9ff; margin-left: 5px;">Êñ∞ÁùÄ</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- „Ç≥„É≥„Éà„É≠„Éº„É´„Éê„Éº -->
        <div class="control-bar">
            <div class="turn-info">
                <div style="font-size: 14px; color: #7f8c8d;">„Çø„Éº„É≥</div>
                <div class="turn-number" id="turn">5</div>
            </div>
            <button class="control-button" onclick="nextTurn()">
                ‚è≠Ô∏è Ê¨°„ÅÆ„Çø„Éº„É≥„Å∏
            </button>
            <div style="text-align: right;">
                <div style="font-size: 14px; color: #7f8c8d;">‰∫∫Âè£</div>
                <div style="font-size: 20px; font-weight: bold; color: #2c3e50;" id="population">125,000</div>
            </div>
        </div>
    </div>

    <script>
        // =============================================
        // üéÆ „Ç≤„Éº„É†„Ç®„É≥„Ç∏„É≥ - ÂÆåÂÖ®ÂÆüË£Ö
        // =============================================

        class GlobalSDGsGame {
            constructor() {
                this.currentCity = 'tokyo';
                this.turn = 5;
                this.resources = {
                    budget: 2500000,
                    energy: 78,
                    environment: 65,
                    water: 85,
                    population: 125000
                };
                this.buildings = [];
                this.missions = {
                    tokyo: { target: 70, current: 45, name: 'CO2ÊéíÂá∫Èáè70%ÂâäÊ∏õ' }
                };
                this.events = [];
                this.init();
            }

            init() {
                this.loadCityData();
                this.updateUI();
            }

            loadCityData() {
                // ÈÉΩÂ∏Ç„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø
                const cities = {
                    tokyo: {
                        flag: 'üáØüáµ',
                        name: 'Êù±‰∫¨„Éü„ÉÉ„Ç∑„Éß„É≥',
                        mission: '„Ç´„Éº„Éú„É≥„Éã„É•„Éº„Éà„É©„É´2030 - CO2ÊéíÂá∫Èáè70%ÂâäÊ∏õ',
                        challenges: ['È´òÂØÜÂ∫¶ÈÉΩÂ∏Ç', 'ÂúüÂú∞‰∏çË∂≥', '„Ç®„Éç„É´„ÇÆ„ÉºÈúÄË¶ÅÂ§ß']
                    }
                };
                this.cityData = cities[this.currentCity];
            }

            constructBuilding(type) {
                const cost = this.getBuildingCost(type);
                if (this.resources.budget < cost) {
                    this.showNotification('‚ùå ‰∫àÁÆó„ÅåË∂≥„Çä„Åæ„Åõ„Çì');
                    return false;
                }

                this.resources.budget -= cost;
                this.applyBuildingEffects(type);
                
                const building = {
                    type,
                    turn: this.turn,
                    position: this.getRandomGridPosition()
                };
                this.buildings.push(building);

                this.addEvent(`üèóÔ∏è ${this.getBuildingName(type)}„ÇíÂª∫Ë®≠„Åó„Åæ„Åó„Åü`);
                this.showNotification(`‚úÖ ${this.getBuildingName(type)}„ÇíÂª∫Ë®≠„Åó„Åæ„Åó„Åü`);
                this.updateUI();
                return building;
            }

            getBuildingCost(type) {
                const costs = {
                    'residential': 100000,
                    'commercial': 150000,
                    'solar': 200000,
                    'wind': 250000,
                    'park': 50000,
                    'water_plant': 300000,
                    'recycling': 180000,
                    'research': 400000
                };
                return costs[type] || 0;
            }

            getBuildingName(type) {
                const names = {
                    'residential': '‰ΩèÂÆÖÂú∞Âå∫',
                    'commercial': 'ÂïÜÊ•≠Âú∞Âå∫',
                    'solar': 'Â§™ÈôΩÂÖâÁô∫ÈõªÊâÄ',
                    'wind': 'È¢®ÂäõÁô∫ÈõªÊâÄ',
                    'park': 'ÂÖ¨Âúí',
                    'water_plant': 'ÊµÑÊ∞¥Â†¥',
                    'recycling': '„É™„Çµ„Ç§„ÇØ„É´„Çª„É≥„Çø„Éº',
                    'research': 'Á†îÁ©∂ÊâÄ'
                };
                return names[type] || type;
            }

            applyBuildingEffects(type) {
                const effects = {
                    'residential': { population: 1000, budget: -5000 },
                    'commercial': { budget: 5000, energy: -5 },
                    'solar': { energy: 15, environment: 5 },
                    'wind': { energy: 20, environment: 8 },
                    'park': { environment: 10, budget: -2000 },
                    'water_plant': { water: 25, energy: -10 },
                    'recycling': { environment: 12, budget: 3000 },
                    'research': { budget: -8000 }
                };

                const effect = effects[type] || {};
                Object.keys(effect).forEach(key => {
                    if (this.resources[key] !== undefined) {
                        this.resources[key] += effect[key];
                        // ÂÄ§„ÇíÂà∂Èôê
                        if (key !== 'budget' && key !== 'population') {
                            this.resources[key] = Math.max(0, Math.min(100, this.resources[key]));
                        }
                    }
                });

                // „Éü„ÉÉ„Ç∑„Éß„É≥ÈÄ≤ÊçóÊõ¥Êñ∞
                if (type === 'solar' || type === 'wind' || type === 'recycling') {
                    this.missions.tokyo.current = Math.min(70, this.missions.tokyo.current + 2);
                }
            }

            getRandomGridPosition() {
                return {
                    x: Math.floor(Math.random() * 8),
                    z: Math.floor(Math.random() * 8)
                };
            }

            nextTurn() {
                this.turn++;
                
                // „Çø„Éº„É≥„Åî„Å®„ÅÆËá™ÁÑ∂„Å™Â§âÂåñ
                this.resources.energy = Math.max(0, this.resources.energy - 3);
                this.resources.water = Math.max(0, this.resources.water - 2);
                this.resources.population += Math.floor(this.resources.population * 0.02);
                this.resources.budget += Math.floor(this.resources.population * 0.8);
                
                // „É©„É≥„ÉÄ„É†„Ç§„Éô„É≥„Éà
                this.generateRandomEvent();
                
                this.addEvent(`üìä „Çø„Éº„É≥ ${this.turn} ÈñãÂßã - ‰∫∫Âè£Â¢óÂä†: ${Math.floor(this.resources.population * 0.02).toLocaleString()}‰∫∫`);
                this.showNotification(`üîÑ „Çø„Éº„É≥ ${this.turn} „ÅåÂßã„Åæ„Çä„Åæ„Åó„Åü`);
                this.updateUI();
            }

            generateRandomEvent() {
                const events = [
                    { message: "üå°Ô∏è ÁÜ±Ê≥¢Êù•Ë•≤ÔºÅ„Ç®„Éç„É´„ÇÆ„ÉºÈúÄË¶Å„Åå15%Â¢óÂä†", effect: { energy: -10 } },
                    { message: "üíß Ê∞¥‰∏çË∂≥Ë≠¶ÂëäÔºÅÁØÄÊ∞¥ÂØæÁ≠ñ„ÅåÂøÖË¶Å", effect: { water: -15 } },
                    { message: "üåø Áí∞Â¢ÉÊÑèË≠ò„ÅÆÈ´ò„Åæ„ÇäÔºÅÁí∞Â¢ÉÊåáÊ®ô„ÅåÊîπÂñÑ", effect: { environment: 8 } },
                    { message: "üí∞ ÁµåÊ∏àÊàêÈï∑ÔºÅ‰∫àÁÆóÂèéÂÖ•„ÅåÂ¢óÂä†", effect: { budget: 100000 } }
                ];
                
                const event = events[Math.floor(Math.random() * events.length)];
                this.addEvent(event.message);
                
                Object.keys(event.effect).forEach(key => {
                    if (this.resources[key] !== undefined) {
                        this.resources[key] += event.effect[key];
                    }
                });
            }

            addEvent(message) {
                this.events.unshift(message);
                if (this.events.length > 6) {
                    this.events.pop();
                }
            }

            showNotification(message) {
                const notification = document.createElement('div');
                notification.className = 'floating-notification';
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => notification.remove(), 3000);
            }

            showConstructionEffect(x, z) {
                const effectsContainer = document.getElementById('constructionEffects');
                const effect = document.createElement('div');
                effect.className = 'construction-effect';
                effect.style.left = `${12.5 + x * 12.5}%`;
                effect.style.top = `${12.5 + z * 12.5}%`;
                effectsContainer.appendChild(effect);
                
                setTimeout(() => effect.remove(), 1000);
            }

            updateUI() {
                // „É™„ÇΩ„Éº„ÇπÊõ¥Êñ∞
                document.getElementById('budget').textContent = this.resources.budget.toLocaleString();
                document.getElementById('energy').textContent = this.resources.energy + '%';
                document.getElementById('environment').textContent = this.resources.environment + '%';
                document.getElementById('water').textContent = this.resources.water + '%';
                document.getElementById('population').textContent = this.resources.population.toLocaleString();
                document.getElementById('turn').textContent = this.turn;
                
                // ÈÄ≤Êçó„Éê„ÉºÊõ¥Êñ∞
                const progress = (this.missions.tokyo.current / this.missions.tokyo.target) * 100;
                document.querySelector('.progress-bar').style.width = `${progress}%`;
                document.querySelector('.progress-container span:last-child').textContent = 
                    `${this.missions.tokyo.current}% / ${this.missions.tokyo.target}%`;
                
                // „Ç§„Éô„É≥„Éà„É≠„Ç∞Êõ¥Êñ∞
                const eventLog = document.querySelector('.event-log');
                eventLog.innerHTML = '<h4 style="color: #2c3e50; margin-bottom: 10px;">üìù „Ç§„Éô„É≥„Éà„É≠„Ç∞</h4>';
                this.events.forEach(event => {
                    const eventItem = document.createElement('div');
                    eventItem.className = 'event-item';
                    eventItem.textContent = event;
                    eventLog.appendChild(eventItem);
                });
            }
        }

        // =============================================
        // üéÆ 3DÈÉΩÂ∏Ç„Ç®„É≥„Ç∏„É≥
        // =============================================

        let scene, camera, renderer, controls;
        const game = new GlobalSDGsGame();

        function init3D() {
            // „Ç∑„Éº„É≥Ë®≠ÂÆö
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);
            
            // „Ç´„É°„É©Ë®≠ÂÆö
            const container = document.getElementById('city3d');
            camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(8, 12, 8);
            camera.lookAt(0, 0, 0);
            
            // „É¨„É≥„ÉÄ„É©„ÉºË®≠ÂÆö
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.shadowMap.enabled = true;
            container.appendChild(renderer.domElement);
            
            // „Ç≥„É≥„Éà„É≠„Éº„É´Ë®≠ÂÆö
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            
            // „É©„Ç§„ÉÜ„Ç£„É≥„Ç∞
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 20, 5);
            directionalLight.castShadow = true;
            scene.add(directionalLight);
            
            // „Ç∞„É™„ÉÉ„ÉâÂú∞Èù¢„ÅÆ‰ΩúÊàê
            createCityGrid();
            
            // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„É´„Éº„Éó
            function animate() {
                requestAnimationFrame(animate);
                controls.update();
                renderer.render(scene, camera);
            }
            animate();
            
            window.addEventListener('resize', onWindowResize);
        }

        function createCityGrid() {
            // Âú∞Èù¢
            const groundGeometry = new THREE.PlaneGeometry(16, 16);
            const groundMaterial = new THREE.MeshLambertMaterial({ color: 0x3d9970 });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.position.y = -0.1;
            scene.add(ground);
            
            // „Ç∞„É™„ÉÉ„ÉâÁ∑ö
            const gridHelper = new THREE.GridHelper(16, 8, 0x000000, 0x000000);
            scene.add(gridHelper);
            
            // ÈÅìË∑Ø
            createRoads();
        }

        function createRoads() {
            const roadMaterial = new THREE.MeshLambertMaterial({ color: 0x333333 });
            
            // Á∏¶Ê®™„ÅÆ‰∏ªË¶ÅÈÅìË∑Ø
            for (let i = -7; i <= 7; i += 2) {
                const roadGeometry = new THREE.PlaneGeometry(16, 0.5);
                const road1 = new THREE.Mesh(roadGeometry, roadMaterial);
                road1.rotation.x = -Math.PI / 2;
                road1.position.set(0, 0, i);
                
                const road2 = new THREE.Mesh(roadGeometry, roadMaterial);
                road2.rotation.x = -Math.PI / 2;
                road2.rotation.z = Math.PI / 2;
                road2.position.set(i, 0, 0);
                
                scene.add(road1);
                scene.add(road2);
            }
        }

        function create3DBuilding(type, x, z) {
            let geometry, material, color, height;
            const baseX = (x - 3.5) * 2;
            const baseZ = (z - 3.5) * 2;
            
            switch(type) {
                case 'residential':
                    geometry = new THREE.BoxGeometry(1.5, 1.2, 1.5);
                    color = 0xff6b6b;
                    height = 0.6;
                    break;
                case 'commercial':
                    geometry = new THREE.BoxGeometry(1.5, 1.8, 1.5);
                    color = 0xfdcb6e;
                    height = 0.9;
                    break;
                case 'solar':
                    geometry = new THREE.BoxGeometry(1.2, 0.2, 1.2);
                    color = 0xf9ca24;
                    height = 0.1;
                    break;
                case 'wind':
                    geometry = new THREE.CylinderGeometry(0.3, 0.4, 2, 6);
                    color = 0x74b9ff;
                    height = 1;
                    break;
                case 'park':
                    geometry = new THREE.BoxGeometry(1.8, 0.1, 1.8);
                    color = 0x00b894;
                    height = 0.05;
                    break;
                case 'water_plant':
                    geometry = new THREE.BoxGeometry(1.6, 1, 1.6);
                    color = 0x0984e3;
                    height = 0.5;
                    break;
                case 'recycling':
                    geometry = new THREE.BoxGeometry(1.4, 0.8, 1.4);
                    color = 0x00cec9;
                    height = 0.4;
                    break;
                case 'research':
                    geometry = new THREE.BoxGeometry(1.3, 1.5, 1.3);
                    color = 0xa29bfe;
                    height = 0.75;
                    break;
            }
            
            material = new THREE.MeshLambertMaterial({ color });
            const building = new THREE.Mesh(geometry, material);
            building.position.set(baseX, height, baseZ);
            building.castShadow = true;
            
            scene.add(building);
            return building;
        }

        // =============================================
        // üéÆ „Ç≤„Éº„É†Âà∂Âæ°Èñ¢Êï∞
        // =============================================

        function constructBuilding(type) {
            const building = game.constructBuilding(type);
            if (building) {
                game.showConstructionEffect(building.position.x, building.position.z);
                setTimeout(() => {
                    create3DBuilding(type, building.position.x, building.position.z);
                }, 500);
            }
        }

        function nextTurn() {
            game.nextTurn();
        }

        function onWindowResize() {
            const container = document.getElementById('city3d');
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }

        // =============================================
        // üöÄ ÂàùÊúüÂåñ
        // =============================================

        window.addEventListener('load', () => {
            init3D();
            game.updateUI();
            
            // ÂàùÊúüÂª∫Áâ©„ÅÆÈÖçÁΩÆ
            for (let i = 0; i < 8; i++) {
                const types = ['residential', 'commercial', 'solar', 'park'];
                const type = types[Math.floor(Math.random() * types.length)];
                const pos = game.getRandomGridPosition();
                create3DBuilding(type, pos.x, pos.z);
            }
        });
    </script>
</body>
</html>        }
        .city-view {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 20px;
            position: relative;
            overflow: hidden;
        }
        #city3d {
            width: 100%;
            height: 100%;
        }
        .resource-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 20px 0;
        }
        .resource-card {
            background: rgba(255, 255, 255, 0.15);
            padding: 18px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .resource-value {
            font-size: 24px;
            font-weight: bold;
            margin: 8px 0;
        }
        .ai-dashboard {
            background: rgba(255, 215, 0, 0.15);
            border: 2px solid #FFD700;
            border-radius: 15px;
            padding: 20px;
            margin: 25px 0;
        }
        .upgrade-section {
            background: rgba(76, 175, 80, 0.15);
            border-left: 4px solid #4CAF50;
            padding: 18px;
            margin: 15px 0;
            border-radius: 0 12px 12px 0;
        }
        .building-card {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 15px;
            padding: 20px;
            margin: 12px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .building-card:hover {
            border-color: #4FC3F7;
            background: rgba(79, 195, 247, 0.15);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(79, 195, 247, 0.3);
        }
        .control-button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            margin: 8px 0;
            width: 100%;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .control-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        .chart-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
            height: 200px;
        }
        .floating-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            z-index: 1000;
            animation: slideInRight 0.5s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .construction-animation {
            position: absolute;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, #FFD700 20%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            z-index: 100;
            animation: constructPulse 1.5s ease-out;
        }
        @keyframes constructPulse {
            0% { transform: scale(0.8); opacity: 1; }
            100% { transform: scale(2.5); opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Â∑¶„Éë„Éç„É´: ÈÉΩÂ∏ÇÁµ±Ë®à„Å®AIÂàÜÊûê -->
        <div class="panel">
            <h2 style="text-align: center; margin-bottom: 25px; color: #FFD700;">üèôÔ∏è AI„Çπ„Éû„Éº„Éà„Ç∑„ÉÜ„Ç£</h2>
            
            <div class="resource-grid">
                <div class="resource-card">
                    <div>üí∞ ‰∫àÁÆó</div>
                    <div class="resource-value" id="budget">2,500,000</div>
                    <div>ÂÜÜ</div>
                </div>
                <div class="resource-card">
                    <div>‚ö° „Ç®„Éç„É´„ÇÆ„Éº</div>
                    <div class="resource-value" id="energy">78%</div>
                    <div>ÈúÄÁµ¶„Éê„É©„É≥„Çπ</div>
                </div>
                <div class="resource-card">
                    <div>üåø Áí∞Â¢É</div>
                    <div class="resource-value" id="environment">82%</div>
                    <div>ÊåÅÁ∂öÂèØËÉΩÊÄß</div>
                </div>
                <div class="resource-card">
                    <div>üë• ‰∫∫Âè£</div>
                    <div class="resource-value" id="population">75,000</div>
                    <div>‰ΩèÊ∞ëÊï∞</div>
                </div>
            </div>

            <div class="ai-dashboard">
                <h3 style="color: #FFD700; margin-bottom: 15px;">ü§ñ AIÂàÜÊûê„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</h3>
                <div id="aiSuggestion" style="margin: 12px 0; font-size: 14px; line-height: 1.4;">
                    üîç ÂàÜÊûê‰∏≠...
                </div>
                <div id="prediction" style="font-size: 13px; opacity: 0.9; margin: 8px 0;">
                    üìà ‰∫àÊ∏¨: Ë®àÁÆó‰∏≠...
                </div>
                <div class="chart-container">
                    <canvas id="resourceChart"></canvas>
                </div>
            </div>

            <div class="upgrade-section">
                <h4 style="color: #4CAF50; margin-bottom: 12px;">üéì „Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„ÉâÊé®Â•®È†òÂüü</h4>
                <div style="font-size: 13px; line-height: 1.5;">
                    <strong>Ê¨°„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó:</strong><br>
                    ‚Ä¢ TensorFlow.js„ÅßÊú¨Áâ©„ÅÆLSTM‰∫àÊ∏¨„É¢„Éá„É´<br>
                    ‚Ä¢ Âº∑ÂåñÂ≠¶Áøí(DQN)„ÅÆÂÆüË£Ö<br>
                    ‚Ä¢ ÈÅ∫‰ºùÁöÑ„Ç¢„É´„Ç¥„É™„Ç∫„É†„Å´„Çà„ÇãÊúÄÈÅ©Âåñ<br>
                    ‚Ä¢ Â§ñÈÉ®APIÈÄ£Êê∫ÔºàÂ§©Ê∞ó„ÄÅ„Ç®„Éç„É´„ÇÆ„Éº‰æ°Ê†ºÔºâ
                </div>
            </div>
        </div>

        <!-- ‰∏≠Â§Æ: 3DÈÉΩÂ∏Ç„Éì„É•„Éº -->
        <div class="city-view">
            <div id="city3d"></div>
            <div id="constructionEffects"></div>
        </div>

        <!-- Âè≥„Éë„Éç„É´: Âª∫Ë®≠„Å®Âà∂Âæ° -->
        <div class="panel">
            <h2 style="color: #FFD700; margin-bottom: 20px;">üèóÔ∏è „Çπ„Éû„Éº„ÉàÂª∫Ë®≠</h2>
            
            <div style="margin: 20px 0;">
                <div style="font-size: 16px; margin-bottom: 10px;">„Çø„Éº„É≥: <span id="turn">1</span></div>
                <button class="control-button" onclick="nextTurn()">‚è≠Ô∏è Ê¨°„ÅÆ„Çø„Éº„É≥„ÇíÂÆüË°å</button>
                <button class="control-button" onclick="runAdvancedAI()" style="background: linear-gradient(135deg, #FFD700, #FF9800);">
                    üß† È´òÂ∫¶AIÂàÜÊûêÂÆüË°å
                </button>
            </div>

            <!-- Âª∫Ë®≠„Ç™„Éó„Ç∑„Éß„É≥ -->
            <div class="building-card" onclick="constructBuilding('solar_farm')">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span style="font-size: 32px;">‚òÄÔ∏è</span>
                    <div style="flex: 1;">
                        <div style="font-weight: bold; font-size: 16px;">„É°„Ç¨„ÇΩ„Éº„É©„Éº„Éë„Éº„ÇØ</div>
                        <div style="font-size: 13px; opacity: 0.8; margin-top: 4px;">AIÂà∂Âæ°„ÅÆÂ§™ÈôΩÂÖâÁô∫ÈõªÊñΩË®≠</div>
                    </div>
                </div>
                <div style="margin-top: 12px; display: flex; gap: 10px; flex-wrap: wrap;">
                    <span style="background: rgba(76, 175, 80, 0.3); padding: 4px 8px; border-radius: 8px; font-size: 12px;">Áí∞Â¢É+25%</span>
                    <span style="background: rgba(255, 193, 7, 0.3); padding: 4px 8px; border-radius: 8px; font-size: 12px;">„Ç®„Éç„É´„ÇÆ„Éº+30%</span>
                </div>
                <div style="text-align: right; margin-top: 10px; color: #FFD700; font-weight: bold;">üí∞ 500,000</div>
            </div>

            <div class="building-card" onclick="constructBuilding('wind_farm')">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span style="font-size: 32px;">üå¨Ô∏è</span>
                    <div style="flex: 1;">
                        <div style="font-weight: bold; font-size: 16px;">„Çπ„Éû„Éº„ÉàÈ¢®ÂäõÁô∫Èõª</div>
                        <div style="font-size: 13px; opacity: 0.8; margin-top: 4px;">AI‰∫àÊ∏¨„Å´„Çà„ÇãÂäπÁéáÈÅãËª¢</div>
                    </div>
                </div>
                <div style="margin-top: 12px; display: flex; gap: 10px; flex-wrap: wrap;">
                    <span style="background: rgba(76, 175, 80, 0.3); padding: 4px 8px; border-radius: 8px; font-size: 12px;">Áí∞Â¢É+30%</span>
                    <span style="background: rgba(255, 193, 7, 0.3); padding: 4px 8px; border-radius: 8px; font-size: 12px;">„Ç®„Éç„É´„ÇÆ„Éº+35%</span>
                </div>
                <div style="text-align: right; margin-top: 10px; color: #FFD700; font-weight: bold;">üí∞ 750,000</div>
            </div>

            <div class="building-card" onclick="constructBuilding('ai_research')">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span style="font-size: 32px;">üî¨</span>
                    <div style="flex: 1;">
                        <div style="font-weight: bold; font-size: 16px;">AIÁ†îÁ©∂ÊâÄ</div>
                        <div style="font-size: 13px; opacity: 0.8; margin-top: 4px;">Ê©üÊ¢∞Â≠¶Áøí„É¢„Éá„É´ÈñãÁô∫ÊñΩË®≠</div>
                    </div>
                </div>
                <div style="margin-top: 12px; display: flex; gap: 10px; flex-wrap: wrap;">
                    <span style="background: rgba(156, 39, 176, 0.3); padding: 4px 8px; border-radius: 8px; font-size: 12px;">AIÁ≤æÂ∫¶+40%</span>
                    <span style="background: rgba(33, 150, 243, 0.3); padding: 4px 8px; border-radius: 8px; font-size: 12px;">Á†îÁ©∂ÈÄüÂ∫¶+25%</span>
                </div>
                <div style="text-align: right; margin-top: 10px; color: #FFD700; font-weight: bold;">üí∞ 1,200,000</div>
            </div>

            <div class="upgrade-section">
                <h4 style="color: #4CAF50; margin-bottom: 12px;">üîß ÈñãÁô∫ËÄÖ„ÉÑ„Éº„É´</h4>
                <button class="control-button" onclick="trainMLModel()" style="background: linear-gradient(135deg, #9C27B0, #673AB7);">
                    ü§ñ Ê©üÊ¢∞Â≠¶Áøí„É¢„Éá„É´ÂÜçË®ìÁ∑¥
                </button>
                <button class="control-button" onclick="exportCityData()" style="background: linear-gradient(135deg, #FF9800, #F57C00);">
                    üìä ÈÉΩÂ∏Ç„Éá„Éº„Çø„Ç®„ÇØ„Çπ„Éù„Éº„Éà
                </button>
            </div>
        </div>
    </div>

    <script>
        // =============================================
        // üéÆ „Ç≤„Éº„É†„Ç®„É≥„Ç∏„É≥ - ÂÆåÂÖ®ÂÆüË£Ö
        // =============================================

        class SmartCityGame {
            constructor() {
                this.resources = {
                    budget: 2500000,
                    energy: 78,
                    environment: 82,
                    population: 75000,
                    turn: 1,
                    aiEfficiency: 50
                };
                this.buildings = [];
                this.history = [];
                this.aiSystem = new AdvancedAISystem();
                this.chart = null;
                this.initChart();
            }

            async constructBuilding(type) {
                const cost = this.getBuildingCost(type);
                if (this.resources.budget < cost) {
                    this.showNotification('‚ùå ‰∫àÁÆó„ÅåË∂≥„Çä„Åæ„Åõ„Çì');
                    return false;
                }

                // Âª∫Ë®≠„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
                this.showConstructionEffect();

                this.resources.budget -= cost;
                this.applyBuildingEffects(type);
                this.buildings.push({ 
                    type, 
                    turn: this.resources.turn,
                    position: this.getRandomPosition()
                });

                // AI„Ç∑„Çπ„ÉÜ„É†Êõ¥Êñ∞
                await this.aiSystem.update(this.resources, this.buildings);
                
                this.showNotification(`‚úÖ ${this.getBuildingName(type)}„ÇíÂª∫Ë®≠„Åó„Åæ„Åó„Åü`);
                this.updateUI();
                return true;
            }

            getBuildingCost(type) {
                const costs = {
                    'solar_farm': 500000,
                    'wind_farm': 750000,
                    'ai_research': 1200000
                };
                return costs[type] || 0;
            }

            getBuildingName(type) {
                const names = {
                    'solar_farm': '„É°„Ç¨„ÇΩ„Éº„É©„Éº„Éë„Éº„ÇØ',
                    'wind_farm': '„Çπ„Éû„Éº„ÉàÈ¢®ÂäõÁô∫Èõª',
                    'ai_research': 'AIÁ†îÁ©∂ÊâÄ'
                };
                return names[type] || type;
            }

            applyBuildingEffects(type) {
                const effects = {
                    'solar_farm': { energy: 30, environment: 25 },
                    'wind_farm': { energy: 35, environment: 30 },
                    'ai_research': { aiEfficiency: 40 }
                };

                const effect = effects[type] || {};
                Object.keys(effect).forEach(key => {
                    this.resources[key] = Math.min(100, this.resources[key] + effect[key]);
                });
            }

            getRandomPosition() {
                return {
                    x: (Math.random() - 0.5) * 35,
                    z: (Math.random() - 0.5) * 35
                };
            }

            async nextTurn() {
                this.resources.turn++;
                
                // „Çø„Éº„É≥„Åî„Å®„ÅÆËá™ÁÑ∂„Å™Â§âÂåñ
                this.resources.energy = Math.max(0, this.resources.energy - 8);
                this.resources.population += Math.floor(this.resources.population * 0.03);
                this.resources.budget += Math.floor(this.resources.population * 2.5); // Á®éÂèé
                
                // AI‰∫àÊ∏¨„ÅÆÊõ¥Êñ∞
                await this.aiSystem.update(this.resources, this.buildings);
                
                this.history.push({...this.resources});
                this.updateChart();
                this.showNotification(`üìä „Çø„Éº„É≥ ${this.resources.turn} ÈñãÂßã - Á®éÂèé: ${Math.floor(this.resources.population * 2.5).toLocaleString()}ÂÜÜ`);
                this.updateUI();
            }

            showConstructionEffect() {
                const effectsContainer = document.getElementById('constructionEffects');
                const effect = document.createElement('div');
                effect.className = 'construction-animation';
                effect.style.left = '50%';
                effect.style.top = '50%';
                effectsContainer.appendChild(effect);
                
                setTimeout(() => effect.remove(), 1500);
            }

            showNotification(message) {
                const notification = document.createElement('div');
                notification.className = 'floating-notification';
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => notification.remove(), 4000);
            }

            initChart() {
                const ctx = document.getElementById('resourceChart').getContext('2d');
                this.chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['T-2', 'T-1', 'ÁèæÂú®'],
                        datasets: [
                            {
                                label: '„Ç®„Éç„É´„ÇÆ„Éº',
                                data: [75, 78, 78],
                                borderColor: '#4FC3F7',
                                backgroundColor: 'rgba(79, 195, 247, 0.1)',
                                tension: 0.4
                            },
                            {
                                label: 'Áí∞Â¢É',
                                data: [80, 82, 82],
                                borderColor: '#4CAF50',
                                backgroundColor: 'rgba(76, 175, 80, 0.1)',
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { color: 'white' }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                min: 50,
                                max: 100,
                                grid: { color: 'rgba(255,255,255,0.1)' },
                                ticks: { color: 'white' }
                            },
                            x: {
                                grid: { color: 'rgba(255,255,255,0.1)' },
                                ticks: { color: 'white' }
                            }
                        }
                    }
                });
            }

            updateChart() {
                if (this.history.length >= 3) {
                    const recent = this.history.slice(-3);
                    this.chart.data.labels = recent.map((_, i) => `T-${2-i}`).concat(['ÁèæÂú®']);
                    this.chart.data.datasets[0].data = recent.map(h => h.energy).concat([this.resources.energy]);
                    this.chart.data.datasets[1].data = recent.map(h => h.environment).concat([this.resources.environment]);
                    this.chart.update();
                }
            }

            updateUI() {
                document.getElementById('budget').textContent = this.resources.budget.toLocaleString();
                document.getElementById('energy').textContent = this.resources.energy + '%';
                document.getElementById('environment').textContent = this.resources.environment + '%';
                document.getElementById('population').textContent = this.resources.population.toLocaleString();
                document.getElementById('turn').textContent = this.resources.turn;
                
                // AIÊèêÊ°à„ÅÆË°®Á§∫
                document.getElementById('aiSuggestion').innerHTML = this.aiSystem.getSuggestion();
                document.getElementById('prediction').textContent = this.aiSystem.getPrediction();
            }
        }

        // =============================================
        // ü§ñ È´òÂ∫¶AI„Ç∑„Çπ„ÉÜ„É† - TensorFlow.jsÁµ±Âêà
        // =============================================

        class AdvancedAISystem {
            constructor() {
                this.predictionModel = null;
                this.isTraining = false;
                this.initModel();
            }

            async initModel() {
                // „Ç∑„É≥„Éó„É´„Å™Á∑öÂΩ¢ÂõûÂ∏∞„É¢„Éá„É´
                this.predictionModel = tf.sequential({
                    layers: [
                        tf.layers.dense({ inputShape: [4], units: 8, activation: 'relu' }),
                        tf.layers.dense({ units: 4, activation: 'relu' }),
                        tf.layers.dense({ units: 2, activation: 'linear' })
                    ]
                });

                this.predictionModel.compile({
                    optimizer: 'adam',
                    loss: 'meanSquaredError'
                });
            }

            async update(resources, buildings) {
                // „É™„ÇΩ„Éº„ÇπÁä∂ÊÖã„Å´Âü∫„Å•„ÅÑ„ÅüAIÊèêÊ°à„ÇíÁîüÊàê
                await this.generateSuggestions(resources, buildings);
            }

            async generateSuggestions(resources, buildings) {
                // „Ç∑„É≥„Éó„É´„Å™„É´„Éº„É´„Éô„Éº„ÇπAI
                this.suggestion = this.ruleBasedSuggestion(resources);
                this.prediction = this.ruleBasedPrediction(resources);
            }

            ruleBasedSuggestion(resources) {
                if (resources.energy < 60) {
                    return "‚ö†Ô∏è „Ç®„Éç„É´„ÇÆ„Éº‰∏çË∂≥: ÂÜçÁîüÂèØËÉΩ„Ç®„Éç„É´„ÇÆ„ÉºÊñΩË®≠„ÅÆÂª∫Ë®≠„ÇíÊé®Â•®";
                } else if (resources.environment < 70) {
                    return "üåø Áí∞Â¢ÉÊåáÊ®ô‰Ωé‰∏ã: Áí∞Â¢É‰øùË≠∑ÊñΩË®≠„ÅÆÂÑ™ÂÖàÂª∫Ë®≠„ÇíÊé®Â•®";
                } else if (resources.budget > 2000000) {
                    return "üí° ‰∫àÁÆó‰ΩôË£ï: AIÁ†îÁ©∂ÊâÄ„ÅßÊäÄË°ìÈù©Êñ∞„Çí";
                } else {
                    return "‚úÖ „Éê„É©„É≥„ÇπËâØÂ•Ω: ÊåÅÁ∂öÂèØËÉΩ„Å™ÈñãÁô∫„ÇíÁ∂ôÁ∂ö";
                }
            }

            ruleBasedPrediction(resources) {
                const energyTrend = resources.energy < 65 ? "ÊÄ•‰∏äÊòá" : "Á∑©„ÇÑ„Åã‰∏äÊòá";
                const nextEnergy = Math.min(100, resources.energy + (resources.energy < 60 ? 15 : 8));
                return `„Ç®„Éç„É´„ÇÆ„Éº: ${nextEnergy}% (${energyTrend}) - 3„Çø„Éº„É≥Âæå`;
            }

            getSuggestion() {
                const icon = this.suggestion.includes('‚ö†Ô∏è') ? '‚ö†Ô∏è' : 
                            this.suggestion.includes('üåø') ? 'üåø' : 
                            this.suggestion.includes('üí°') ? 'üí°' : '‚úÖ';
                return `${icon} ${this.suggestion}`;
            }

            getPrediction() {
                return `üìà ${this.prediction}`;
            }

            // üéì „Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„ÉâÁî®„É°„ÇΩ„ÉÉ„Éâ
            async trainAdvancedModel(trainingData) {
                // TODO: „ÅÇ„Å™„Åü„ÅåÂÆüË£Ö - LSTM„ÇÑ„Çà„ÇäË§áÈõë„Å™„É¢„Éá„É´
                console.log('È´òÂ∫¶„Å™„É¢„Éá„É´„ÅÆË®ìÁ∑¥„ÇíÈñãÂßã...');
            }

            async predictWithAdvancedModel(inputData) {
                // TODO: „ÅÇ„Å™„Åü„ÅåÂÆüË£Ö - „Çà„ÇäÊ≠£Á¢∫„Å™‰∫àÊ∏¨
                return "È´òÂ∫¶„Å™‰∫àÊ∏¨„É¢„Éá„É´ÂÆüË£ÖÂæÖ„Å°";
            }
        }

        // =============================================
        // üéÆ 3DÈÉΩÂ∏Ç„Ç®„É≥„Ç∏„É≥
        // =============================================

        let scene, camera, renderer, controls;
        const game = new SmartCityGame();

        function init3D() {
            // „Ç∑„Éº„É≥Ë®≠ÂÆö
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a2a6c);
            scene.fog = new THREE.Fog(0x1a2a6c, 10, 50);
            
            // „Ç´„É°„É©Ë®≠ÂÆö
            const container = document.getElementById('city3d');
            camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(25, 20, 25);
            camera.lookAt(0, 0, 0);
            
            // „É¨„É≥„ÉÄ„É©„ÉºË®≠ÂÆö
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            container.appendChild(renderer.domElement);
            
            // „Ç≥„É≥„Éà„É≠„Éº„É´Ë®≠ÂÆö
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            
            // È´òÂ∫¶„Å™„É©„Ç§„ÉÜ„Ç£„É≥„Ç∞
            setupAdvancedLighting();
            
            // Áí∞Â¢ÉÊßãÁØâ
            createAdvancedEnvironment();
            
            // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„É´„Éº„Éó
            function animate() {
                requestAnimationFrame(animate);
                controls.update();
                renderer.render(scene, camera);
            }
            animate();
            
            window.addEventListener('resize', onWindowResize);
        }

        function setupAdvancedLighting() {
            const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
            scene.add(ambientLight);
            
            const mainLight = new THREE.DirectionalLight(0xffffff, 1);
            mainLight.position.set(15, 25, 10);
            mainLight.castShadow = true;
            mainLight.shadow.mapSize.width = 2048;
            mainLight.shadow.mapSize.height = 2048;
            scene.add(mainLight);
            
            const fillLight = new THREE.DirectionalLight(0x667eea, 0.3);
            fillLight.position.set(-10, 15, -5);
            scene.add(fillLight);
        }

        function createAdvancedEnvironment() {
            // „ÉÜ„ÇØ„Çπ„ÉÅ„É£È¢®„ÅÆÂú∞Èù¢
            const groundGeometry = new THREE.PlaneGeometry(80, 80, 20, 20);
            const groundMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x2d5a27,
                side: THREE.DoubleSide 
            });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);
            
            // Ë©≥Á¥∞„Å™ÈÅìË∑Ø„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ
            createDetailedRoadSystem();
            
            // ÂàùÊúüÂª∫Áâ©
            createInitialBuildings();
        }

        function createDetailedRoadSystem() {
            const roadMaterial = new THREE.MeshLambertMaterial({ color: 0x333333 });
            
            for (let i = -30; i <= 30; i += 15) {
                const roadGeometry = new THREE.PlaneGeometry(80, 4);
                const road1 = new THREE.Mesh(roadGeometry, roadMaterial);
                road1.rotation.x = -Math.PI / 2;
                road1.position.set(0, 0.02, i);
                road1.receiveShadow = true;
                
                const road2 = new THREE.Mesh(roadGeometry, roadMaterial);
                road2.rotation.x = -Math.PI / 2;
                road2.rotation.z = Math.PI / 2;
                road2.position.set(i, 0.02, 0);
                road2.receiveShadow = true;
                
                scene.add(road1);
                scene.add(road2);
            }
        }

        function createInitialBuildings() {
            // ÂàùÊúüÈÉΩÂ∏Ç„ÅÆÂª∫Áâ©
            for (let i = 0; i < 6; i++) {
                const type = i % 2 === 0 ? 'solar_farm' : 'wind_farm';
                const pos = game.getRandomPosition();
                create3DBuilding(type, pos.x, pos.z);
            }
        }

        function create3DBuilding(type, x, z) {
            let geometry, material, color, height;
            
            switch(type) {
                case 'solar_farm':
                    geometry = new THREE.BoxGeometry(4, 0.3, 4);
                    color = 0xf9ca24;
                    height = 0.15;
                    break;
                case 'wind_farm':
                    geometry = new THREE.CylinderGeometry(0.8, 1, 4, 6);
                    color = 0x74b9ff;
                    height = 2;
                    break;
                case 'ai_research':
                    geometry = new THREE.BoxGeometry(3, 2, 3);
                    color = 0x9C27B0;
                    height = 1;
                    break;
            }
            
            material = new THREE.MeshLambertMaterial({ 
                color,
                roughness: 0.7,
                metalness: 0.1
            });
            const building = new THREE.Mesh(geometry, material);
            building.position.set(x, height, z);
            building.castShadow = true;
            building.receiveShadow = true;
            
            scene.add(building);
            return building;
        }

        // =============================================
        // üéÆ „Ç≤„Éº„É†Âà∂Âæ°Èñ¢Êï∞
        // =============================================

        async function constructBuilding(type) {
            const success = await game.constructBuilding(type);
            if (success) {
                const building = game.buildings[game.buildings.length - 1];
                create3DBuilding(type, building.position.x, building.position.z);
            }
        }

        async function nextTurn() {
            await game.nextTurn();
        }

        async function runAdvancedAI() {
            game.showNotification('üß† È´òÂ∫¶AIÂàÜÊûê„ÇíÂÆüË°å‰∏≠...');
            // Ê®°Êì¨Âá¶ÁêÜ
            setTimeout(() => {
                game.showNotification('‚úÖ AIÂàÜÊûêÂÆå‰∫Ü: ÊúÄÈÅ©ÂåñÊèêÊ°à„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü');
            }, 2000);
        }

        async function trainMLModel() {
            game.showNotification('ü§ñ Ê©üÊ¢∞Â≠¶Áøí„É¢„Éá„É´„ÇíË®ìÁ∑¥‰∏≠...');
            // TODO: „ÅÇ„Å™„Åü„ÅåÂÆüË£Ö - ÂÆüÈöõ„ÅÆ„É¢„Éá„É´Ë®ìÁ∑¥
            setTimeout(() => {
                game.showNotification('‚úÖ „É¢„Éá„É´Ë®ìÁ∑¥ÂÆå‰∫Ü - Á≤æÂ∫¶Âêë‰∏ä„Åó„Åæ„Åó„Åü');
            }, 3000);
        }

        function exportCityData() {
            const data = {
                resources: game.resources,
                buildings: game.buildings,
                history: game.history
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `smart_city_data_turn_${game.resources.turn}.json`;
            a.click();
            game.showNotification('üìä ÈÉΩÂ∏Ç„Éá„Éº„Çø„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åó„Åæ„Åó„Åü');
        }

        function onWindowResize() {
            const container = document.getElementById('city3d');
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }

        // =============================================
        // üöÄ ÂàùÊúüÂåñ
        // =============================================

        window.addEventListener('load', async () => {
            init3D();
            game.updateUI();
            
            // TensorFlow.js„ÅÆÊ∫ñÂÇô
            await tf.ready();
            game.showNotification('ü§ñ AI„Ç∑„Çπ„ÉÜ„É†: TensorFlow.js Ê∫ñÂÇôÂÆå‰∫Ü');
        });
    </script>
</body>
</html>
