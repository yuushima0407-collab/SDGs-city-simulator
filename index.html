<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDGs World Builder - Improved</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* ÁîªÈù¢ÁÆ°ÁêÜ */
        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        /* „Éò„ÉÉ„ÉÄ„Éº */
        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #00b894, #00cec9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ */
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .nav-tab.active {
            background: #00b894;
            border-color: #00cec9;
        }

        /* „Ç´„Éº„Éâ„Ç∑„Çπ„ÉÜ„É† */
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }

        .card:hover::before {
            left: 100%;
        }

        .card:hover {
            transform: translateY(-5px);
            border-color: #00cec9;
            box-shadow: 0 15px 30px rgba(0, 206, 201, 0.3);
        }

        .card.disabled {
            opacity: 0.4;
            cursor: not-allowed;
            filter: grayscale(1);
        }

        .card.new {
            border-color: #fdcb6e;
            animation: pulse 2s infinite;
        }

        .card-icon {
            font-size: 3em;
            margin-bottom: 15px;
            text-align: center;
        }

        .card-rarity {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.7em;
            font-weight: bold;
        }

        .rarity-common { background: #636e72; }
        .rarity-rare { background: #0984e3; }
        .rarity-epic { background: #6c5ce7; }

        /* ÈÉΩÂ∏ÇÂª∫Ë®≠„Ç∞„É™„ÉÉ„Éâ */
        .city-builder {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
        }

        .city-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
        }

        .grid-cell {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2em;
        }

        .grid-cell:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .grid-cell.built {
            background: rgba(0, 184, 148, 0.3);
        }

        .grid-cell.selected {
            background: rgba(0, 206, 201, 0.5);
            box-shadow: 0 0 15px rgba(0, 206, 201, 0.5);
        }

        /* Âª∫Ë®≠„Ç™„Éó„Ç∑„Éß„É≥ */
        .build-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .build-option {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .build-option:hover {
            transform: translateY(-3px);
            border-color: #74b9ff;
        }

        .build-option.available {
            background: rgba(116, 185, 255, 0.2);
        }

        /* ÂõΩË©≥Á¥∞ÁîªÈù¢ */
        .country-detail {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
        }

        .country-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
        }

        .country-flag {
            font-size: 4em;
        }

        .country-info h2 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        /* AR„Éó„É¨„Éì„É•„Éº */
        .ar-preview {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            text-align: center;
            border: 2px dashed #00cec9;
        }

        .ar-viewport {
            width: 100%;
            height: 300px;
            background: linear-gradient(45deg, #1a2a6c, #b21f1f);
            border-radius: 10px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .ar-building {
            position: absolute;
            transition: all 0.5s ease;
        }

        /* „É™„ÇΩ„Éº„ÇπË°®Á§∫ */
        .resources-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .resource {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .resource:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.15);
        }

        .resource-value {
            font-size: 1.8em;
            font-weight: bold;
            margin: 8px 0;
        }

        /* „Éú„Çø„É≥ */
        .btn {
            background: linear-gradient(45deg, #00b894, #00cec9);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
            font-size: 1em;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 184, 148, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .btn-ar {
            background: linear-gradient(45deg, #6c5ce7, #a29bfe);
        }

        /* „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* ÈÄöÁü• */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            z-index: 1000;
            animation: slideIn 0.5s ease;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            max-width: 400px;
        }

        /* ÈÄ≤Êçó„Éê„Éº */
        .progress-container {
            margin: 15px 0;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00b894, #00cec9);
            border-radius: 10px;
            transition: width 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- „Çπ„Çø„Éº„ÉàÁîªÈù¢ -->
        <div id="startScreen" class="screen active">
            <div class="header">
                <h1>üåç SDGs World Builder</h1>
                <p>‰∏ñÁïå„ÅÆÁü•ÊÅµ„ÇíÈõÜ„ÇÅ„Å¶„ÄÅÁêÜÊÉ≥„ÅÆÊú™Êù•ÈÉΩÂ∏Ç„Çí‰Ωú„Çç„ÅÜÔºÅ</p>
            </div>
            <div style="text-align: center; margin-top: 50px;">
                <button class="btn" onclick="showScreen('countrySelect')">üöÄ „Ç≤„Éº„É†„ÇíÂßã„ÇÅ„Çã</button>
                <button class="btn btn-secondary" onclick="showScreen('tutorial')">üìö ÈÅä„Å≥Êñπ</button>
            </div>
        </div>

        <!-- ÂõΩÈÅ∏ÊäûÁîªÈù¢ -->
        <div id="countrySelect" class="screen">
            <div class="header">
                <h1>üåè Ë®™Âïè„Åô„ÇãÂõΩ„ÇíÈÅ∏„Åº„ÅÜ</h1>
                <p>ÂêÑÂõΩ„ÅÆSDGsÊàêÂäü‰∫ã‰æã„ÇíÂ≠¶„Çì„Åß„Ç´„Éº„Éâ„ÇíÁç≤Âæó„Åó„Çà„ÅÜ</p>
            </div>

            <div class="nav-tabs">
                <div class="nav-tab active" onclick="showContinent('asia')">üåè „Ç¢„Ç∏„Ç¢</div>
                <div class="nav-tab" onclick="showContinent('europe')">üè∞ „É®„Éº„É≠„ÉÉ„Éë</div>
                <div class="nav-tab" onclick="showContinent('africa')">ü¶Å „Ç¢„Éï„É™„Ç´</div>
            </div>

            <div class="cards-container">
                <!-- Êó•Êú¨„ÅÆ„Ç´„Éº„Éâ -->
                <div class="card continent-asia" onclick="visitCountry('japan')">
                    <div class="card-icon">üáØüáµ</div>
                    <h3>Êó•Êú¨</h3>
                    <p>„Åî„ÅøÂàÜÂà•„ÉªÁÅΩÂÆ≥ÂØæÁ≠ñ„ÉªÂÖ¨ÂÖ±‰∫§ÈÄö</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%"></div>
                    </div>
                    <small>Êú™Ë®™Âïè - „ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶Êé¢Ê§ú</small>
                </div>

                <!-- „Ç∑„É≥„Ç¨„Éù„Éº„É´„ÅÆ„Ç´„Éº„Éâ -->
                <div class="card continent-asia" onclick="visitCountry('singapore')">
                    <div class="card-icon">üá∏üá¨</div>
                    <h3>„Ç∑„É≥„Ç¨„Éù„Éº„É´</h3>
                    <p>Ê∞¥Ë≥áÊ∫êÁÆ°ÁêÜ„ÉªÈÉΩÂ∏ÇÁ∑ëÂåñ</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%"></div>
                    </div>
                    <small>Êú™Ë®™Âïè - „ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶Êé¢Ê§ú</small>
                </div>

                <!-- „Éâ„Ç§„ÉÑ„ÅÆ„Ç´„Éº„Éâ -->
                <div class="card continent-europe" style="display: none" onclick="visitCountry('germany')">
                    <div class="card-icon">üá©üá™</div>
                    <h3>„Éâ„Ç§„ÉÑ</h3>
                    <p>„Ç®„Éç„É´„ÇÆ„ÉºËª¢Êèõ„Éª„É™„Çµ„Ç§„ÇØ„É´</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%"></div>
                    </div>
                    <small>Êú™Ë®™Âïè - „ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶Êé¢Ê§ú</small>
                </div>

                <!-- „É´„ÉØ„É≥„ÉÄ„ÅÆ„Ç´„Éº„Éâ -->
                <div class="card continent-africa" style="display: none" onclick="visitCountry('rwanda')">
                    <div class="card-icon">üá∑üáº</div>
                    <h3>„É´„ÉØ„É≥„ÉÄ</h3>
                    <p>„Éó„É©„Çπ„ÉÅ„ÉÉ„ÇØÁ¶ÅÊ≠¢„ÉªÊ∏ÖÊΩîÊîøÁ≠ñ</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%"></div>
                    </div>
                    <small>Êú™Ë®™Âïè - „ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶Êé¢Ê§ú</small>
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-secondary" onclick="showScreen('startScreen')">‚Üê Êàª„Çã</button>
                <button class="btn" onclick="showScreen('cityBuilder')">üèôÔ∏è ÈÉΩÂ∏Ç„ÇíÂª∫Ë®≠</button>
                <button class="btn" onclick="showScreen('cardCollection')">üÉè „Ç´„Éº„ÉâÂõ≥Èëë</button>
            </div>
        </div>

        <!-- ÂõΩË©≥Á¥∞ÁîªÈù¢ -->
        <div id="countryDetail" class="screen">
            <div class="country-detail">
                <div class="country-header">
                    <div class="country-flag" id="detailFlag">üáØüáµ</div>
                    <div class="country-info">
                        <h2 id="detailCountryName">Êó•Êú¨</h2>
                        <p id="detailCountryDescription">ÊåÅÁ∂öÂèØËÉΩ„Å™Á§æ‰ºö„ÇíÂÆüÁèæ„Åô„Çã„Åü„ÇÅ„ÅÆÂÖàÈÄ≤ÁöÑ„Å™Âèñ„ÇäÁµÑ„Åø</p>
                    </div>
                </div>

                <div class="progress-container">
                    <h4>Ë™øÊüªÈÄ≤Êçó</h4>
                    <div class="progress-bar">
                        <div class="progress-fill" id="detailProgress" style="width: 0%"></div>
                    </div>
                    <small id="detailProgressText">0% ÂÆå‰∫Ü</small>
                </div>

                <div class="cards-container" id="countryCards">
                    <!-- ÂõΩ„ÅÆ„Ç´„Éº„Éâ„ÅØJavaScript„ÅßÁîüÊàê -->
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="showScreen('countrySelect')">‚Üê ÂõΩÈÅ∏Êäû„Å´Êàª„Çã</button>
                    <button class="btn" onclick="continueExploration()">üîç „Åï„Çâ„Å´Êé¢Ê§ú„Åô„Çã</button>
                </div>
            </div>
        </div>

        <!-- ÈÉΩÂ∏ÇÂª∫Ë®≠ÁîªÈù¢ -->
        <div id="cityBuilder" class="screen">
            <div class="header">
                <h1>üèôÔ∏è „Éû„Ç§„Ç∑„ÉÜ„Ç£Âª∫Ë®≠</h1>
                <p>Áç≤Âæó„Åó„Åü„Ç´„Éº„Éâ„Çí‰Ωø„Å£„Å¶ÊåÅÁ∂öÂèØËÉΩ„Å™ÈÉΩÂ∏Ç„ÇíÂª∫Ë®≠„Åó„Çà„ÅÜ</p>
            </div>

            <!-- „É™„ÇΩ„Éº„ÇπË°®Á§∫ -->
            <div class="resources-bar">
                <div class="resource">
                    <div>üí∞</div>
                    <div class="resource-value" id="money">1,000,000</div>
                    <div>‰∫àÁÆó</div>
                </div>
                <div class="resource">
                    <div>üåø</div>
                    <div class="resource-value" id="environment">50%</div>
                    <div>Áí∞Â¢ÉÊåáÊ®ô</div>
                </div>
                <div class="resource">
                    <div>üòä</div>
                    <div class="resource-value" id="happiness">65%</div>
                    <div>Â∏ÇÊ∞ëÂπ∏Á¶èÂ∫¶</div>
                </div>
                <div class="resource">
                    <div>‚ö°</div>
                    <div class="resource-value" id="energy">75%</div>
                    <div>„Ç®„Éç„É´„ÇÆ„Éº</div>
                </div>
            </div>

            <div class="city-builder">
                <h3>üèóÔ∏è ÈÉΩÂ∏ÇÂª∫Ë®≠„Ç®„É™„Ç¢</h3>
                <p>„Ç∞„É™„ÉÉ„Éâ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶Âª∫Ë®≠Â†¥ÊâÄ„ÇíÈÅ∏Êäû„Åó„ÄÅÂè≥„ÅÆÊñΩË®≠„Åã„ÇâÂª∫Ë®≠„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px;">
                    <!-- Âª∫Ë®≠„Ç∞„É™„ÉÉ„Éâ -->
                    <div>
                        <div class="city-grid" id="cityGrid">
                            <!-- „Ç∞„É™„ÉÉ„Éâ„ÅØJavaScript„ÅßÁîüÊàê -->
                        </div>
                    </div>

                    <!-- Âª∫Ë®≠„Ç™„Éó„Ç∑„Éß„É≥ -->
                    <div>
                        <h4>Âª∫Ë®≠ÂèØËÉΩ„Å™ÊñΩË®≠</h4>
                        <div class="build-options" id="buildOptions">
                            <!-- Âª∫Ë®≠„Ç™„Éó„Ç∑„Éß„É≥„ÅØJavaScript„ÅßÁîüÊàê -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- AR„Éó„É¨„Éì„É•„Éº -->
            <div class="ar-preview">
                <h3>üëÅÔ∏è ARÈÉΩÂ∏Ç„Éó„É¨„Éì„É•„Éº</h3>
                <p>„Çπ„Éû„Éº„Éà„Éï„Ç©„É≥„ÇíÂãï„Åã„Åó„Å¶ÈÉΩÂ∏Ç„Çí360Â∫¶Ë¶ã„Å¶„Åø„Çà„ÅÜ</p>
                <div class="ar-viewport" id="arViewport">
                    <div style="text-align: center;">
                        <div style="font-size: 3em; margin-bottom: 10px;">üì±</div>
                        <p>ARÊ©üËÉΩ„ÇíÊúâÂäπ„Å´„Åô„Çã„Å´„ÅØ<br>„Çπ„Éû„Éº„Éà„Éï„Ç©„É≥„ÅßË°®Á§∫„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                    </div>
                </div>
                <button class="btn btn-ar" onclick="simulateAR()">üéÆ AR„Çí„Ç∑„Éü„É•„É¨„Éº„Éà</button>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-secondary" onclick="showScreen('countrySelect')">üåç ÂõΩ„ÇíÊé¢Ê§ú</button>
                <button class="btn" onclick="nextTurn()">‚è≠Ô∏è Ê¨°„ÅÆ„Çø„Éº„É≥</button>
                <button class="btn" onclick="showScreen('cardCollection')">üÉè „Ç´„Éº„ÉâÂõ≥Èëë</button>
            </div>
        </div>

        <!-- „Ç´„Éº„Éâ„Ç≥„É¨„ÇØ„Ç∑„Éß„É≥ÁîªÈù¢ -->
        <div id="cardCollection" class="screen">
            <div class="header">
                <h1>üÉè SDGs„Ç´„Éº„Éâ„Ç≥„É¨„ÇØ„Ç∑„Éß„É≥</h1>
                <p>ÈõÜ„ÇÅ„Åü„Ç´„Éº„Éâ„ÅßÊñ∞„Åó„ÅÑÊäÄË°ì„ÇíÈñãÁô∫„Åó„Çà„ÅÜ</p>
            </div>

            <div class="resources-bar">
                <div class="resource">
                    <div>üÉè</div>
                    <div class="resource-value" id="totalCards">0/12</div>
                    <div>ÂèéÈõÜ„Ç´„Éº„Éâ</div>
                </div>
                <div class="resource">
                    <div>üèÜ</div>
                    <div class="resource-value" id="completion">0%</div>
                    <div>„Ç≥„É≥„Éó„É™„Éº„ÉàÁéá</div>
                </div>
            </div>

            <div class="cards-container" id="cardsContainer">
                <!-- „Ç´„Éº„Éâ„ÅØJavaScript„ÅßÁîüÊàê -->
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="showScreen('countrySelect')">üåç ÂõΩ„ÇíÊé¢Ê§ú</button>
                <button class="btn btn-secondary" onclick="showScreen('cityBuilder')">üèôÔ∏è ÈÉΩÂ∏ÇÂª∫Ë®≠</button>
            </div>
        </div>
    </div>

    <script>
        // „Ç≤„Éº„É†Áä∂ÊÖã
        const gameState = {
            currentScreen: 'startScreen',
            resources: {
                money: 1000000,
                environment: 50,
                happiness: 65,
                energy: 75
            },
            visitedCountries: {},
            collectedCards: [],
            builtFacilities: [],
            currentTurn: 1,
            selectedCell: null
        };

        // ÂõΩ„ÅÆ„Éá„Éº„Çø
        const countries = {
            japan: {
                name: 'Êó•Êú¨',
                flag: 'üáØüáµ',
                description: 'È´òÂ∫¶„Å™ÊäÄË°ì„Å®‰ºùÁµ±„ÅÆË™øÂíå„ÅßÊåÅÁ∂öÂèØËÉΩ„Å™Á§æ‰ºö„ÇíÂÆüÁèæ',
                cards: [
                    { id: 'japan_recycling', name: '„Åî„ÅøÂàÜÂà•„Ç∑„Çπ„ÉÜ„É†', icon: 'üóëÔ∏è', rarity: 'rare', description: 'Á¥∞„Åã„ÅÑÂàÜÂà•„Åß„É™„Çµ„Ç§„ÇØ„É´Áéá80%„ÇíÈÅîÊàê', progress: 0 },
                    { id: 'japan_transit', name: 'ÂÖ¨ÂÖ±‰∫§ÈÄö„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ', icon: 'üöÜ', rarity: 'epic', description: '‰∏ñÁïåÊúÄÈ´ò„É¨„Éô„É´„ÅÆÈâÑÈÅì„Ç∑„Çπ„ÉÜ„É†', progress: 0 },
                    { id: 'japan_disaster', name: 'Èò≤ÁÅΩÊäÄË°ì', icon: 'üèØ', rarity: 'rare', description: 'Âú∞ÈúáÂØæÁ≠ñ„Å®Êó©ÊúüË≠¶Êàí„Ç∑„Çπ„ÉÜ„É†', progress: 0 }
                ]
            },
            singapore: {
                name: '„Ç∑„É≥„Ç¨„Éù„Éº„É´',
                flag: 'üá∏üá¨',
                description: 'Èôê„Çâ„Çå„ÅüË≥áÊ∫ê„ÇíÈÄÜÊâã„Å´Âèñ„Å£„ÅüÈù©Êñ∞ÁöÑ„Å™Ëß£Ê±∫Á≠ñ',
                cards: [
                    { id: 'singapore_water', name: 'NEWater', icon: 'üíß', rarity: 'epic', description: '‰∏ãÊ∞¥„ÅÆÈ´òÂ∫¶ÂÜçÁîü„ÅßÊ∞¥„ÅÆ40%„Çí‰æõÁµ¶', progress: 0 },
                    { id: 'singapore_green', name: '„Ç¨„Éº„Éá„É≥„Ç∑„ÉÜ„Ç£', icon: 'üåø', rarity: 'rare', description: 'ÂõΩÂúü„ÅÆ47%„ÅåÁ∑ëÂú∞', progress: 0 }
                ]
            },
            germany: {
                name: '„Éâ„Ç§„ÉÑ',
                flag: 'üá©üá™',
                description: '„Ç®„Éç„É´„ÇÆ„ÉºËª¢Êèõ„ÅßÊåÅÁ∂öÂèØËÉΩ„Å™Êú™Êù•„ÇíÂÖàÂ∞é',
                cards: [
                    { id: 'germany_energy', name: '„Ç®„Éç„É´„ÇÆ„ÉºËª¢Êèõ', icon: '‚ö°', rarity: 'epic', description: 'ÂÜçÁîüÂèØËÉΩ„Ç®„Éç„É´„ÇÆ„Éº46%„ÇíÈÅîÊàê', progress: 0 },
                    { id: 'germany_recycling', name: '„Éá„Éù„Ç∏„ÉÉ„ÉàÂà∂Â∫¶', icon: '‚ôªÔ∏è', rarity: 'common', description: 'ÂÆπÂô®„ÅÆÂõûÂèéÁéá98%„ÇíÂÆüÁèæ', progress: 0 }
                ]
            },
            rwanda: {
                name: '„É´„ÉØ„É≥„ÉÄ',
                flag: 'üá∑üáº',
                description: 'Âé≥Ê†º„Å™ÊîøÁ≠ñ„Åß„Ç¢„Éï„É™„Ç´„ÅÆÊ®°ÁØÑÂõΩ„Å´',
                cards: [
                    { id: 'rwanda_plastic', name: '„Éó„É©„Çπ„ÉÅ„ÉÉ„ÇØÁ¶ÅÊ≠¢', icon: 'üö´', rarity: 'common', description: '2008Âπ¥„Çà„Çä„Éì„Éã„Éº„É´Ë¢ã„ÇíÂÖ®Èù¢Á¶ÅÊ≠¢', progress: 0 },
                    { id: 'rwanda_clean', name: 'Ê∏ÖÊΩîÊîøÁ≠ñ', icon: '‚ú®', rarity: 'rare', description: '„Ç¢„Éï„É™„Ç´„ÅßÊúÄ„ÇÇÊ∏ÖÊΩî„Å™ÈÉΩÂ∏Ç„Å´', progress: 0 }
                ]
            }
        };

        // Âª∫Ë®≠ÂèØËÉΩ„Å™ÊñΩË®≠
        const facilities = {
            solar: { name: 'Â§™ÈôΩÂÖâÁô∫ÈõªÊâÄ', icon: '‚òÄÔ∏è', cost: 200000, effects: { energy: 20, environment: 15 }, requirements: [] },
            wind: { name: 'È¢®ÂäõÁô∫Èõª', icon: 'üå¨Ô∏è', cost: 300000, effects: { energy: 25, environment: 20 }, requirements: [] },
            recycling: { name: '„É™„Çµ„Ç§„ÇØ„É´ÊñΩË®≠', icon: '‚ôªÔ∏è', cost: 150000, effects: { environment: 25, happiness: 5 }, requirements: ['japan_recycling'] },
            park: { name: 'ÈÉΩÂ∏ÇÂÖ¨Âúí', icon: 'üå≥', cost: 100000, effects: { happiness: 15, environment: 10 }, requirements: [] },
            research: { name: 'Áí∞Â¢ÉÁ†îÁ©∂ÊâÄ', icon: 'üî¨', cost: 500000, effects: { happiness: 10, energy: 10, environment: 20 }, requirements: [] }
        };

        // ÁîªÈù¢Ë°®Á§∫
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
            gameState.currentScreen = screenId;
            
            if (screenId === 'cityBuilder') {
                initializeCityBuilder();
            } else if (screenId === 'cardCollection') {
                updateCardCollection();
            }
        }

        // Â§ßÈô∏Ë°®Á§∫Âàá„ÇäÊõø„Åà
        function showContinent(continent) {
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            document.querySelectorAll('.card').forEach(card => {
                card.style.display = 'none';
            });
            document.querySelectorAll('.continent-' + continent).forEach(card => {
                card.style.display = 'block';
            });
        }

        // ÂõΩ„ÇíË®™Âïè
        function visitCountry(countryId) {
            const country = countries[countryId];
            if (!gameState.visitedCountries[countryId]) {
                gameState.visitedCountries[countryId] = { progress: 0, cards: {} };
            }
            
            // ÂõΩË©≥Á¥∞ÁîªÈù¢„ÇíË°®Á§∫
            document.getElementById('detailFlag').textContent = country.flag;
            document.getElementById('detailCountryName').textContent = country.name;
            document.getElementById('detailCountryDescription').textContent = country.description;
            
            // „Ç´„Éº„Éâ„ÇíË°®Á§∫
            const cardsContainer = document.getElementById('countryCards');
            cardsContainer.innerHTML = '';
            
            country.cards.forEach(card => {
                const cardProgress = gameState.visitedCountries[countryId].cards[card.id] || 0;
                const cardEl = document.createElement('div');
                cardEl.className = `card ${cardProgress >= 100 ? '' : 'disabled'}`;
                cardEl.innerHTML = `
                    <div class="card-rarity rarity-${card.rarity}">${getRarityText(card.rarity)}</div>
                    <div class="card-icon">${card.icon}</div>
                    <h3>${card.name}</h3>
                    <p>${card.description}</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${cardProgress}%"></div>
                    </div>
                    <small>${cardProgress >= 100 ? '‚úÖ Áç≤ÂæóÊ∏à„Åø' : `${cardProgress}% Ë™øÊüªÂÆå‰∫Ü`}</small>
                `;
                
                if (cardProgress < 100) {
                    cardEl.onclick = () => studyCard(countryId, card.id);
                }
                
                cardsContainer.appendChild(cardEl);
            });
            
            updateCountryProgress(countryId);
            showScreen('countryDetail');
        }

        // „Ç´„Éº„Éâ„ÇíË™øÊüª
        function studyCard(countryId, cardId) {
            const country = gameState.visitedCountries[countryId];
            if (!country.cards[cardId]) {
                country.cards[cardId] = 0;
            }
            
            country.cards[cardId] += 25;
            
            if (country.cards[cardId] >= 100) {
                // „Ç´„Éº„ÉâÁç≤Âæó
                const cardData = countries[countryId].cards.find(c => c.id === cardId);
                if (!gameState.collectedCards.find(c => c.id === cardId)) {
                    gameState.collectedCards.push({
                        id: cardId,
                        name: cardData.name,
                        icon: cardData.icon,
                        rarity: cardData.rarity,
                        description: cardData.description,
                        country: countryId
                    });
                    showNotification(`üéâ „Ç´„Éº„Éâ„Äå${cardData.name}„Äç„ÇíÁç≤Âæó„Åó„Åæ„Åó„ÅüÔºÅ`);
                }
            }
            
            updateCountryProgress(countryId);
            visitCountry(countryId); // ÁîªÈù¢„ÇíÊõ¥Êñ∞
        }

        // ÂõΩ„ÅÆÈÄ≤Êçó„ÇíÊõ¥Êñ∞
        function updateCountryProgress(countryId) {
            const country = gameState.visitedCountries[countryId];
            const totalCards = countries[countryId].cards.length;
            let completed = 0;
            let totalProgress = 0;
            
            countries[countryId].cards.forEach(card => {
                const progress = country.cards[card.id] || 0;
                totalProgress += progress;
                if (progress >= 100) completed++;
            });
            
            const avgProgress = totalProgress / totalCards;
            document.getElementById('detailProgress').style.width = avgProgress + '%';
            document.getElementById('detailProgressText').textContent = `${Math.round(avgProgress)}% ÂÆå‰∫Ü (${completed}/${totalCards} „Ç´„Éº„ÉâÁç≤Âæó)`;
        }

        // „Åï„Çâ„Å´Êé¢Ê§ú
        function continueExploration() {
            showNotification('üîç „Åï„Çâ„Å´Ë©≥„Åó„ÅèË™øÊüª„ÇíÁ∂ö„Åë„Å¶„ÅÑ„Åæ„Åô...');
            // „Åì„Åì„ÅßËøΩÂä†„ÅÆË™øÊüª„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíË°®Á§∫„Åß„Åç„Çã
        }

        // ÈÉΩÂ∏ÇÂª∫Ë®≠„ÅÆÂàùÊúüÂåñ
        function initializeCityBuilder() {
            initializeCityGrid();
            updateBuildOptions();
            updateResourceDisplay();
            initializeARView();
        }

        // ÈÉΩÂ∏Ç„Ç∞„É™„ÉÉ„Éâ„ÅÆÂàùÊúüÂåñ
        function initializeCityGrid() {
            const grid = document.getElementById('cityGrid');
            grid.innerHTML = '';
            
            for (let i = 0; i < 36; i++) {
                const cell = document.createElement('div');
                cell.className = 'grid-cell';
                cell.innerHTML = 'Ôºã';
                cell.onclick = () => selectGridCell(i, cell);
                grid.appendChild(cell);
            }
        }

        // „Ç∞„É™„ÉÉ„Éâ„Çª„É´ÈÅ∏Êäû
        function selectGridCell(index, cellElement) {
            document.querySelectorAll('.grid-cell').forEach(cell => {
                cell.classList.remove('selected');
            });
            
            cellElement.classList.add('selected');
            gameState.selectedCell = index;
            
            showNotification('üìç Âª∫Ë®≠Â†¥ÊâÄ„ÇíÈÅ∏Êäû„Åó„Åæ„Åó„Åü');
        }

        // Âª∫Ë®≠„Ç™„Éó„Ç∑„Éß„É≥„ÅÆÊõ¥Êñ∞
        function updateBuildOptions() {
            const container = document.getElementById('buildOptions');
            container.innerHTML = '';
            
            Object.entries(facilities).forEach(([id, facility]) => {
                const canBuild = canBuildFacility(id);
                const option = document.createElement('div');
                option.className = `build-option ${canBuild ? 'available' : ''}`;
                option.innerHTML = `
                    <div style="font-size: 2em; margin-bottom: 10px;">${facility.icon}</div>
                    <h4>${facility.name}</h4>
                    <p>üí∞ ${facility.cost.toLocaleString()}</p>
                    <div style="font-size: 0.9em; opacity: 0.8;">
                        ${canBuild ? '‚úÖ Âª∫Ë®≠ÂèØËÉΩ' : '‚ùå Êù°‰ª∂Êú™ÈÅîÊàê'}
                    </div>
                `;
                
                if (canBuild) {
                    option.onclick = () => buildFacility(id);
                }
                
                container.appendChild(option);
            });
        }

        // ÊñΩË®≠Âª∫Ë®≠„ÅÆÊù°‰ª∂„ÉÅ„Çß„ÉÉ„ÇØ
        function canBuildFacility(facilityId) {
            const facility = facilities[facilityId];
            return facility.requirements.every(req => 
                gameState.collectedCards.some(card => card.id === req)
            );
        }

        // ÊñΩË®≠„ÇíÂª∫Ë®≠
        function buildFacility(facilityId) {
            if (gameState.selectedCell === null) {
                showNotification('‚ùå „Åæ„ÅöÂª∫Ë®≠Â†¥ÊâÄ„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            const facility = facilities[facilityId];
            
            if (gameState.resources.money < facility.cost) {
                showNotification('‚ùå ‰∫àÁÆó„ÅåË∂≥„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            // Âª∫Ë®≠Âá¶ÁêÜ
            gameState.resources.money -= facility.cost;
            Object.entries(facility.effects).forEach(([resource, value]) => {
                gameState.resources[resource] = Math.min(100, gameState.resources[resource] + value);
            });
            
            // „Ç∞„É™„ÉÉ„ÉâÊõ¥Êñ∞
            const cell = document.querySelectorAll('.grid-cell')[gameState.selectedCell];
            cell.classList.add('built');
            cell.innerHTML = facility.icon;
            cell.title = facility.name;
            
            gameState.builtFacilities.push({
                id: facilityId,
                cell: gameState.selectedCell,
                name: facility.name
            });
            
            updateResourceDisplay();
            updateBuildOptions();
            updateARView();
            showNotification(`üèóÔ∏è ${facility.name}„ÇíÂª∫Ë®≠„Åó„Åæ„Åó„ÅüÔºÅ`);
            
            gameState.selectedCell = null;
            document.querySelectorAll('.grid-cell').forEach(cell => {
                cell.classList.remove('selected');
            });
        }

        // „É™„ÇΩ„Éº„ÇπË°®Á§∫„ÅÆÊõ¥Êñ∞
        function updateResourceDisplay() {
            document.getElementById('money').textContent = gameState.resources.money.toLocaleString();
            document.getElementById('environment').textContent = gameState.resources.environment + '%';
            document.getElementById('happiness').textContent = gameState.resources.happiness + '%';
            document.getElementById('energy').textContent = gameState.resources.energy + '%';
        }

        // Ê¨°„ÅÆ„Çø„Éº„É≥
        function nextTurn() {
            gameState.currentTurn++;
            gameState.resources.money += 50000; // „Çø„Éº„É≥ÂèéÂÖ•
            
            // „É©„É≥„ÉÄ„É†„Ç§„Éô„É≥„Éà
            const events = [
                { message: 'üåßÔ∏è Â§ßÈõ®„Åß„Ç®„Éç„É´„ÇÆ„ÉºÁîüÁî£„ÅåÂ¢óÂä†', effect: { energy: 10 } },
                { message: 'üéâ Â∏ÇÊ∞ëÁ•≠„Çä„ÅßÂπ∏Á¶èÂ∫¶‰∏äÊòá', effect: { happiness: 8 } },
                { message: 'üìà Ë¶≥ÂÖâÂÆ¢„ÅåÂ¢óÂä†', effect: { money: 100000 } },
                { message: 'üå™Ô∏è Âµê„ÅßÊñΩË®≠„ÅåË¢´ÂÆ≥', effect: { energy: -15, happiness: -5 } }
            ];
            
            const randomEvent = events[Math.floor(Math.random() * events.length)];
            showNotification(randomEvent.message);
            
            // ÂäπÊûúÈÅ©Áî®
            Object.keys(randomEvent.effect).forEach(resource => {
                if (resource === 'money') {
                    gameState.resources[resource] += randomEvent.effect[resource];
                } else {
                    gameState.resources[resource] = Math.max(0, 
                        Math.min(100, gameState.resources[resource] + randomEvent.effect[resource])
                    );
                }
            });
            
            updateResourceDisplay();
            showNotification(`‚è∞ „Çø„Éº„É≥ ${gameState.currentTurn} „ÅåÁµÇ‰∫Ü„Åó„Åæ„Åó„Åü`);
        }

        // AR„Éì„É•„Éº„ÅÆÂàùÊúüÂåñ
        function initializeARView() {
            updateARView();
        }

        // AR„Éì„É•„Éº„ÅÆÊõ¥Êñ∞
        function updateARView() {
            const viewport = document.getElementById('arViewport');
            viewport.innerHTML = '';
            
            gameState.builtFacilities.forEach((facility, index) => {
                const building = document.createElement('div');
                building.className = 'ar-building';
                building.innerHTML = facilities[facility.id].icon;
                building.style.fontSize = '2em';
                building.style.left = (20 + (index % 3) * 30) + '%';
                building.style.bottom = (20 + Math.floor(index / 3) * 25) + '%';
                building.title = facility.name;
                viewport.appendChild(building);
            });
            
            if (gameState.builtFacilities.length === 0) {
                viewport.innerHTML = `
                    <div style="text-align: center;">
                        <div style="font-size: 3em; margin-bottom: 10px;">üèóÔ∏è</div>
                        <p>ÊñΩË®≠„ÇíÂª∫Ë®≠„Åô„Çã„Å®„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô</p>
                    </div>
                `;
            }
        }

        // AR„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥
        function simulateAR() {
            showNotification('üéÆ AR„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„ÇíÈñãÂßã... „Çπ„Éû„Éº„Éà„Éï„Ç©„É≥„ÅßÂÆüÈöõ„ÅÆAR‰ΩìÈ®ì„Çí„ÅäÊ•Ω„Åó„Åø„Åè„Å†„Åï„ÅÑÔºÅ');
            document.getElementById('arViewport').style.background = 'linear-gradient(45deg, #00b894, #0984e3)';
            setTimeout(() => {
                document.getElementById('arViewport').style.background = 'linear-gradient(45deg, #1a2a6c, #b21f1f)';
            }, 2000);
        }

        // „Ç´„Éº„Éâ„Ç≥„É¨„ÇØ„Ç∑„Éß„É≥„ÅÆÊõ¥Êñ∞
        function updateCardCollection() {
            const container = document.getElementById('cardsContainer');
            const totalCards = document.getElementById('totalCards');
            const completion = document.getElementById('completion');
            
            container.innerHTML = '';
            
            // „Åô„Åπ„Å¶„ÅÆÂõΩ„ÅÆ„Ç´„Éº„Éâ„ÇíË°®Á§∫
            Object.values(countries).forEach(country => {
                country.cards.forEach(card => {
                    const collected = gameState.collectedCards.find(c => c.id === card.id);
                    const cardEl = document.createElement('div');
                    cardEl.className = `card ${collected ? '' : 'disabled'}`;
                    cardEl.innerHTML = `
                        <div class="card-rarity rarity-${card.rarity}">${getRarityText(card.rarity)}</div>
                        <div class="card-icon">${card.icon}</div>
                        <h3>${card.name}</h3>
                        <p>${card.description}</p>
                        <div style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">
                            ${collected ? '‚úÖ ÊâÄÊåÅÊ∏à„Åø' : 'üîí Êú™Áç≤Âæó'}
                        </div>
                    `;
                    container.appendChild(cardEl);
                });
            });
            
            // Áµ±Ë®àÊõ¥Êñ∞
            const totalCardCount = Object.values(countries).reduce((sum, country) => sum + country.cards.length, 0);
            const collectedCount = gameState.collectedCards.length;
            totalCards.textContent = `${collectedCount}/${totalCardCount}`;
            completion.textContent = `${Math.round((collectedCount / totalCardCount) * 100)}%`;
        }

        // „É¨„Ç¢„É™„ÉÜ„Ç£„ÉÜ„Ç≠„Çπ„Éà
        function getRarityText(rarity) {
            const texts = { common: '„Éé„Éº„Éû„É´', rare: '„É¨„Ç¢', epic: '„Ç®„Éî„ÉÉ„ÇØ' };
            return texts[rarity] || rarity;
        }

        // ÈÄöÁü•Ê©üËÉΩ
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }

        // ÂàùÊúüÂåñ
        window.onload = function() {
            showNotification('üéÆ SDGs World Builder„ÇíÈñãÂßã„Åó„Åæ„Åó„ÅüÔºÅ');
        };
    </script>
</body>
</html>
