<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDGs World Builder - Multiplayer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .app-container {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* 3Dãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ */
        .city-3d-view {
            width: 100%;
            height: 400px;
            background: linear-gradient(45deg, #2d3436, #636e72);
            border-radius: 15px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }

        .building-3d {
            position: absolute;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 5px 5px 0 0;
            transition: all 0.5s ease;
        }

        .building-3d:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 25px rgba(255, 255, 255, 0.3);
        }

        /* ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ */
        .multiplayer-panel {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #74b9ff;
        }

        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .player-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .player-card.online {
            border: 2px solid #00b894;
        }

        .player-card.offline {
            opacity: 0.6;
        }

        .player-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
        }

        /* ä»®æƒ³é€šè²¨ */
        .crypto-market {
            background: rgba(253, 203, 110, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #fdcb6e;
        }

        .crypto-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .crypto-coin {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .coin-price {
            font-size: 1.3em;
            font-weight: bold;
            margin: 8px 0;
        }

        .price-up { color: #00b894; }
        .price-down { color: #ff7675; }

        /* AIã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼ */
        .ai-advisor {
            background: rgba(116, 185, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #74b9ff;
            position: relative;
        }

        .ai-message {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #74b9ff;
        }

        .ai-typing {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: #74b9ff;
            border-radius: 50%;
            margin-left: 5px;
            animation: typing 1s infinite;
        }

        @keyframes typing {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿ */
        .live-data {
            background: rgba(0, 184, 148, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #00b894;
        }

        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .data-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .data-value {
            font-size: 1.4em;
            font-weight: bold;
            margin: 5px 0;
        }

        /* å–å¼•å¸‚å ´ */
        .marketplace {
            background: rgba(108, 92, 231, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #6c5ce7;
        }

        .market-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .market-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .market-item:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.15);
        }

        .item-price {
            color: #fdcb6e;
            font-weight: bold;
            font-size: 1.2em;
        }

        /* ãƒãƒ£ãƒƒãƒˆã‚·ã‚¹ãƒ†ãƒ  */
        .chat-panel {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            height: 300px;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            margin-bottom: 15px;
        }

        .chat-message {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 10px 15px;
            margin: 8px 0;
            max-width: 80%;
        }

        .chat-message.own {
            background: rgba(116, 185, 255, 0.3);
            margin-left: auto;
        }

        .chat-input {
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex-grow: 1;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 8px;
            padding: 12px;
            color: white;
        }

        /* å”åŠ›ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ */
        .coop-projects {
            background: rgba(214, 48, 49, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #d63031;
        }

        .project-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #d63031;
        }

        .project-progress {
            margin: 10px 0;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–èª¿æ•´ */
        @media (max-width: 768px) {
            .players-grid,
            .crypto-grid,
            .data-grid,
            .market-items {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* æ—¢å­˜ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç¶™æ‰¿ */
        .screen { display: none; }
        .screen.active { display: block; }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; background: linear-gradient(45deg, #00b894, #00cec9); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .nav-tabs { display: flex; gap: 10px; margin: 20px 0; flex-wrap: wrap; }
        .nav-tab { padding: 12px 20px; background: rgba(255,255,255,0.1); border-radius: 10px; cursor: pointer; transition: all 0.3s ease; border: 2px solid transparent; }
        .nav-tab.active { background: #00b894; border-color: #00cec9; }
        .btn { background: linear-gradient(45deg, #00b894, #00cec9); color: white; border: none; padding: 12px 25px; border-radius: 10px; cursor: pointer; font-weight: bold; transition: all 0.3s ease; margin: 5px; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,184,148,0.4); }
        .btn-secondary { background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.3); }
        .notification { position: fixed; top: 20px; right: 20px; background: linear-gradient(135deg, #00b894, #00a085); color: white; padding: 15px 25px; border-radius: 10px; z-index: 1000; animation: slideIn 0.5s ease; box-shadow: 0 8px 25px rgba(0,0,0,0.3); }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒãƒ– -->
        <div id="multiplayerHub" class="screen active">
            <div class="header">
                <h1>ğŸŒ SDGs ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯</h1>
                <p>ä¸–ç•Œä¸­ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨å”åŠ›ã—ã¦æŒç¶šå¯èƒ½ãªæœªæ¥ã‚’å‰µã‚ã†</p>
            </div>

            <!-- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿ -->
            <div class="live-data">
                <h3>ğŸ“Š ã‚°ãƒ­ãƒ¼ãƒãƒ«çµ±è¨ˆï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ï¼‰</h3>
                <div class="data-grid">
                    <div class="data-item">
                        <div>ğŸŒ ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</div>
                        <div class="data-value" id="onlinePlayers">1,247</div>
                        <div>ä¸–ç•Œä¸­ã§æ¥ç¶šä¸­</div>
                    </div>
                    <div class="data-item">
                        <div>ğŸ™ï¸ å»ºè¨­ã•ã‚ŒãŸéƒ½å¸‚</div>
                        <div class="data-value" id="totalCities">8,956</div>
                        <div>æŒç¶šå¯èƒ½ãªéƒ½å¸‚</div>
                    </div>
                    <div class="data-item">
                        <div>âš¡ ç¯€ç´„ã•ã‚ŒãŸã‚¨ãƒãƒ«ã‚®ãƒ¼</div>
                        <div class="data-value" id="savedEnergy">2.4TWh</div>
                        <div>ç›¸å½“äºåŸå­åŠ›ç™ºé›»æ‰€2åŸºåˆ†</div>
                    </div>
                    <div class="data-item">
                        <div>ğŸŒ¿ å‰Šæ¸›ã•ã‚ŒãŸCO2</div>
                        <div class="data-value" id="reducedCO2">1.8Mt</div>
                        <div>è‡ªå‹•è»Š38ä¸‡å°åˆ†</div>
                    </div>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
                <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
                <div>
                    <!-- 3Déƒ½å¸‚ãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ -->
                    <div class="city-3d-view" id="city3dView">
                        <!-- 3Då»ºç‰©ã¯JavaScriptã§ç”Ÿæˆ -->
                    </div>

                    <!-- å”åŠ›ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ -->
                    <div class="coop-projects">
                        <h3>ğŸ¤ å”åŠ›ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</h3>
                        <div class="project-card">
                            <h4>ğŸŒŠ å¤ªå¹³æ´‹ã”ã¿ãƒ™ãƒ«ãƒˆæ¸…æƒä½œæˆ¦</h4>
                            <div class="project-progress">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span>é€²æ—çŠ¶æ³</span>
                                    <span>68%</span>
                                </div>
                                <div style="height: 8px; background: rgba(255,255,255,0.2); border-radius: 4px; overflow: hidden;">
                                    <div style="height: 100%; width: 68%; background: #00b894; border-radius: 4px;"></div>
                                </div>
                            </div>
                            <p>ç›®æ¨™: 1,000ãƒˆãƒ³ã®æµ·æ´‹ãƒ—ãƒ©ã‚¹ãƒãƒƒã‚¯å›å</p>
                            <div style="display: flex; gap: 10px; margin-top: 10px;">
                                <button class="btn" onclick="joinProject('ocean_cleanup')">å‚åŠ ã™ã‚‹</button>
                                <button class="btn btn-secondary" onclick="donateToProject('ocean_cleanup')">ğŸ’° å¯„ä»˜ã™ã‚‹</button>
                            </div>
                        </div>

                        <div class="project-card">
                            <h4>ğŸŒ³ ã‚¢ãƒã‚¾ãƒ³å†æ¤æ—ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</h4>
                            <div class="project-progress">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span>é€²æ—çŠ¶æ³</span>
                                    <span>42%</span>
                                </div>
                                <div style="height: 8px; background: rgba(255,255,255,0.2); border-radius: 4px; overflow: hidden;">
                                    <div style="height: 100%; width: 42%; background: #00b894; border-radius: 4px;"></div>
                                </div>
                            </div>
                            <p>ç›®æ¨™: 100ä¸‡æœ¬ã®æ¤æ¨¹</p>
                            <button class="btn" onclick="joinProject('reforestation')">å‚åŠ ã™ã‚‹</button>
                        </div>
                    </div>
                </div>

                <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
                <div>
                    <!-- ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ -->
                    <div class="multiplayer-panel">
                        <h3>ğŸ‘¥ ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</h3>
                        <div class="players-grid" id="playersGrid">
                            <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚«ãƒ¼ãƒ‰ã¯JavaScriptã§ç”Ÿæˆ -->
                        </div>
                    </div>

                    <!-- ä»®æƒ³é€šè²¨å¸‚å ´ -->
                    <div class="crypto-market">
                        <h3>ğŸ’° SDGsãƒˆãƒ¼ã‚¯ãƒ³ç›¸å ´</h3>
                        <div class="crypto-grid">
                            <div class="crypto-coin">
                                <div>ğŸŒ¿ ECO</div>
                                <div class="coin-price price-up">Â¥245.6</div>
                                <div>+2.3%</div>
                            </div>
                            <div class="crypto-coin">
                                <div>ğŸ’§ WTR</div>
                                <div class="coin-price price-up">Â¥187.9</div>
                                <div>+1.8%</div>
                            </div>
                            <div class="crypto-coin">
                                <div>âš¡ NRG</div>
                                <div class="coin-price price-down">Â¥312.4</div>
                                <div>-0.7%</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AIã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼ -->
            <div class="ai-advisor">
                <h3>ğŸ¤– AI SDGsã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼</h3>
                <div class="ai-message">
                    <strong>ã‚¢ãƒ‰ãƒã‚¤ã‚¹:</strong> ã‚ãªãŸã®éƒ½å¸‚ã¯ã‚¨ãƒãƒ«ã‚®ãƒ¼åŠ¹ç‡ãŒå„ªã‚Œã¦ã„ã¾ã™ãŒã€æ°´è³‡æºç®¡ç†ã«æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ã€‚ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ«ã®NEWateræŠ€è¡“ã‚’å°å…¥ã—ã¦ã¿ã¦ã¯ã„ã‹ãŒã§ã—ã‚‡ã†ã‹ï¼Ÿ
                </div>
                <div class="ai-message">
                    <strong>å¸‚å ´åˆ†æ:</strong> ECOãƒˆãƒ¼ã‚¯ãƒ³ãŒä¸Šæ˜‡å‚¾å‘ã«ã‚ã‚Šã¾ã™ã€‚ç’°å¢ƒãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã®æŠ•è³‡ãŒå¢—åŠ ã—ã¦ã„ã‚‹ãŸã‚ã§ã™ã€‚
                </div>
                <button class="btn" onclick="askAIAdvice()">ğŸ¯ æ–°ã—ã„ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’æ±‚ã‚ã‚‹</button>
                <span class="ai-typing"></span>
            </div>

            <!-- ãƒãƒ£ãƒƒãƒˆã‚·ã‚¹ãƒ†ãƒ  -->
            <div class="chat-panel">
                <h3>ğŸ’¬ ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒ£ãƒƒãƒˆ</h3>
                <div class="chat-messages" id="chatMessages">
                    <div class="chat-message">
                        <strong>Tokyo_Planter:</strong> æ—¥æœ¬ã®å±‹ä¸Šç·‘åŒ–æŠ€è¡“ã‚’å…±æœ‰ã—ã¾ã™ï¼
                    </div>
                    <div class="chat-message">
                        <strong>Berlin_Energy:</strong> ãƒ‰ã‚¤ãƒ„ã®ã‚¹ãƒãƒ¼ãƒˆã‚°ãƒªãƒƒãƒ‰ãƒ‡ãƒ¼ã‚¿ãŒå¿…è¦ãªæ–¹ã¯ã„ã¾ã™ã‹ï¼Ÿ
                    </div>
                    <div class="chat-message own">
                        <strong>ã‚ãªãŸ:</strong> ãƒ«ãƒ¯ãƒ³ãƒ€ã®ã”ã¿æ”¿ç­–ã«ã¤ã„ã¦è©³ã—ãçŸ¥ã‚ŠãŸã„ã§ã™
                    </div>
                </div>
                <div class="chat-input">
                    <input type="text" id="chatInput" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›...">
                    <button class="btn" onclick="sendChatMessage()">é€ä¿¡</button>
                </div>
            </div>

            <!-- å–å¼•å¸‚å ´ -->
            <div class="marketplace">
                <h3>ğŸ›’ SDGsæŠ€è¡“å¸‚å ´</h3>
                <div class="market-items">
                    <div class="market-item">
                        <h4>ğŸ‡¯ğŸ‡µ æ—¥æœ¬ã®å¤ªé™½å…‰æŠ€è¡“</h4>
                        <p>å¤‰æ›åŠ¹ç‡23%ã®æœ€æ–°ãƒ‘ãƒãƒ«</p>
                        <div class="item-price">ECO 1,200</div>
                        <button class="btn" onclick="buyItem('japan_solar')">è³¼å…¥</button>
                    </div>
                    <div class="market-item">
                        <h4>ğŸ‡©ğŸ‡ª ãƒ‰ã‚¤ãƒ„ã®é¢¨åŠ›ãƒ‡ãƒ¼ã‚¿</h4>
                        <p>10å¹´é–“ã®é‹ç”¨ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ</p>
                        <div class="item-price">WTR 850</div>
                        <button class="btn" onclick="buyItem('germany_wind')">è³¼å…¥</button>
                    </div>
                    <div class="market-item">
                        <h4>ğŸ‡¸ğŸ‡¬ ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ«æ°´å‡¦ç†</h4>
                        <p>NEWaterã®è¨­è¨ˆå›³</p>
                        <div class="item-price">NRG 2,100</div>
                        <button class="btn" onclick="buyItem('singapore_water')">è³¼å…¥</button>
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="showScreen('cardCollection')">ğŸƒ ã‚«ãƒ¼ãƒ‰å›³é‘‘</button>
                <button class="btn btn-secondary" onclick="showScreen('cityBuilder')">ğŸ™ï¸ å˜ç‹¬ãƒ—ãƒ¬ã‚¤</button>
                <button class="btn" onclick="createCoopRoom()">ğŸ‘¥ å”åŠ›ãƒ«ãƒ¼ãƒ ä½œæˆ</button>
            </div>
        </div>
    </div>

    <script>
        // ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        const multiplayerState = {
            onlinePlayers: [
                { id: 1, name: 'Eco_Warrior', avatar: 'ğŸŒ', country: 'ğŸ‡ºğŸ‡¸', level: 42, online: true },
                { id: 2, name: 'Green_Architect', avatar: 'ğŸ—ï¸', country: 'ğŸ‡©ğŸ‡ª', level: 38, online: true },
                { id: 3, name: 'Water_Guardian', avatar: 'ğŸ’§', country: 'ğŸ‡¸ğŸ‡¬', level: 35, online: true },
                { id: 4, name: 'Solar_Pioneer', avatar: 'â˜€ï¸', country: 'ğŸ‡¯ğŸ‡µ', level: 45, online: false },
                { id: 5, name: 'Forest_Protector', avatar: 'ğŸŒ³', country: 'ğŸ‡§ğŸ‡·', level: 31, online: true }
            ],
            chatMessages: [],
            coopProjects: {
                ocean_cleanup: { progress: 68, participants: 1247, goal: 1000 },
                reforestation: { progress: 42, participants: 892, goal: 1000000 }
            },
            cryptoPrices: {
                ECO: { price: 245.6, change: 2.3 },
                WTR: { price: 187.9, change: 1.8 },
                NRG: { price: 312.4, change: -0.7 }
            },
            userTokens: {
                ECO: 5000,
                WTR: 3200,
                NRG: 1800
            }
        };

        // 3Déƒ½å¸‚ã®å»ºç‰©ãƒ‡ãƒ¼ã‚¿
        const cityBuildings = [
            { type: 'residential', x: 50, width: 80, height: 120, color: '#74b9ff' },
            { type: 'commercial', x: 150, width: 100, height: 180, color: '#a29bfe' },
            { type: 'solar', x: 280, width: 60, height: 40, color: '#fdcb6e' },
            { type: 'park', x: 360, width: 120, height: 30, color: '#00b894' },
            { type: 'recycling', x: 500, width: 90, height: 70, color: '#55efc4' },
            { type: 'research', x: 620, width: 110, height: 150, color: '#ffeaa7' }
        ];

        // åˆæœŸåŒ–
        function initializeMultiplayerHub() {
            render3DCity();
            updateOnlinePlayers();
            startRealTimeUpdates();
            simulateLiveData();
        }

        // 3Déƒ½å¸‚ã®æç”»
        function render3DCity() {
            const container = document.getElementById('city3dView');
            container.innerHTML = '';

            cityBuildings.forEach(building => {
                const buildingEl = document.createElement('div');
                buildingEl.className = 'building-3d';
                buildingEl.style.left = building.x + 'px';
                buildingEl.style.width = building.width + 'px';
                buildingEl.style.height = building.height + 'px';
                buildingEl.style.background = building.color;
                buildingEl.title = getBuildingName(building.type);
                
                container.appendChild(buildingEl);
            });
        }

        function getBuildingName(type) {
            const names = {
                residential: 'ä½å®…åœ°',
                commercial: 'å•†æ¥­ãƒ“ãƒ«',
                solar: 'å¤ªé™½å…‰ç™ºé›»æ‰€',
                park: 'éƒ½å¸‚å…¬åœ’',
                recycling: 'ãƒªã‚µã‚¤ã‚¯ãƒ«æ–½è¨­',
                research: 'ç’°å¢ƒç ”ç©¶æ‰€'
            };
            return names[type] || type;
        }

        // ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è¡¨ç¤º
        function updateOnlinePlayers() {
            const container = document.getElementById('playersGrid');
            container.innerHTML = '';

            multiplayerState.onlinePlayers.forEach(player => {
                const playerEl = document.createElement('div');
                playerEl.className = `player-card ${player.online ? 'online' : 'offline'}`;
                playerEl.innerHTML = `
                    <div class="player-avatar">${player.avatar}</div>
                    <div><strong>${player.name}</strong></div>
                    <div>${player.country} Lv.${player.level}</div>
                    <div style="font-size: 0.8em; opacity: 0.7;">
                        ${player.online ? 'ğŸŸ¢ ã‚ªãƒ³ãƒ©ã‚¤ãƒ³' : 'âš« ã‚ªãƒ•ãƒ©ã‚¤ãƒ³'}
                    </div>
                `;
                playerEl.onclick = () => viewPlayerProfile(player.id);
                container.appendChild(playerEl);
            });
        }

        // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿æ›´æ–°
        function startRealTimeUpdates() {
            // ä»®æƒ³é€šè²¨ä¾¡æ ¼ã®å¤‰å‹•
            setInterval(() => {
                Object.keys(multiplayerState.cryptoPrices).forEach(coin => {
                    const change = (Math.random() - 0.5) * 4;
                    multiplayerState.cryptoPrices[coin].change = parseFloat(change.toFixed(1));
                    multiplayerState.cryptoPrices[coin].price = parseFloat(
                        (multiplayerState.cryptoPrices[coin].price * (1 + change/100)).toFixed(1)
                    );
                });
                updateCryptoDisplay();
            }, 10000);

            // ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•°ã®å¤‰å‹•
            setInterval(() => {
                const change = Math.floor(Math.random() * 21) - 10;
                const current = parseInt(document.getElementById('onlinePlayers').textContent.replace(',', ''));
                document.getElementById('onlinePlayers').textContent = (current + change).toLocaleString();
            }, 15000);
        }

        // ãƒ©ã‚¤ãƒ–ãƒ‡ãƒ¼ã‚¿ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        function simulateLiveData() {
            setInterval(() => {
                // éƒ½å¸‚æ•°ã®å¢—åŠ 
                const cities = parseInt(document.getElementById('totalCities').textContent.replace(',', ''));
                document.getElementById('totalCities').textContent = (cities + Math.floor(Math.random() * 3)).toLocaleString();

                // ã‚¨ãƒãƒ«ã‚®ãƒ¼ç¯€ç´„
                const energy = parseFloat(document.getElementById('savedEnergy').textContent);
                document.getElementById('savedEnergy').textContent = (energy + Math.random() * 0.1).toFixed(1) + 'TWh';

                // CO2å‰Šæ¸›
                const co2 = parseFloat(document.getElementById('reducedCO2').textContent);
                document.getElementById('reducedCO2').textContent = (co2 + Math.random() * 0.05).toFixed(1) + 'Mt';
            }, 8000);
        }

        // ä»®æƒ³é€šè²¨è¡¨ç¤ºæ›´æ–°
        function updateCryptoDisplay() {
            document.querySelectorAll('.crypto-coin').forEach((coin, index) => {
                const coins = Object.keys(multiplayerState.cryptoPrices);
                const coinData = multiplayerState.cryptoPrices[coins[index]];
                
                const priceEl = coin.querySelector('.coin-price');
                priceEl.textContent = `Â¥${coinData.price}`;
                priceEl.className = `coin-price ${coinData.change >= 0 ? 'price-up' : 'price-down'}`;
                
                const changeEl = coin.querySelector('.coin-price').nextElementSibling;
                changeEl.textContent = `${coinData.change >= 0 ? '+' : ''}${coinData.change}%`;
            });
        }

        // ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½
        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message) {
                const chatMessages = document.getElementById('chatMessages');
                const messageEl = document.createElement('div');
                messageEl.className = 'chat-message own';
                messageEl.innerHTML = `<strong>ã‚ãªãŸ:</strong> ${message}`;
                chatMessages.appendChild(messageEl);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                input.value = '';
                
                // è‡ªå‹•è¿”ä¿¡ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
                setTimeout(() => {
                    const replies = [
                        "ã„ã„è³ªå•ã§ã™ã­ï¼ãã®æŠ€è¡“ã«ã¤ã„ã¦è©³ã—ãèª¬æ˜ã—ã¾ã™ã€‚",
                        "ç§ã‚‚ãã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å‚åŠ ã—ã¦ã„ã¾ã™ï¼",
                        "ãã®ãƒ‡ãƒ¼ã‚¿ã‚’æŒã£ã¦ã„ã¾ã™ã€‚å…±æœ‰ã—ã¾ã—ã‚‡ã†ã‹ï¼Ÿ",
                        "ç´ æ™´ã‚‰ã—ã„ã‚¢ã‚¤ãƒ‡ã‚¢ã§ã™ã­ï¼å®Ÿç¾æ–¹æ³•ã‚’è€ƒãˆã¾ã—ã‚‡ã†ã€‚"
                    ];
                    const randomReply = replies[Math.floor(Math.random() * replies.length)];
                    
                    const botMessage = document.createElement('div');
                    botMessage.className = 'chat-message';
                    botMessage.innerHTML = `<strong>Global_Helper:</strong> ${randomReply}`;
                    chatMessages.appendChild(botMessage);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 2000);
            }
        }

        // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‚åŠ 
        function joinProject(projectId) {
            const project = multiplayerState.coopProjects[projectId];
            project.participants++;
            showNotification(`ğŸ¤ ${getProjectName(projectId)}ã«å‚åŠ ã—ã¾ã—ãŸï¼`);
        }

        function donateToProject(projectId) {
            showNotification(`ğŸ’° ${getProjectName(projectId)}ã«ECOãƒˆãƒ¼ã‚¯ãƒ³ã‚’å¯„ä»˜ã—ã¾ã—ãŸï¼`);
            // ã“ã“ã§å®Ÿéš›ã®å¯„ä»˜å‡¦ç†ã‚’å®Ÿè£…
        }

        function getProjectName(projectId) {
            const names = {
                ocean_cleanup: 'å¤ªå¹³æ´‹ã”ã¿ãƒ™ãƒ«ãƒˆæ¸…æƒä½œæˆ¦',
                reforestation: 'ã‚¢ãƒã‚¾ãƒ³å†æ¤æ—ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ'
            };
            return names[projectId] || projectId;
        }

        // AIã‚¢ãƒ‰ãƒã‚¤ã‚¹
        function askAIAdvice() {
            const advice = [
                "æ°´è³‡æºã®åŠ¹ç‡åŒ–ã«ã¯ã€ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ«ã®NEWateræŠ€è¡“ãŒãŠã™ã™ã‚ã§ã™",
                "ã‚¨ãƒãƒ«ã‚®ãƒ¼æ¶ˆè²»ã‚’å‰Šæ¸›ã™ã‚‹ã«ã¯ã€ãƒ‰ã‚¤ãƒ„ã®ã‚¹ãƒãƒ¼ãƒˆã‚°ãƒªãƒƒãƒ‰ã‚’å°å…¥ã—ã¾ã—ã‚‡ã†",
                "ã”ã¿å‡¦ç†ã«ã¯ã€æ—¥æœ¬ã®é«˜åº¦ãªåˆ†åˆ¥ã‚·ã‚¹ãƒ†ãƒ ãŒåŠ¹æœçš„ã§ã™",
                "äº¤é€šã®CO2å‰Šæ¸›ã«ã¯ã€ãƒãƒ«ã‚¦ã‚§ãƒ¼ã®EVæ™®åŠæ”¿ç­–ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„"
            ];
            const randomAdvice = advice[Math.floor(Math.random() * advice.length)];
            
            showNotification(`ğŸ¤– AIã‚¢ãƒ‰ãƒã‚¤ã‚¹: ${randomAdvice}`);
        }

        // ã‚¢ã‚¤ãƒ†ãƒ è³¼å…¥
        function buyItem(itemId) {
            const items = {
                japan_solar: { name: 'æ—¥æœ¬ã®å¤ªé™½å…‰æŠ€è¡“', price: { ECO: 1200 } },
                germany_wind: { name: 'ãƒ‰ã‚¤ãƒ„ã®é¢¨åŠ›ãƒ‡ãƒ¼ã‚¿', price: { WTR: 850 } },
                singapore_water: { name: 'ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ«æ°´å‡¦ç†', price: { NRG: 2100 } }
            };
            
            const item = items[itemId];
            if (item) {
                showNotification(`ğŸ›’ ${item.name}ã‚’è³¼å…¥ã—ã¾ã—ãŸï¼`);
                // ã“ã“ã§å®Ÿéš›ã®è³¼å…¥å‡¦ç†ã‚’å®Ÿè£…
            }
        }

        // ç”»é¢ç®¡ç†
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        // é€šçŸ¥æ©Ÿèƒ½
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¡¨ç¤º
        function viewPlayerProfile(playerId) {
            const player = multiplayerState.onlinePlayers.find(p => p.id === playerId);
            if (player) {
                showNotification(`ğŸ‘¤ ${player.name}ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«: ${player.country} Lv.${player.level}`);
            }
        }

        // å”åŠ›ãƒ«ãƒ¼ãƒ ä½œæˆ
        function createCoopRoom() {
            showNotification('ğŸ‘¥ å”åŠ›ãƒ«ãƒ¼ãƒ ã‚’ä½œæˆã—ã¾ã—ãŸï¼ä»–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’æ‹›å¾…ã§ãã¾ã™');
        }

        // åˆæœŸåŒ–å®Ÿè¡Œ
        window.onload = function() {
            initializeMultiplayerHub();
            showNotification('ğŸŒ ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«æ¥ç¶šã—ã¾ã—ãŸ');
        };

        // ãƒãƒ£ãƒƒãƒˆå…¥åŠ›ã§Enterã‚­ãƒ¼å¯¾å¿œ
        document.getElementById('chatInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendChatMessage();
            }
        });
    </script>
</body>
</html>
