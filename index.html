<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDGs都市経営シミュレーター - 完全版</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a2a6c, #2a5298, #1e3c72);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255,255,255,0.1);
            padding: 25px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        .game-grid {
            display: grid;
            grid-template-columns: 1fr 450px;
            gap: 25px;
            margin-bottom: 20px;
        }
        .main-game {
            background: rgba(255,255,255,0.07);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .sidebar {
            background: rgba(255,255,255,0.07);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .resources-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        .resource-card {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
            transition: transform 0.3s ease;
        }
        .resource-card:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.15);
        }
        .resource-value {
            font-size: 28px;
            font-weight: bold;
            margin: 8px 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .policy-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .policy-card {
            background: rgba(255,255,255,0.08);
            border: 2px solid transparent;
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .policy-card:hover {
            transform: translateY(-8px);
            border-color: #4FC3F7;
            background: rgba(79, 195, 247, 0.12);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .policy-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.7s;
        }
        .policy-card:hover::before {
            left: 100%;
        }
        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        .card-icon {
            font-size: 28px;
        }
        .card-title {
            font-size: 20px;
            font-weight: bold;
        }
        .card-effects {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        .effect-badge {
            background: rgba(255,255,255,0.15);
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 13px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .positive { color: #4CAF50; background: rgba(76, 175, 80, 0.15); }
        .negative { color: #F44336; background: rgba(244, 67, 54, 0.15); }
        .neutral { color: #FFC107; background: rgba(255, 193, 7, 0.15); }
        .tech-tree {
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .tech-level {
            margin-bottom: 20px;
        }
        .tech-level-title {
            font-size: 18px;
            margin-bottom: 12px;
            color: #4FC3F7;
        }
        .tech-items {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .tech-item {
            background: rgba(255,255,255,0.1);
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 14px;
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }
        .unlocked { 
            background: rgba(76, 175, 80, 0.3); 
            border-color: #4CAF50;
            transform: scale(1.05);
        }
        .ar-container {
            background: rgba(0,0,0,0.4);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 25px;
        }
        .ar-button {
            background: linear-gradient(135deg, #FFD700, #FF9800);
            color: black;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            font-weight: bold;
            cursor: pointer;
            margin: 15px 0;
            transition: transform 0.3s, box-shadow 0.3s;
            font-size: 16px;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }
        .ar-button:hover {
            transform: scale(1.08);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
        }
        .message-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .message-box {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            padding: 40px;
            border-radius: 25px;
            max-width: 600px;
            text-align: center;
            border: 3px solid #FFD700;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
            animation: popIn 0.5s ease;
        }
        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .progress-container {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .progress-bar {
            height: 25px;
            background: linear-gradient(90deg, #4CAF50, #FFC107, #F44336);
            border-radius: 12px;
            margin: 12px 0;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
        }
        .progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            margin-bottom: 8px;
        }
        .achievement {
            background: linear-gradient(135deg, #FFD700, #FF9800);
            color: black;
            padding: 10px 18px;
            border-radius: 25px;
            font-weight: bold;
            margin: 8px;
            display: inline-block;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .turn-counter {
            text-align: center;
            font-size: 20px;
            margin: 20px 0;
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .sdgs-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 15px 0;
            justify-content: center;
        }
        .sdgs-badge {
            background: #1a2a6c;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 12px;
            border: 1px solid rgba(255,255,255,0.3);
        }
        .game-controls {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            justify-content: center;
        }
        .control-button {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .control-button:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-3px);
        }
        .event-log {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-size: 14px;
        }
        .event-item {
            margin: 8px 0;
            padding: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            border-left: 3px solid #4FC3F7;
        }
        @media (max-width: 1024px) {
            .game-grid {
                grid-template-columns: 1fr;
            }
        }
        @media (max-width: 768px) {
            .resources-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .policy-cards {
                grid-template-columns: 1fr;
            }
            .container {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 style="font-size: 2.5em; margin-bottom: 10px;">🏙️ SDGs都市経営シミュレーター</h1>
            <p style="font-size: 1.2em; opacity: 0.9;">選択で街を育て、ARで成長を実感するSDGs経営ゲーム</p>
            <div class="turn-counter">
                📅 ターン: <span id="currentTurn">1</span> | 🎯 目標: 持続可能な都市の実現 | ⏱️ プレイ時間: <span id="playTime">0:00</span>
            </div>
        </div>

        <div class="game-grid">
            <div class="main-game">
                <div class="resources-grid">
                    <div class="resource-card">
                        <div>💰 予算</div>
                        <div class="resource-value" id="budget">15,000</div>
                        <div>百万円</div>
                    </div>
                    <div class="resource-card">
                        <div>👥 支持率</div>
                        <div class="resource-value" id="support">65%</div>
                        <div>市民の信頼</div>
                    </div>
                    <div class="resource-card">
                        <div>🌿 環境</div>
                        <div class="resource-value" id="environment">70%</div>
                        <div>持続可能性</div>
                    </div>
                    <div class="resource-card">
                        <div>💹 経済</div>
                        <div class="resource-value" id="economy">50%</div>
                        <div>成長率</div>
                    </div>
                    <div class="resource-card">
                        <div>⚡ エネルギー</div>
                        <div class="resource-value" id="energy">80%</div>
                        <div>供給力</div>
                    </div>
                    <div class="resource-card">
                        <div>🏠 人口</div>
                        <div class="resource-value" id="population">100,000</div>
                        <div>住民数</div>
                    </div>
                </div>

                <div class="progress-container">
                    <div class="progress-label">
                        <span>🏆 SDGs達成度</span>
                        <span id="sdgsProgress">35%</span>
                    </div>
                    <div class="progress-bar" id="progressBar" style="width: 35%"></div>
                    <div style="font-size: 14px; text-align: center; margin-top: 10px;">
                        目標: 環境と経済のバランスが取れた持続可能な都市
                    </div>
                </div>

                <div class="game-controls">
                    <button class="control-button" onclick="saveGame()">💾 セーブ</button>
                    <button class="control-button" onclick="loadGame()">📂 ロード</button>
                    <button class="control-button" onclick="showTutorial()">❓ チュートリアル</button>
                    <button class="control-button" onclick="resetGame()">🔄 リセット</button>
                </div>

                <h3 style="margin-bottom: 20px; font-size: 1.5em;">🎯 政策選択 - 現在の課題: <span id="currentChallenge">エネルギー供給の確保</span></h3>
                <div class="policy-cards" id="policyCards">
                    <!-- 政策カードはJavaScriptで動的に生成 -->
                </div>

                <div class="tech-tree">
                    <h4 style="font-size: 1.3em; margin-bottom: 15px; color: #4FC3F7;">🔬 研究開発ツリー</h4>
                    <div class="tech-level">
                        <div class="tech-level-title">🌱 基礎技術</div>
                        <div class="tech-items" id="basicTech">
                            <!-- 技術アイテムはJavaScriptで生成 -->
                        </div>
                    </div>
                    <div class="tech-level">
                        <div class="tech-level-title">🚀 中級技術</div>
                        <div class="tech-items" id="intermediateTech">
                            <!-- 技術アイテムはJavaScriptで生成 -->
                        </div>
                    </div>
                    <div class="tech-level">
                        <div class="tech-level-title">💫 先進技術</div>
                        <div class="tech-items" id="advancedTech">
                            <!-- 技術アイテムはJavaScriptで生成 -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <h3 style="font-size: 1.4em; margin-bottom: 20px;">📊 都市統計</h3>
                <div style="margin: 20px 0; background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px;">
                    <div style="margin-bottom: 10px;">🏙️ 都市レベル: <strong id="cityLevel">3</strong></div>
                    <div style="margin-bottom: 10px;">⭐ 評価: <strong id="cityRating">環境重視</strong></div>
                    <div style="margin-bottom: 10px;">🏆 実績: <span id="achievementCount">2</span>個</div>
                    <div>🔬 研究ポイント: <strong id="researchPoints">5</strong></div>
                </div>

                <div class="ar-container">
                    <h4 style="font-size: 1.2em; margin-bottom: 10px;">🔮 AR都市ビュー</h4>
                    <p style="margin-bottom: 15px; opacity: 0.9;">街の成長をARで実感しよう</p>
                    <button class="ar-button" onclick="showARView()">
                        📱 ARで街を見る
                    </button>
                    <div style="font-size: 13px; opacity: 0.8;">
                        スマホをかざすと光る都市が出現（5秒間）
                    </div>
                </div>

                <div style="margin-bottom: 25px;">
                    <h4 style="font-size: 1.2em; margin-bottom: 15px;">🎖️ 獲得実績</h4>
                    <div id="achievementsList">
                        <!-- 実績はJavaScriptで生成 -->
                    </div>
                </div>

                <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px; margin-bottom: 25px;">
                    <h4 style="font-size: 1.2em; margin-bottom: 15px;">📈 次回予測</h4>
                    <div style="font-size: 14px;">
                        <div style="margin-bottom: 8px;">📊 人口増加: <span style="color: #4CAF50">+5,000人</span></div>
                        <div style="margin-bottom: 8px;">⚡ エネルギー需要: <span style="color: #F44336">+15%</span></div>
                        <div style="margin-bottom: 8px;">🌿 環境負荷: <span style="color: #F44336">+8%</span></div>
                        <div>💰 予算収入: <span style="color: #4CAF50">+1,200万</span></div>
                    </div>
                </div>

                <div>
                    <h4 style="font-size: 1.2em; margin-bottom: 15px;">📝 イベントログ</h4>
                    <div class="event-log" id="eventLog">
                        <!-- イベントログはJavaScriptで生成 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="message-overlay" id="messageOverlay">
        <div class="message-box">
            <h3 id="messageTitle" style="font-size: 1.8em; margin-bottom: 15px;">政策実行完了</h3>
            <p id="messageContent" style="font-size: 1.1em; margin-bottom: 20px;">新しい政策が都市に影響を与えました</p>
            <div id="messageEffects" style="margin: 20px 0;"></div>
            <div id="messageConsequences" style="margin: 15px 0;"></div>
            <button class="ar-button" onclick="hideMessage()" style="margin: 10px; padding: 12px 30px;">
                続ける
            </button>
        </div>
    </div>

    <!-- ARシーン（必要時のみ表示） -->
    <a-scene id="arScene" style="display: none;" embedded arjs='sourceType: webcam;'>
        <a-marker preset="hiro">
            <a-box position="0 0.5 0" color="#4CC3F7" animation="property: rotation; to: 0 360 0; loop: true; dur: 10000"></a-box>
            <a-entity id="cityModel" position="0 1 0" scale="0.5 0.5 0.5"></a-entity>
        </a-marker>
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // 拡張ゲーム状態管理
        class CityManager {
            constructor() {
                this.resources = {
                    budget: 15000,
                    publicSupport: 65,
                    environment: 70,
                    economy: 50,
                    energy: 80,
                    population: 100000,
                    researchPoints: 5
                };
                
                this.turn = 1;
                this.achievements = ['環境保護の芽生え', '政策立案者'];
                this.unlockedTech = {
                    basic: ['リサイクル', '省エネ'],
                    intermediate: [],
                    advanced: []
                };
                this.completedPolicies = [];
                this.cityLevel = 3;
                this.cityRating = '環境重視';
                this.eventLog = [
                    "ゲーム開始: 持続可能な都市を目指しましょう",
                    "初期政策: 基本インフラが整備されました"
                ];
                this.startTime = new Date();
                this.playTime = 0;
                this.victoryConditions = {
                    sustainable_city: { environment: 80, economy: 60, publicSupport: 75 },
                    economic_power: { economy: 90, population: 200000 },
                    eco_paradise: { environment: 95, publicSupport: 85 }
                };
                this.currentVictoryPath = 'sustainable_city';
            }

            applyPolicy(policy) {
                // コスト適用
                this.resources.budget -= policy.cost.budget || 0;
                this.resources.publicSupport += policy.cost.support || 0;
                
                // 効果適用
                Object.keys(policy.effects).forEach(effect => {
                    if (this.resources[effect] !== undefined) {
                        this.resources[effect] += policy.effects[effect];
                        // 値を制限
                        this.resources[effect] = Math.max(0, Math.min(100, this.resources[effect]));
                    }
                });

                // 人口増加（経済と支持率に基づく）
                const populationGrowth = Math.floor(
                    (this.resources.economy * 0.5 + this.resources.publicSupport * 0.3) * 10
                );
                this.resources.population += populationGrowth;

                // 研究ポイント増加
                this.resources.researchPoints += 1;

                this.turn++;
                this.completedPolicies.push(policy.id);
                
                // イベントログに追加
                this.addToEventLog(`政策実行: ${policy.name}`);
                
                // 実績チェック
                this.checkAchievements();
                // 都市評価更新
                this.updateCityRating();
                // 勝利条件チェック
                this.checkVictoryConditions();
                
                return this.calculateConsequences(policy, populationGrowth);
            }

            unlockTechnology(tech, level) {
                if (!this.unlockedTech[level].includes(tech)) {
                    this.unlockedTech[level].push(tech);
                    this.resources.researchPoints -= 2;
                    this.addToEventLog(`🔬 技術解放: ${tech}`);
                    
                    // 技術によるボーナス効果
                    this.applyTechBonus(tech);
                    return true;
                }
                return false;
            }

            applyTechBonus(tech) {
                const bonuses = {
                    'リサイクル': { environment: 5, economy: 2 },
                    '省エネ': { energy: 8, environment: 3 },
                    'スマートグリッド': { energy: 15, economy: 5 },
                    '太陽光発電': { energy: 20, environment: 10 },
                    '電気自動車': { environment: 12, energy: -5 }
                };
                
                if (bonuses[tech]) {
                    Object.keys(bonuses[tech]).forEach(effect => {
                        this.resources[effect] += bonuses[tech][effect];
                    });
                }
            }

            checkAchievements() {
                const newAchievements = [];
                
                if (this.resources.environment >= 75 && !this.achievements.includes('環境リーダー')) {
                    newAchievements.push('環境リーダー');
                }
                if (this.completedPolicies.length >= 5 && !this.achievements.includes('経験豊富な市長')) {
                    newAchievements.push('経験豊富な市長');
                }
                if (this.resources.economy >= 70 && !this.achievements.includes('経済発展の立役者')) {
                    newAchievements.push('経済発展の立役者');
                }
                if (this.resources.publicSupport >= 90 && !this.achievements.includes('人気市長')) {
                    newAchievements.push('人気市長');
                }
                if (this.unlockedTech.advanced.length >= 3 && !this.achievements.includes('技術革新の先導者')) {
                    newAchievements.push('技術革新の先導者');
                }

                newAchievements.forEach(achievement => {
                    this.achievements.push(achievement);
                    this.addToEventLog(`🏆 実績獲得: ${achievement}`);
                });
            }

            updateCityRating() {
                if (this.resources.environment - this.resources.economy > 20) {
                    this.cityRating = '環境重視';
                } else if (this.resources.economy - this.resources.environment > 20) {
                    this.cityRating = '経済重視';
                } else {
                    this.cityRating = 'バランス型';
                }
                
                // 都市レベル計算
                const avgScore = (this.resources.environment + this.resources.economy + this.resources.publicSupport) / 3;
                this.cityLevel = Math.floor(avgScore / 20) + 1;
            }

            checkVictoryConditions() {
                for (const [condition, requirements] of Object.entries(this.victoryConditions)) {
                    let met = true;
                    for (const [resource, value] of Object.entries(requirements)) {
                        if (this.resources[resource] < value) {
                            met = false;
                            break;
                        }
                    }
                    if (met) {
                        this.currentVictoryPath = condition;
                        this.addToEventLog(`🎯 勝利条件「${condition}」を達成しました！`);
                        return condition;
                    }
                }
                return null;
            }

            calculateConsequences(policy, populationGrowth) {
                const consequences = [];
                
                // 環境と経済のバランスチェック
                const balance = Math.abs(this.resources.environment - this.resources.economy);
                if (balance > 30) {
                    consequences.push(`⚠️ 環境と経済のバランスが悪化しています (差: ${balance}%)`);
                }

                // 支持率チェック
                if (this.resources.publicSupport < 40) {
                    consequences.push('😠 市民の不満が高まっています');
                } else if (this.resources.publicSupport > 80) {
                    consequences.push('😊 市民からの支持が高いです');
                }

                // 予算チェック
                if (this.resources.budget < 5000) {
                    consequences.push('💰 予算が逼迫しています');
                }

                // 人口増加メッセージ
                if (populationGrowth > 0) {
                    consequences.push(`📈 人口が ${populationGrowth.toLocaleString()}人増加しました`);
                }

                return consequences;
            }

            addToEventLog(message) {
                this.eventLog.unshift(message);
                // ログを50件に制限
                if (this.eventLog.length > 50) {
                    this.eventLog.pop();
                }
            }

            getSDGsProgress() {
                const balanceScore = 100 - Math.abs(this.resources.environment - this.resources.economy);
                const averageScore = (this.resources.environment + this.resources.economy + this.resources.energy + this.resources.publicSupport) / 4;
                return Math.min(100, Math.round((balanceScore + averageScore) / 2));
            }

            updatePlayTime() {
                const now = new Date();
                this.playTime = Math.floor((now - this.startTime) / 1000);
            }

            save() {
                const saveData = {
                    resources: this.resources,
                    turn: this.turn,
                    achievements: this.achievements,
                    unlockedTech: this.unlockedTech,
                    completedPolicies: this.completedPolicies,
                    cityLevel: this.cityLevel,
                    cityRating: this.cityRating,
                    eventLog: this.eventLog,
                    startTime: this.startTime,
                    playTime: this.playTime
                };
                localStorage.setItem('sdgsCitySimSave', JSON.stringify(saveData));
                this.addToEventLog('💾 ゲームをセーブしました');
            }

            load() {
                const saveData = localStorage.getItem('sdgsCitySimSave');
                if (saveData) {
                    const data = JSON.parse(saveData);
                    Object.assign(this, data);
                    this.addToEventLog('📂 ゲームをロードしました');
                    return true;
                }
                return false;
            }
        }

        // 拡張政策データベース
        const policies = {
            industrial: {
                id: 'industrial',
                name: "🏭 工業地区開発",
                description: "新しい工業地区を開発し雇用を創出",
                cost: { budget: 3000, support: -5 },
                effects: { economy: 20, environment: -15, energy: -10 },
                sdgs: [8, 9],
                requirements: []
            },
            green: {
                id: 'green', 
                name: "🌿 グリーンシティ計画",
                description: "公園と緑地を増やし環境を改善",
                cost: { budget: 2000, support: 5 },
                effects: { environment: 20, economy: -5, publicSupport: 10 },
                sdgs: [11, 13],
                requirements: []
            },
            energy: {
                id: 'energy',
                name: "⚡ 太陽光発電投資", 
                description: "再生可能エネルギー基盤を整備",
                cost: { budget: 4000, support: 8 },
                effects: { energy: 25, environment: 10, economy: 5 },
                sdgs: [7, 13],
                requirements: []
            },
            education: {
                id: 'education',
                name: "📚 教育施設拡充",
                description: "学校と研究機関を強化",
                cost: { budget: 2500, support: 10 },
                effects: { publicSupport: 15, economy: 8, environment: 3 },
                sdgs: [4, 8],
                requirements: []
            },
            transport: {
                id: 'transport',
                name: "🚆 公共交通整備",
                description: "電車とバスのネットワークを拡大",
                cost: { budget: 3500, support: 12 },
                effects: { environment: 15, publicSupport: 8, economy: 5, energy: -8 },
                sdgs: [11, 13],
                requirements: []
            },
            welfare: {
                id: 'welfare',
                name: "🏥 医療福祉充実",
                description: "病院と福祉施設を整備",
                cost: { budget: 2800, support: 15 },
                effects: { publicSupport: 20, economy: 3, environment: 2 },
                sdgs: [3, 11],
                requirements: []
            },
            technology: {
                id: 'technology',
                name: "💻 技術研究投資",
                description: "研究開発を促進し技術革新を図る",
                cost: { budget: 3500, support: 5 },
                effects: { economy: 12, environment: 8, energy: 10 },
                sdgs: [9, 12],
                requirements: []
            },
            agriculture: {
                id: 'agriculture',
                name: "🌾 持続可能農業",
                description: "環境に優しい農業を推進",
                cost: { budget: 1800, support: 8 },
                effects: { environment: 18, economy: 6, publicSupport: 12 },
                sdgs: [2, 15],
                requirements: []
            }
        };

        const challenges = [
            "エネルギー供給の確保",
            "経済成長の促進", 
            "環境保護の推進",
            "市民生活の質向上",
            "持続可能な開発",
            "雇用創出の推進",
            "技術革新の促進",
            "気候変動対策",
            "資源循環の確立"
        ];

        const technologies = {
            basic: ['リサイクル', '省エネ', '公共交通', '緑化', '水処理'],
            intermediate: ['スマートグリッド', 'IoT監視', '電気自動車', '太陽光発電', '風力発電'],
            advanced: ['AI都市管理', '自動運転', 'バイオ燃料', '水素エネルギー', 'ドローン配送']
        };

        // ゲームインスタンス
        const city = new CityManager();

        // DOM操作関数
        function updateUI() {
            // リソース更新
            document.getElementById('budget').textContent = city.resources.budget.toLocaleString();
            document.getElementById('support').textContent = city.resources.publicSupport + '%';
            document.getElementById('environment').textContent = city.resources.environment + '%';
            document.getElementById('economy').textContent = city.resources.economy + '%';
            document.getElementById('energy').textContent = city.resources.energy + '%';
            document.getElementById('population').textContent = city.resources.population.toLocaleString();
            document.getElementById('researchPoints').textContent = city.resources.researchPoints;
            
            // ターン更新
            document.getElementById('currentTurn').textContent = city.turn;
            
            // プレイ時間更新
            city.updatePlayTime();
            const minutes = Math.floor(city.playTime / 60);
            const seconds = city.playTime % 60;
            document.getElementById('playTime').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            // SDGs進捗
            const progress = city.getSDGsProgress();
            document.getElementById('sdgsProgress').textContent = progress + '%';
            document.getElementById
