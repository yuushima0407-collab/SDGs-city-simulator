<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDGséƒ½å¸‚çµŒå–¶ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ - å®Œå…¨ç‰ˆ</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a2a6c, #2a5298, #1e3c72);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255,255,255,0.1);
            padding: 25px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        .game-grid {
            display: grid;
            grid-template-columns: 1fr 450px;
            gap: 25px;
            margin-bottom: 20px;
        }
        .main-game {
            background: rgba(255,255,255,0.07);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .sidebar {
            background: rgba(255,255,255,0.07);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .resources-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        .resource-card {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
            transition: transform 0.3s ease;
        }
        .resource-card:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.15);
        }
        .resource-value {
            font-size: 28px;
            font-weight: bold;
            margin: 8px 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .policy-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .policy-card {
            background: rgba(255,255,255,0.08);
            border: 2px solid transparent;
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .policy-card:hover {
            transform: translateY(-8px);
            border-color: #4FC3F7;
            background: rgba(79, 195, 247, 0.12);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .policy-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.7s;
        }
        .policy-card:hover::before {
            left: 100%;
        }
        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        .card-icon {
            font-size: 28px;
        }
        .card-title {
            font-size: 20px;
            font-weight: bold;
        }
        .card-effects {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        .effect-badge {
            background: rgba(255,255,255,0.15);
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 13px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .positive { color: #4CAF50; background: rgba(76, 175, 80, 0.15); }
        .negative { color: #F44336; background: rgba(244, 67, 54, 0.15); }
        .neutral { color: #FFC107; background: rgba(255, 193, 7, 0.15); }
        .tech-tree {
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .tech-level {
            margin-bottom: 20px;
        }
        .tech-level-title {
            font-size: 18px;
            margin-bottom: 12px;
            color: #4FC3F7;
        }
        .tech-items {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .tech-item {
            background: rgba(255,255,255,0.1);
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 14px;
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }
        .unlocked { 
            background: rgba(76, 175, 80, 0.3); 
            border-color: #4CAF50;
            transform: scale(1.05);
        }
        .ar-container {
            background: rgba(0,0,0,0.4);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 25px;
        }
        .ar-button {
            background: linear-gradient(135deg, #FFD700, #FF9800);
            color: black;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            font-weight: bold;
            cursor: pointer;
            margin: 15px 0;
            transition: transform 0.3s, box-shadow 0.3s;
            font-size: 16px;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }
        .ar-button:hover {
            transform: scale(1.08);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
        }
        .message-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .message-box {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            padding: 40px;
            border-radius: 25px;
            max-width: 600px;
            text-align: center;
            border: 3px solid #FFD700;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
            animation: popIn 0.5s ease;
        }
        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .progress-container {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .progress-bar {
            height: 25px;
            background: linear-gradient(90deg, #4CAF50, #FFC107, #F44336);
            border-radius: 12px;
            margin: 12px 0;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
        }
        .progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            margin-bottom: 8px;
        }
        .achievement {
            background: linear-gradient(135deg, #FFD700, #FF9800);
            color: black;
            padding: 10px 18px;
            border-radius: 25px;
            font-weight: bold;
            margin: 8px;
            display: inline-block;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .turn-counter {
            text-align: center;
            font-size: 20px;
            margin: 20px 0;
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .sdgs-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 15px 0;
            justify-content: center;
        }
        .sdgs-badge {
            background: #1a2a6c;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 12px;
            border: 1px solid rgba(255,255,255,0.3);
        }
        .game-controls {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            justify-content: center;
        }
        .control-button {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .control-button:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-3px);
        }
        .event-log {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-size: 14px;
        }
        .event-item {
            margin: 8px 0;
            padding: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            border-left: 3px solid #4FC3F7;
        }
        @media (max-width: 1024px) {
            .game-grid {
                grid-template-columns: 1fr;
            }
        }
        @media (max-width: 768px) {
            .resources-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .policy-cards {
                grid-template-columns: 1fr;
            }
            .container {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 style="font-size: 2.5em; margin-bottom: 10px;">ğŸ™ï¸ SDGséƒ½å¸‚çµŒå–¶ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
            <p style="font-size: 1.2em; opacity: 0.9;">é¸æŠã§è¡—ã‚’è‚²ã¦ã€ARã§æˆé•·ã‚’å®Ÿæ„Ÿã™ã‚‹SDGsçµŒå–¶ã‚²ãƒ¼ãƒ </p>
            <div class="turn-counter">
                ğŸ“… ã‚¿ãƒ¼ãƒ³: <span id="currentTurn">1</span> | ğŸ¯ ç›®æ¨™: æŒç¶šå¯èƒ½ãªéƒ½å¸‚ã®å®Ÿç¾ | â±ï¸ ãƒ—ãƒ¬ã‚¤æ™‚é–“: <span id="playTime">0:00</span>
            </div>
        </div>

        <div class="game-grid">
            <div class="main-game">
                <div class="resources-grid">
                    <div class="resource-card">
                        <div>ğŸ’° äºˆç®—</div>
                        <div class="resource-value" id="budget">15,000</div>
                        <div>ç™¾ä¸‡å††</div>
                    </div>
                    <div class="resource-card">
                        <div>ğŸ‘¥ æ”¯æŒç‡</div>
                        <div class="resource-value" id="support">65%</div>
                        <div>å¸‚æ°‘ã®ä¿¡é ¼</div>
                    </div>
                    <div class="resource-card">
                        <div>ğŸŒ¿ ç’°å¢ƒ</div>
                        <div class="resource-value" id="environment">70%</div>
                        <div>æŒç¶šå¯èƒ½æ€§</div>
                    </div>
                    <div class="resource-card">
                        <div>ğŸ’¹ çµŒæ¸ˆ</div>
                        <div class="resource-value" id="economy">50%</div>
                        <div>æˆé•·ç‡</div>
                    </div>
                    <div class="resource-card">
                        <div>âš¡ ã‚¨ãƒãƒ«ã‚®ãƒ¼</div>
                        <div class="resource-value" id="energy">80%</div>
                        <div>ä¾›çµ¦åŠ›</div>
                    </div>
                    <div class="resource-card">
                        <div>ğŸ  äººå£</div>
                        <div class="resource-value" id="population">100,000</div>
                        <div>ä½æ°‘æ•°</div>
                    </div>
                </div>

                <div class="progress-container">
                    <div class="progress-label">
                        <span>ğŸ† SDGsé”æˆåº¦</span>
                        <span id="sdgsProgress">35%</span>
                    </div>
                    <div class="progress-bar" id="progressBar" style="width: 35%"></div>
                    <div style="font-size: 14px; text-align: center; margin-top: 10px;">
                        ç›®æ¨™: ç’°å¢ƒã¨çµŒæ¸ˆã®ãƒãƒ©ãƒ³ã‚¹ãŒå–ã‚ŒãŸæŒç¶šå¯èƒ½ãªéƒ½å¸‚
                    </div>
                </div>

                <div class="game-controls">
                    <button class="control-button" onclick="saveGame()">ğŸ’¾ ã‚»ãƒ¼ãƒ–</button>
                    <button class="control-button" onclick="loadGame()">ğŸ“‚ ãƒ­ãƒ¼ãƒ‰</button>
                    <button class="control-button" onclick="showTutorial()">â“ ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«</button>
                    <button class="control-button" onclick="resetGame()">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
                </div>

                <h3 style="margin-bottom: 20px; font-size: 1.5em;">ğŸ¯ æ”¿ç­–é¸æŠ - ç¾åœ¨ã®èª²é¡Œ: <span id="currentChallenge">ã‚¨ãƒãƒ«ã‚®ãƒ¼ä¾›çµ¦ã®ç¢ºä¿</span></h3>
                <div class="policy-cards" id="policyCards">
                    <!-- æ”¿ç­–ã‚«ãƒ¼ãƒ‰ã¯JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                </div>

                <div class="tech-tree">
                    <h4 style="font-size: 1.3em; margin-bottom: 15px; color: #4FC3F7;">ğŸ”¬ ç ”ç©¶é–‹ç™ºãƒ„ãƒªãƒ¼</h4>
                    <div class="tech-level">
                        <div class="tech-level-title">ğŸŒ± åŸºç¤æŠ€è¡“</div>
                        <div class="tech-items" id="basicTech">
                            <!-- æŠ€è¡“ã‚¢ã‚¤ãƒ†ãƒ ã¯JavaScriptã§ç”Ÿæˆ -->
                        </div>
                    </div>
                    <div class="tech-level">
                        <div class="tech-level-title">ğŸš€ ä¸­ç´šæŠ€è¡“</div>
                        <div class="tech-items" id="intermediateTech">
                            <!-- æŠ€è¡“ã‚¢ã‚¤ãƒ†ãƒ ã¯JavaScriptã§ç”Ÿæˆ -->
                        </div>
                    </div>
                    <div class="tech-level">
                        <div class="tech-level-title">ğŸ’« å…ˆé€²æŠ€è¡“</div>
                        <div class="tech-items" id="advancedTech">
                            <!-- æŠ€è¡“ã‚¢ã‚¤ãƒ†ãƒ ã¯JavaScriptã§ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <h3 style="font-size: 1.4em; margin-bottom: 20px;">ğŸ“Š éƒ½å¸‚çµ±è¨ˆ</h3>
                <div style="margin: 20px 0; background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px;">
                    <div style="margin-bottom: 10px;">ğŸ™ï¸ éƒ½å¸‚ãƒ¬ãƒ™ãƒ«: <strong id="cityLevel">3</strong></div>
                    <div style="margin-bottom: 10px;">â­ è©•ä¾¡: <strong id="cityRating">ç’°å¢ƒé‡è¦–</strong></div>
                    <div style="margin-bottom: 10px;">ğŸ† å®Ÿç¸¾: <span id="achievementCount">2</span>å€‹</div>
                    <div>ğŸ”¬ ç ”ç©¶ãƒã‚¤ãƒ³ãƒˆ: <strong id="researchPoints">5</strong></div>
                </div>

                <div class="ar-container">
                    <h4 style="font-size: 1.2em; margin-bottom: 10px;">ğŸ”® ARéƒ½å¸‚ãƒ“ãƒ¥ãƒ¼</h4>
                    <p style="margin-bottom: 15px; opacity: 0.9;">è¡—ã®æˆé•·ã‚’ARã§å®Ÿæ„Ÿã—ã‚ˆã†</p>
                    <button class="ar-button" onclick="showARView()">
                        ğŸ“± ARã§è¡—ã‚’è¦‹ã‚‹
                    </button>
                    <div style="font-size: 13px; opacity: 0.8;">
                        ã‚¹ãƒãƒ›ã‚’ã‹ã–ã™ã¨å…‰ã‚‹éƒ½å¸‚ãŒå‡ºç¾ï¼ˆ5ç§’é–“ï¼‰
                    </div>
                </div>

                <div style="margin-bottom: 25px;">
                    <h4 style="font-size: 1.2em; margin-bottom: 15px;">ğŸ–ï¸ ç²å¾—å®Ÿç¸¾</h4>
                    <div id="achievementsList">
                        <!-- å®Ÿç¸¾ã¯JavaScriptã§ç”Ÿæˆ -->
                    </div>
                </div>

                <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px; margin-bottom: 25px;">
                    <h4 style="font-size: 1.2em; margin-bottom: 15px;">ğŸ“ˆ æ¬¡å›äºˆæ¸¬</h4>
                    <div style="font-size: 14px;">
                        <div style="margin-bottom: 8px;">ğŸ“Š äººå£å¢—åŠ : <span style="color: #4CAF50">+5,000äºº</span></div>
                        <div style="margin-bottom: 8px;">âš¡ ã‚¨ãƒãƒ«ã‚®ãƒ¼éœ€è¦: <span style="color: #F44336">+15%</span></div>
                        <div style="margin-bottom: 8px;">ğŸŒ¿ ç’°å¢ƒè² è·: <span style="color: #F44336">+8%</span></div>
                        <div>ğŸ’° äºˆç®—åå…¥: <span style="color: #4CAF50">+1,200ä¸‡</span></div>
                    </div>
                </div>

                <div>
                    <h4 style="font-size: 1.2em; margin-bottom: 15px;">ğŸ“ ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°</h4>
                    <div class="event-log" id="eventLog">
                        <!-- ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ã¯JavaScriptã§ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="message-overlay" id="messageOverlay">
        <div class="message-box">
            <h3 id="messageTitle" style="font-size: 1.8em; margin-bottom: 15px;">æ”¿ç­–å®Ÿè¡Œå®Œäº†</h3>
            <p id="messageContent" style="font-size: 1.1em; margin-bottom: 20px;">æ–°ã—ã„æ”¿ç­–ãŒéƒ½å¸‚ã«å½±éŸ¿ã‚’ä¸ãˆã¾ã—ãŸ</p>
            <div id="messageEffects" style="margin: 20px 0;"></div>
            <div id="messageConsequences" style="margin: 15px 0;"></div>
            <button class="ar-button" onclick="hideMessage()" style="margin: 10px; padding: 12px 30px;">
                ç¶šã‘ã‚‹
            </button>
        </div>
    </div>

    <!-- ARã‚·ãƒ¼ãƒ³ï¼ˆå¿…è¦æ™‚ã®ã¿è¡¨ç¤ºï¼‰ -->
    <a-scene id="arScene" style="display: none;" embedded arjs='sourceType: webcam;'>
        <a-marker preset="hiro">
            <a-box position="0 0.5 0" color="#4CC3F7" animation="property: rotation; to: 0 360 0; loop: true; dur: 10000"></a-box>
            <a-entity id="cityModel" position="0 1 0" scale="0.5 0.5 0.5"></a-entity>
        </a-marker>
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // æ‹¡å¼µã‚²ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç†
        class CityManager {
            constructor() {
                this.resources = {
                    budget: 15000,
                    publicSupport: 65,
                    environment: 70,
                    economy: 50,
                    energy: 80,
                    population: 100000,
                    researchPoints: 5
                };
                
                this.turn = 1;
                this.achievements = ['ç’°å¢ƒä¿è­·ã®èŠ½ç”Ÿãˆ', 'æ”¿ç­–ç«‹æ¡ˆè€…'];
                this.unlockedTech = {
                    basic: ['ãƒªã‚µã‚¤ã‚¯ãƒ«', 'çœã‚¨ãƒ'],
                    intermediate: [],
                    advanced: []
                };
                this.completedPolicies = [];
                this.cityLevel = 3;
                this.cityRating = 'ç’°å¢ƒé‡è¦–';
                this.eventLog = [
                    "ã‚²ãƒ¼ãƒ é–‹å§‹: æŒç¶šå¯èƒ½ãªéƒ½å¸‚ã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†",
                    "åˆæœŸæ”¿ç­–: åŸºæœ¬ã‚¤ãƒ³ãƒ•ãƒ©ãŒæ•´å‚™ã•ã‚Œã¾ã—ãŸ"
                ];
                this.startTime = new Date();
                this.playTime = 0;
                this.victoryConditions = {
                    sustainable_city: { environment: 80, economy: 60, publicSupport: 75 },
                    economic_power: { economy: 90, population: 200000 },
                    eco_paradise: { environment: 95, publicSupport: 85 }
                };
                this.currentVictoryPath = 'sustainable_city';
            }

            applyPolicy(policy) {
                // ã‚³ã‚¹ãƒˆé©ç”¨
                this.resources.budget -= policy.cost.budget || 0;
                this.resources.publicSupport += policy.cost.support || 0;
                
                // åŠ¹æœé©ç”¨
                Object.keys(policy.effects).forEach(effect => {
                    if (this.resources[effect] !== undefined) {
                        this.resources[effect] += policy.effects[effect];
                        // å€¤ã‚’åˆ¶é™
                        this.resources[effect] = Math.max(0, Math.min(100, this.resources[effect]));
                    }
                });

                // äººå£å¢—åŠ ï¼ˆçµŒæ¸ˆã¨æ”¯æŒç‡ã«åŸºã¥ãï¼‰
                const populationGrowth = Math.floor(
                    (this.resources.economy * 0.5 + this.resources.publicSupport * 0.3) * 10
                );
                this.resources.population += populationGrowth;

                // ç ”ç©¶ãƒã‚¤ãƒ³ãƒˆå¢—åŠ 
                this.resources.researchPoints += 1;

                this.turn++;
                this.completedPolicies.push(policy.id);
                
                // ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ã«è¿½åŠ 
                this.addToEventLog(`æ”¿ç­–å®Ÿè¡Œ: ${policy.name}`);
                
                // å®Ÿç¸¾ãƒã‚§ãƒƒã‚¯
                this.checkAchievements();
                // éƒ½å¸‚è©•ä¾¡æ›´æ–°
                this.updateCityRating();
                // å‹åˆ©æ¡ä»¶ãƒã‚§ãƒƒã‚¯
                this.checkVictoryConditions();
                
                return this.calculateConsequences(policy, populationGrowth);
            }

            unlockTechnology(tech, level) {
                if (!this.unlockedTech[level].includes(tech)) {
                    this.unlockedTech[level].push(tech);
                    this.resources.researchPoints -= 2;
                    this.addToEventLog(`ğŸ”¬ æŠ€è¡“è§£æ”¾: ${tech}`);
                    
                    // æŠ€è¡“ã«ã‚ˆã‚‹ãƒœãƒ¼ãƒŠã‚¹åŠ¹æœ
                    this.applyTechBonus(tech);
                    return true;
                }
                return false;
            }

            applyTechBonus(tech) {
                const bonuses = {
                    'ãƒªã‚µã‚¤ã‚¯ãƒ«': { environment: 5, economy: 2 },
                    'çœã‚¨ãƒ': { energy: 8, environment: 3 },
                    'ã‚¹ãƒãƒ¼ãƒˆã‚°ãƒªãƒƒãƒ‰': { energy: 15, economy: 5 },
                    'å¤ªé™½å…‰ç™ºé›»': { energy: 20, environment: 10 },
                    'é›»æ°—è‡ªå‹•è»Š': { environment: 12, energy: -5 }
                };
                
                if (bonuses[tech]) {
                    Object.keys(bonuses[tech]).forEach(effect => {
                        this.resources[effect] += bonuses[tech][effect];
                    });
                }
            }

            checkAchievements() {
                const newAchievements = [];
                
                if (this.resources.environment >= 75 && !this.achievements.includes('ç’°å¢ƒãƒªãƒ¼ãƒ€ãƒ¼')) {
                    newAchievements.push('ç’°å¢ƒãƒªãƒ¼ãƒ€ãƒ¼');
                }
                if (this.completedPolicies.length >= 5 && !this.achievements.includes('çµŒé¨“è±Šå¯Œãªå¸‚é•·')) {
                    newAchievements.push('çµŒé¨“è±Šå¯Œãªå¸‚é•·');
                }
                if (this.resources.economy >= 70 && !this.achievements.includes('çµŒæ¸ˆç™ºå±•ã®ç«‹å½¹è€…')) {
                    newAchievements.push('çµŒæ¸ˆç™ºå±•ã®ç«‹å½¹è€…');
                }
                if (this.resources.publicSupport >= 90 && !this.achievements.includes('äººæ°—å¸‚é•·')) {
                    newAchievements.push('äººæ°—å¸‚é•·');
                }
                if (this.unlockedTech.advanced.length >= 3 && !this.achievements.includes('æŠ€è¡“é©æ–°ã®å…ˆå°è€…')) {
                    newAchievements.push('æŠ€è¡“é©æ–°ã®å…ˆå°è€…');
                }

                newAchievements.forEach(achievement => {
                    this.achievements.push(achievement);
                    this.addToEventLog(`ğŸ† å®Ÿç¸¾ç²å¾—: ${achievement}`);
                });
            }

            updateCityRating() {
                if (this.resources.environment - this.resources.economy > 20) {
                    this.cityRating = 'ç’°å¢ƒé‡è¦–';
                } else if (this.resources.economy - this.resources.environment > 20) {
                    this.cityRating = 'çµŒæ¸ˆé‡è¦–';
                } else {
                    this.cityRating = 'ãƒãƒ©ãƒ³ã‚¹å‹';
                }
                
                // éƒ½å¸‚ãƒ¬ãƒ™ãƒ«è¨ˆç®—
                const avgScore = (this.resources.environment + this.resources.economy + this.resources.publicSupport) / 3;
                this.cityLevel = Math.floor(avgScore / 20) + 1;
            }

            checkVictoryConditions() {
                for (const [condition, requirements] of Object.entries(this.victoryConditions)) {
                    let met = true;
                    for (const [resource, value] of Object.entries(requirements)) {
                        if (this.resources[resource] < value) {
                            met = false;
                            break;
                        }
                    }
                    if (met) {
                        this.currentVictoryPath = condition;
                        this.addToEventLog(`ğŸ¯ å‹åˆ©æ¡ä»¶ã€Œ${condition}ã€ã‚’é”æˆã—ã¾ã—ãŸï¼`);
                        return condition;
                    }
                }
                return null;
            }

            calculateConsequences(policy, populationGrowth) {
                const consequences = [];
                
                // ç’°å¢ƒã¨çµŒæ¸ˆã®ãƒãƒ©ãƒ³ã‚¹ãƒã‚§ãƒƒã‚¯
                const balance = Math.abs(this.resources.environment - this.resources.economy);
                if (balance > 30) {
                    consequences.push(`âš ï¸ ç’°å¢ƒã¨çµŒæ¸ˆã®ãƒãƒ©ãƒ³ã‚¹ãŒæ‚ªåŒ–ã—ã¦ã„ã¾ã™ (å·®: ${balance}%)`);
                }

                // æ”¯æŒç‡ãƒã‚§ãƒƒã‚¯
                if (this.resources.publicSupport < 40) {
                    consequences.push('ğŸ˜  å¸‚æ°‘ã®ä¸æº€ãŒé«˜ã¾ã£ã¦ã„ã¾ã™');
                } else if (this.resources.publicSupport > 80) {
                    consequences.push('ğŸ˜Š å¸‚æ°‘ã‹ã‚‰ã®æ”¯æŒãŒé«˜ã„ã§ã™');
                }

                // äºˆç®—ãƒã‚§ãƒƒã‚¯
                if (this.resources.budget < 5000) {
                    consequences.push('ğŸ’° äºˆç®—ãŒé€¼è¿«ã—ã¦ã„ã¾ã™');
                }

                // äººå£å¢—åŠ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                if (populationGrowth > 0) {
                    consequences.push(`ğŸ“ˆ äººå£ãŒ ${populationGrowth.toLocaleString()}äººå¢—åŠ ã—ã¾ã—ãŸ`);
                }

                return consequences;
            }

            addToEventLog(message) {
                this.eventLog.unshift(message);
                // ãƒ­ã‚°ã‚’50ä»¶ã«åˆ¶é™
                if (this.eventLog.length > 50) {
                    this.eventLog.pop();
                }
            }

            getSDGsProgress() {
                const balanceScore = 100 - Math.abs(this.resources.environment - this.resources.economy);
                const averageScore = (this.resources.environment + this.resources.economy + this.resources.energy + this.resources.publicSupport) / 4;
                return Math.min(100, Math.round((balanceScore + averageScore) / 2));
            }

            updatePlayTime() {
                const now = new Date();
                this.playTime = Math.floor((now - this.startTime) / 1000);
            }

            save() {
                const saveData = {
                    resources: this.resources,
                    turn: this.turn,
                    achievements: this.achievements,
                    unlockedTech: this.unlockedTech,
                    completedPolicies: this.completedPolicies,
                    cityLevel: this.cityLevel,
                    cityRating: this.cityRating,
                    eventLog: this.eventLog,
                    startTime: this.startTime,
                    playTime: this.playTime
                };
                localStorage.setItem('sdgsCitySimSave', JSON.stringify(saveData));
                this.addToEventLog('ğŸ’¾ ã‚²ãƒ¼ãƒ ã‚’ã‚»ãƒ¼ãƒ–ã—ã¾ã—ãŸ');
            }

            load() {
                const saveData = localStorage.getItem('sdgsCitySimSave');
                if (saveData) {
                    const data = JSON.parse(saveData);
                    Object.assign(this, data);
                    this.addToEventLog('ğŸ“‚ ã‚²ãƒ¼ãƒ ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ');
                    return true;
                }
                return false;
            }
        }

        // æ‹¡å¼µæ”¿ç­–ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
        const policies = {
            industrial: {
                id: 'industrial',
                name: "ğŸ­ å·¥æ¥­åœ°åŒºé–‹ç™º",
                description: "æ–°ã—ã„å·¥æ¥­åœ°åŒºã‚’é–‹ç™ºã—é›‡ç”¨ã‚’å‰µå‡º",
                cost: { budget: 3000, support: -5 },
                effects: { economy: 20, environment: -15, energy: -10 },
                sdgs: [8, 9],
                requirements: []
            },
            green: {
                id: 'green', 
                name: "ğŸŒ¿ ã‚°ãƒªãƒ¼ãƒ³ã‚·ãƒ†ã‚£è¨ˆç”»",
                description: "å…¬åœ’ã¨ç·‘åœ°ã‚’å¢—ã‚„ã—ç’°å¢ƒã‚’æ”¹å–„",
                cost: { budget: 2000, support: 5 },
                effects: { environment: 20, economy: -5, publicSupport: 10 },
                sdgs: [11, 13],
                requirements: []
            },
            energy: {
                id: 'energy',
                name: "âš¡ å¤ªé™½å…‰ç™ºé›»æŠ•è³‡", 
                description: "å†ç”Ÿå¯èƒ½ã‚¨ãƒãƒ«ã‚®ãƒ¼åŸºç›¤ã‚’æ•´å‚™",
                cost: { budget: 4000, support: 8 },
                effects: { energy: 25, environment: 10, economy: 5 },
                sdgs: [7, 13],
                requirements: []
            },
            education: {
                id: 'education',
                name: "ğŸ“š æ•™è‚²æ–½è¨­æ‹¡å……",
                description: "å­¦æ ¡ã¨ç ”ç©¶æ©Ÿé–¢ã‚’å¼·åŒ–",
                cost: { budget: 2500, support: 10 },
                effects: { publicSupport: 15, economy: 8, environment: 3 },
                sdgs: [4, 8],
                requirements: []
            },
            transport: {
                id: 'transport',
                name: "ğŸš† å…¬å…±äº¤é€šæ•´å‚™",
                description: "é›»è»Šã¨ãƒã‚¹ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’æ‹¡å¤§",
                cost: { budget: 3500, support: 12 },
                effects: { environment: 15, publicSupport: 8, economy: 5, energy: -8 },
                sdgs: [11, 13],
                requirements: []
            },
            welfare: {
                id: 'welfare',
                name: "ğŸ¥ åŒ»ç™‚ç¦ç¥‰å……å®Ÿ",
                description: "ç—…é™¢ã¨ç¦ç¥‰æ–½è¨­ã‚’æ•´å‚™",
                cost: { budget: 2800, support: 15 },
                effects: { publicSupport: 20, economy: 3, environment: 2 },
                sdgs: [3, 11],
                requirements: []
            },
            technology: {
                id: 'technology',
                name: "ğŸ’» æŠ€è¡“ç ”ç©¶æŠ•è³‡",
                description: "ç ”ç©¶é–‹ç™ºã‚’ä¿ƒé€²ã—æŠ€è¡“é©æ–°ã‚’å›³ã‚‹",
                cost: { budget: 3500, support: 5 },
                effects: { economy: 12, environment: 8, energy: 10 },
                sdgs: [9, 12],
                requirements: []
            },
            agriculture: {
                id: 'agriculture',
                name: "ğŸŒ¾ æŒç¶šå¯èƒ½è¾²æ¥­",
                description: "ç’°å¢ƒã«å„ªã—ã„è¾²æ¥­ã‚’æ¨é€²",
                cost: { budget: 1800, support: 8 },
                effects: { environment: 18, economy: 6, publicSupport: 12 },
                sdgs: [2, 15],
                requirements: []
            }
        };

        const challenges = [
            "ã‚¨ãƒãƒ«ã‚®ãƒ¼ä¾›çµ¦ã®ç¢ºä¿",
            "çµŒæ¸ˆæˆé•·ã®ä¿ƒé€²", 
            "ç’°å¢ƒä¿è­·ã®æ¨é€²",
            "å¸‚æ°‘ç”Ÿæ´»ã®è³ªå‘ä¸Š",
            "æŒç¶šå¯èƒ½ãªé–‹ç™º",
            "é›‡ç”¨å‰µå‡ºã®æ¨é€²",
            "æŠ€è¡“é©æ–°ã®ä¿ƒé€²",
            "æ°—å€™å¤‰å‹•å¯¾ç­–",
            "è³‡æºå¾ªç’°ã®ç¢ºç«‹"
        ];

        const technologies = {
            basic: ['ãƒªã‚µã‚¤ã‚¯ãƒ«', 'çœã‚¨ãƒ', 'å…¬å…±äº¤é€š', 'ç·‘åŒ–', 'æ°´å‡¦ç†'],
            intermediate: ['ã‚¹ãƒãƒ¼ãƒˆã‚°ãƒªãƒƒãƒ‰', 'IoTç›£è¦–', 'é›»æ°—è‡ªå‹•è»Š', 'å¤ªé™½å…‰ç™ºé›»', 'é¢¨åŠ›ç™ºé›»'],
            advanced: ['AIéƒ½å¸‚ç®¡ç†', 'è‡ªå‹•é‹è»¢', 'ãƒã‚¤ã‚ªç‡ƒæ–™', 'æ°´ç´ ã‚¨ãƒãƒ«ã‚®ãƒ¼', 'ãƒ‰ãƒ­ãƒ¼ãƒ³é…é€']
        };

        // ã‚²ãƒ¼ãƒ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
        const city = new CityManager();

        // DOMæ“ä½œé–¢æ•°
        function updateUI() {
            // ãƒªã‚½ãƒ¼ã‚¹æ›´æ–°
            document.getElementById('budget').textContent = city.resources.budget.toLocaleString();
            document.getElementById('support').textContent = city.resources.publicSupport + '%';
            document.getElementById('environment').textContent = city.resources.environment + '%';
            document.getElementById('economy').textContent = city.resources.economy + '%';
            document.getElementById('energy').textContent = city.resources.energy + '%';
            document.getElementById('population').textContent = city.resources.population.toLocaleString();
            document.getElementById('researchPoints').textContent = city.resources.researchPoints;
            
            // ã‚¿ãƒ¼ãƒ³æ›´æ–°
            document.getElementById('currentTurn').textContent = city.turn;
            
            // ãƒ—ãƒ¬ã‚¤æ™‚é–“æ›´æ–°
            city.updatePlayTime();
            const minutes = Math.floor(city.playTime / 60);
            const seconds = city.playTime % 60;
            document.getElementById('playTime').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            // SDGsé€²æ—
            const progress = city.getSDGsProgress();
            document.getElementById('sdgsProgress').textContent = progress + '%';
            document.getElementById
