<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDGs World Builder - Improved</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* ç”»é¢ç®¡ç† */
        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #00b894, #00cec9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .nav-tab.active {
            background: #00b894;
            border-color: #00cec9;
        }

        /* ã‚«ãƒ¼ãƒ‰ã‚·ã‚¹ãƒ†ãƒ  */
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }

        .card:hover::before {
            left: 100%;
        }

        .card:hover {
            transform: translateY(-5px);
            border-color: #00cec9;
            box-shadow: 0 15px 30px rgba(0, 206, 201, 0.3);
        }

        .card.disabled {
            opacity: 0.4;
            cursor: not-allowed;
            filter: grayscale(1);
        }

        .card.new {
            border-color: #fdcb6e;
            animation: pulse 2s infinite;
        }

        .card-icon {
            font-size: 3em;
            margin-bottom: 15px;
            text-align: center;
        }

        .card-rarity {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.7em;
            font-weight: bold;
        }

        .rarity-common { background: #636e72; }
        .rarity-rare { background: #0984e3; }
        .rarity-epic { background: #6c5ce7; }

        /* éƒ½å¸‚å»ºè¨­ã‚°ãƒªãƒƒãƒ‰ */
        .city-builder {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
        }

        .city-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
        }

        .grid-cell {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2em;
        }

        .grid-cell:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .grid-cell.built {
            background: rgba(0, 184, 148, 0.3);
        }

        .grid-cell.selected {
            background: rgba(0, 206, 201, 0.5);
            box-shadow: 0 0 15px rgba(0, 206, 201, 0.5);
        }

        /* å»ºè¨­ã‚ªãƒ—ã‚·ãƒ§ãƒ³ */
        .build-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .build-option {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .build-option:hover {
            transform: translateY(-3px);
            border-color: #74b9ff;
        }

        .build-option.available {
            background: rgba(116, 185, 255, 0.2);
        }

        /* å›½è©³ç´°ç”»é¢ */
        .country-detail {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
        }

        .country-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
        }

        .country-flag {
            font-size: 4em;
        }

        .country-info h2 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        /* ARãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */
        .ar-preview {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            text-align: center;
            border: 2px dashed #00cec9;
        }

        .ar-viewport {
            width: 100%;
            height: 300px;
            background: linear-gradient(45deg, #1a2a6c, #b21f1f);
            border-radius: 10px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .ar-building {
            position: absolute;
            transition: all 0.5s ease;
        }

        /* ãƒªã‚½ãƒ¼ã‚¹è¡¨ç¤º */
        .resources-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .resource {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .resource:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.15);
        }

        .resource-value {
            font-size: 1.8em;
            font-weight: bold;
            margin: 8px 0;
        }

        /* ãƒœã‚¿ãƒ³ */
        .btn {
            background: linear-gradient(45deg, #00b894, #00cec9);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
            font-size: 1em;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 184, 148, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .btn-ar {
            background: linear-gradient(45deg, #6c5ce7, #a29bfe);
        }

        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* é€šçŸ¥ */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            z-index: 1000;
            animation: slideIn 0.5s ease;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            max-width: 400px;
        }

        /* é€²æ—ãƒãƒ¼ */
        .progress-container {
            margin: 15px 0;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00b894, #00cec9);
            border-radius: 10px;
            transition: width 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ -->
        <div id="startScreen" class="screen active">
            <div class="header">
                <h1>ğŸŒ SDGs World Builder</h1>
                <p>ä¸–ç•Œã®çŸ¥æµã‚’é›†ã‚ã¦ã€ç†æƒ³ã®æœªæ¥éƒ½å¸‚ã‚’ä½œã‚ã†ï¼</p>
            </div>
            <div style="text-align: center; margin-top: 50px;">
                <button class="btn" onclick="showScreen('countrySelect')">ğŸš€ ã‚²ãƒ¼ãƒ ã‚’å§‹ã‚ã‚‹</button>
                <button class="btn btn-secondary" onclick="showScreen('tutorial')">ğŸ“š éŠã³æ–¹</button>
            </div>
        </div>

        <!-- å›½é¸æŠç”»é¢ -->
        <div id="countrySelect" class="screen">
            <div class="header">
                <h1>ğŸŒ è¨ªå•ã™ã‚‹å›½ã‚’é¸ã¼ã†</h1>
                <p>å„å›½ã®SDGsæˆåŠŸäº‹ä¾‹ã‚’å­¦ã‚“ã§ã‚«ãƒ¼ãƒ‰ã‚’ç²å¾—ã—ã‚ˆã†</p>
            </div>

            <div class="nav-tabs">
                <div class="nav-tab active" onclick="showContinent('asia')">ğŸŒ ã‚¢ã‚¸ã‚¢</div>
                <div class="nav-tab" onclick="showContinent('europe')">ğŸ° ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘</div>
                <div class="nav-tab" onclick="showContinent('africa')">ğŸ¦ ã‚¢ãƒ•ãƒªã‚«</div>
            </div>

            <div class="cards-container">
                <!-- æ—¥æœ¬ã®ã‚«ãƒ¼ãƒ‰ -->
                <div class="card continent-asia" onclick="visitCountry('japan')">
                    <div class="card-icon">ğŸ‡¯ğŸ‡µ</div>
                    <h3>æ—¥æœ¬</h3>
                    <p>ã”ã¿åˆ†åˆ¥ãƒ»ç½å®³å¯¾ç­–ãƒ»å…¬å…±äº¤é€š</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%"></div>
                    </div>
                    <small>æœªè¨ªå• - ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ¢æ¤œ</small>
                </div>

                <!-- ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ«ã®ã‚«ãƒ¼ãƒ‰ -->
                <div class="card continent-asia" onclick="visitCountry('singapore')">
                    <div class="card-icon">ğŸ‡¸ğŸ‡¬</div>
                    <h3>ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ«</h3>
                    <p>æ°´è³‡æºç®¡ç†ãƒ»éƒ½å¸‚ç·‘åŒ–</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%"></div>
                    </div>
                    <small>æœªè¨ªå• - ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ¢æ¤œ</small>
                </div>

                <!-- ãƒ‰ã‚¤ãƒ„ã®ã‚«ãƒ¼ãƒ‰ -->
                <div class="card continent-europe" style="display: none" onclick="visitCountry('germany')">
                    <div class="card-icon">ğŸ‡©ğŸ‡ª</div>
                    <h3>ãƒ‰ã‚¤ãƒ„</h3>
                    <p>ã‚¨ãƒãƒ«ã‚®ãƒ¼è»¢æ›ãƒ»ãƒªã‚µã‚¤ã‚¯ãƒ«</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%"></div>
                    </div>
                    <small>æœªè¨ªå• - ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ¢æ¤œ</small>
                </div>

                <!-- ãƒ«ãƒ¯ãƒ³ãƒ€ã®ã‚«ãƒ¼ãƒ‰ -->
                <div class="card continent-africa" style="display: none" onclick="visitCountry('rwanda')">
                    <div class="card-icon">ğŸ‡·ğŸ‡¼</div>
                    <h3>ãƒ«ãƒ¯ãƒ³ãƒ€</h3>
                    <p>ãƒ—ãƒ©ã‚¹ãƒãƒƒã‚¯ç¦æ­¢ãƒ»æ¸…æ½”æ”¿ç­–</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%"></div>
                    </div>
                    <small>æœªè¨ªå• - ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ¢æ¤œ</small>
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-secondary" onclick="showScreen('startScreen')">â† æˆ»ã‚‹</button>
                <button class="btn" onclick="showScreen('cityBuilder')">ğŸ™ï¸ éƒ½å¸‚ã‚’å»ºè¨­</button>
                <button class="btn" onclick="showScreen('cardCollection')">ğŸƒ ã‚«ãƒ¼ãƒ‰å›³é‘‘</button>
            </div>
        </div>

        <!-- å›½è©³ç´°ç”»é¢ -->
        <div id="countryDetail" class="screen">
            <div class="country-detail">
                <div class="country-header">
                    <div class="country-flag" id="detailFlag">ğŸ‡¯ğŸ‡µ</div>
                    <div class="country-info">
                        <h2 id="detailCountryName">æ—¥æœ¬</h2>
                        <p id="detailCountryDescription">æŒç¶šå¯èƒ½ãªç¤¾ä¼šã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®å…ˆé€²çš„ãªå–ã‚Šçµ„ã¿</p>
                    </div>
                </div>

                <div class="progress-container">
                    <h4>èª¿æŸ»é€²æ—</h4>
                    <div class="progress-bar">
                        <div class="progress-fill" id="detailProgress" style="width: 0%"></div>
                    </div>
                    <small id="detailProgressText">0% å®Œäº†</small>
                </div>

                <div class="cards-container" id="countryCards">
                    <!-- å›½ã®ã‚«ãƒ¼ãƒ‰ã¯JavaScriptã§ç”Ÿæˆ -->
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="showScreen('countrySelect')">â† å›½é¸æŠã«æˆ»ã‚‹</button>
                    <button class="btn" onclick="continueExploration()">ğŸ” ã•ã‚‰ã«æ¢æ¤œã™ã‚‹</button>
                </div>
            </div>
        </div>

        <!-- éƒ½å¸‚å»ºè¨­ç”»é¢ -->
        <div id="cityBuilder" class="screen">
            <div class="header">
                <h1>ğŸ™ï¸ ãƒã‚¤ã‚·ãƒ†ã‚£å»ºè¨­</h1>
                <p>ç²å¾—ã—ãŸã‚«ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦æŒç¶šå¯èƒ½ãªéƒ½å¸‚ã‚’å»ºè¨­ã—ã‚ˆã†</p>
            </div>

            <!-- ãƒªã‚½ãƒ¼ã‚¹è¡¨ç¤º -->
            <div class="resources-bar">
                <div class="resource">
                    <div>ğŸ’°</div>
                    <div class="resource-value" id="money">1,000,000</div>
                    <div>äºˆç®—</div>
                </div>
                <div class="resource">
                    <div>ğŸŒ¿</div>
                    <div class="resource-value" id="environment">50%</div>
                    <div>ç’°å¢ƒæŒ‡æ¨™</div>
                </div>
                <div class="resource">
                    <div>ğŸ˜Š</div>
                    <div class="resource-value" id="happiness">65%</div>
                    <div>å¸‚æ°‘å¹¸ç¦åº¦</div>
                </div>
                <div class="resource">
                    <div>âš¡</div>
                    <div class="resource-value" id="energy">75%</div>
                    <div>ã‚¨ãƒãƒ«ã‚®ãƒ¼</div>
                </div>
            </div>

            <div class="city-builder">
                <h3>ğŸ—ï¸ éƒ½å¸‚å»ºè¨­ã‚¨ãƒªã‚¢</h3>
                <p>ã‚°ãƒªãƒƒãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å»ºè¨­å ´æ‰€ã‚’é¸æŠã—ã€å³ã®æ–½è¨­ã‹ã‚‰å»ºè¨­ã—ã¦ãã ã•ã„</p>
                
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px;">
                    <!-- å»ºè¨­ã‚°ãƒªãƒƒãƒ‰ -->
                    <div>
                        <div class="city-grid" id="cityGrid">
                            <!-- ã‚°ãƒªãƒƒãƒ‰ã¯JavaScriptã§ç”Ÿæˆ -->
                        </div>
                    </div>

                    <!-- å»ºè¨­ã‚ªãƒ—ã‚·ãƒ§ãƒ³ -->
                    <div>
                        <h4>å»ºè¨­å¯èƒ½ãªæ–½è¨­</h4>
                        <div class="build-options" id="buildOptions">
                            <!-- å»ºè¨­ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯JavaScriptã§ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- ARãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
            <div class="ar-preview">
                <h3>ğŸ‘ï¸ ARéƒ½å¸‚ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>
                <p>ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã‚’å‹•ã‹ã—ã¦éƒ½å¸‚ã‚’360åº¦è¦‹ã¦ã¿ã‚ˆã†</p>
                <div class="ar-viewport" id="arViewport">
                    <div style="text-align: center;">
                        <div style="font-size: 3em; margin-bottom: 10px;">ğŸ“±</div>
                        <p>ARæ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã«ã¯<br>ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã§è¡¨ç¤ºã—ã¦ãã ã•ã„</p>
                    </div>
                </div>
                <button class="btn btn-ar" onclick="simulateAR()">ğŸ® ARã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ</button>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-secondary" onclick="showScreen('countrySelect')">ğŸŒ å›½ã‚’æ¢æ¤œ</button>
                <button class="btn" onclick="nextTurn()">â­ï¸ æ¬¡ã®ã‚¿ãƒ¼ãƒ³</button>
                <button class="btn" onclick="showScreen('cardCollection')">ğŸƒ ã‚«ãƒ¼ãƒ‰å›³é‘‘</button>
            </div>
        </div>

        <!-- ã‚«ãƒ¼ãƒ‰ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ç”»é¢ -->
        <div id="cardCollection" class="screen">
            <div class="header">
                <h1>ğŸƒ SDGsã‚«ãƒ¼ãƒ‰ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³</h1>
                <p>é›†ã‚ãŸã‚«ãƒ¼ãƒ‰ã§æ–°ã—ã„æŠ€è¡“ã‚’é–‹ç™ºã—ã‚ˆã†</p>
            </div>

            <div class="resources-bar">
                <div class="resource">
                    <div>ğŸƒ</div>
                    <div class="resource-value" id="totalCards">0/12</div>
                    <div>åé›†ã‚«ãƒ¼ãƒ‰</div>
                </div>
                <div class="resource">
                    <div>ğŸ†</div>
                    <div class="resource-value" id="completion">0%</div>
                    <div>ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆç‡</div>
                </div>
            </div>

            <div class="cards-container" id="cardsContainer">
                <!-- ã‚«ãƒ¼ãƒ‰ã¯JavaScriptã§ç”Ÿæˆ -->
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="showScreen('countrySelect')">ğŸŒ å›½ã‚’æ¢æ¤œ</button>
                <button class="btn btn-secondary" onclick="showScreen('cityBuilder')">ğŸ™ï¸ éƒ½å¸‚å»ºè¨­</button>
            </div>
        </div>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        const gameState = {
            currentScreen: 'startScreen',
            resources: {
                money: 1000000,
                environment: 50,
                happiness: 65,
                energy: 75
            },
            visitedCountries: {},
            collectedCards: [],
            builtFacilities: [],
            currentTurn: 1,
            selectedCell: null
        };

        // å›½ã®ãƒ‡ãƒ¼ã‚¿
        const countries = {
            japan: {
                name: 'æ—¥æœ¬',
                flag: 'ğŸ‡¯ğŸ‡µ',
                description: 'é«˜åº¦ãªæŠ€è¡“ã¨ä¼çµ±ã®èª¿å’Œã§æŒç¶šå¯èƒ½ãªç¤¾ä¼šã‚’å®Ÿç¾',
                cards: [
                    { id: 'japan_recycling', name: 'ã”ã¿åˆ†åˆ¥ã‚·ã‚¹ãƒ†ãƒ ', icon: 'ğŸ—‘ï¸', rarity: 'rare', description: 'ç´°ã‹ã„åˆ†åˆ¥ã§ãƒªã‚µã‚¤ã‚¯ãƒ«ç‡80%ã‚’é”æˆ', progress: 0 },
                    { id: 'japan_transit', name: 'å…¬å…±äº¤é€šãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯', icon: 'ğŸš†', rarity: 'epic', description: 'ä¸–ç•Œæœ€é«˜ãƒ¬ãƒ™ãƒ«ã®é‰„é“ã‚·ã‚¹ãƒ†ãƒ ', progress: 0 },
                    { id: 'japan_disaster', name: 'é˜²ç½æŠ€è¡“', icon: 'ğŸ¯', rarity: 'rare', description: 'åœ°éœ‡å¯¾ç­–ã¨æ—©æœŸè­¦æˆ’ã‚·ã‚¹ãƒ†ãƒ ', progress: 0 }
                ]
            },
            singapore: {
                name: 'ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ«',
                flag: 'ğŸ‡¸ğŸ‡¬',
                description: 'é™ã‚‰ã‚ŒãŸè³‡æºã‚’é€†æ‰‹ã«å–ã£ãŸé©æ–°çš„ãªè§£æ±ºç­–',
                cards: [
                    { id: 'singapore_water', name: 'NEWater', icon: 'ğŸ’§', rarity: 'epic', description: 'ä¸‹æ°´ã®é«˜åº¦å†ç”Ÿã§æ°´ã®40%ã‚’ä¾›çµ¦', progress: 0 },
                    { id: 'singapore_green', name: 'ã‚¬ãƒ¼ãƒ‡ãƒ³ã‚·ãƒ†ã‚£', icon: 'ğŸŒ¿', rarity: 'rare', description: 'å›½åœŸã®47%ãŒç·‘åœ°', progress: 0 }
                ]
            },
            germany: {
                name: 'ãƒ‰ã‚¤ãƒ„',
                flag: 'ğŸ‡©ğŸ‡ª',
                description: 'ã‚¨ãƒãƒ«ã‚®ãƒ¼è»¢æ›ã§æŒç¶šå¯èƒ½ãªæœªæ¥ã‚’å…ˆå°',
                cards: [
                    { id: 'germany_energy', name: 'ã‚¨ãƒãƒ«ã‚®ãƒ¼è»¢æ›', icon: 'âš¡', rarity: 'epic', description: 'å†ç”Ÿå¯èƒ½ã‚¨ãƒãƒ«ã‚®ãƒ¼46%ã‚’é”æˆ', progress: 0 },
                    { id: 'germany_recycling', name: 'ãƒ‡ãƒã‚¸ãƒƒãƒˆåˆ¶åº¦', icon: 'â™»ï¸', rarity: 'common', description: 'å®¹å™¨ã®å›åç‡98%ã‚’å®Ÿç¾', progress: 0 }
                ]
            },
            rwanda: {
                name: 'ãƒ«ãƒ¯ãƒ³ãƒ€',
                flag: 'ğŸ‡·ğŸ‡¼',
                description: 'å³æ ¼ãªæ”¿ç­–ã§ã‚¢ãƒ•ãƒªã‚«ã®æ¨¡ç¯„å›½ã«',
                cards: [
                    { id: 'rwanda_plastic', name: 'ãƒ—ãƒ©ã‚¹ãƒãƒƒã‚¯ç¦æ­¢', icon: 'ğŸš«', rarity: 'common', description: '2008å¹´ã‚ˆã‚Šãƒ“ãƒ‹ãƒ¼ãƒ«è¢‹ã‚’å…¨é¢ç¦æ­¢', progress: 0 },
                    { id: 'rwanda_clean', name: 'æ¸…æ½”æ”¿ç­–', icon: 'âœ¨', rarity: 'rare', description: 'ã‚¢ãƒ•ãƒªã‚«ã§æœ€ã‚‚æ¸…æ½”ãªéƒ½å¸‚ã«', progress: 0 }
                ]
            }
        };

        // å»ºè¨­å¯èƒ½ãªæ–½è¨­
        const facilities = {
            solar: { name: 'å¤ªé™½å…‰ç™ºé›»æ‰€', icon: 'â˜€ï¸', cost: 200000, effects: { energy: 20, environment: 15 }, requirements: [] },
            wind: { name: 'é¢¨åŠ›ç™ºé›»', icon: 'ğŸŒ¬ï¸', cost: 300000, effects: { energy: 25, environment: 20 }, requirements: [] },
            recycling: { name: 'ãƒªã‚µã‚¤ã‚¯ãƒ«æ–½è¨­', icon: 'â™»ï¸', cost: 150000, effects: { environment: 25, happiness: 5 }, requirements: ['japan_recycling'] },
            park: { name: 'éƒ½å¸‚å…¬åœ’', icon: 'ğŸŒ³', cost: 100000, effects: { happiness: 15, environment: 10 }, requirements: [] },
            research: { name: 'ç’°å¢ƒç ”ç©¶æ‰€', icon: 'ğŸ”¬', cost: 500000, effects: { happiness: 10, energy: 10, environment: 20 }, requirements: [] }
        };

        // ç”»é¢è¡¨ç¤º
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
            gameState.currentScreen = screenId;
            
            if (screenId === 'cityBuilder') {
                initializeCityBuilder();
            } else if (screenId === 'cardCollection') {
                updateCardCollection();
            }
        }

        // å¤§é™¸è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        function showContinent(continent) {
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            document.querySelectorAll('.card').forEach(card => {
                card.style.display = 'none';
            });
            document.querySelectorAll('.continent-' + continent).forEach(card => {
                card.style.display = 'block';
            });
        }

        // å›½ã‚’è¨ªå•
        function visitCountry(countryId) {
            const country = countries[countryId];
            if (!gameState.visitedCountries[countryId]) {
                gameState.visitedCountries[countryId] = { progress: 0, cards: {} };
            }
            
            // å›½è©³ç´°ç”»é¢ã‚’è¡¨ç¤º
            document.getElementById('detailFlag').textContent = country.flag;
            document.getElementById('detailCountryName').textContent = country.name;
            document.getElementById('detailCountryDescription').textContent = country.description;
            
            // ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤º
            const cardsContainer = document.getElementById('countryCards');
            cardsContainer.innerHTML = '';
            
            country.cards.forEach(card => {
                const cardProgress = gameState.visitedCountries[countryId].cards[card.id] || 0;
                const cardEl = document.createElement('div');
                cardEl.className = `card ${cardProgress >= 100 ? '' : 'disabled'}`;
                cardEl.innerHTML = `
                    <div class="card-rarity rarity-${card.rarity}">${getRarityText(card.rarity)}</div>
                    <div class="card-icon">${card.icon}</div>
                    <h3>${card.name}</h3>
                    <p>${card.description}</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${cardProgress}%"></div>
                    </div>
                    <small>${cardProgress >= 100 ? 'âœ… ç²å¾—æ¸ˆã¿' : `${cardProgress}% èª¿æŸ»å®Œäº†`}</small>
                `;
                
                if (cardProgress < 100) {
                    cardEl.onclick = () => studyCard(countryId, card.id);
                }
                
                cardsContainer.appendChild(cardEl);
            });
            
            updateCountryProgress(countryId);
            showScreen('countryDetail');
        }

        // ã‚«ãƒ¼ãƒ‰ã‚’èª¿æŸ»
        function studyCard(countryId, cardId) {
            const country = gameState.visitedCountries[countryId];
            if (!country.cards[cardId]) {
                country.cards[cardId] = 0;
            }
            
            country.cards[cardId] += 25;
            
            if (country.cards[cardId] >= 100) {
                // ã‚«ãƒ¼ãƒ‰ç²å¾—
                const cardData = countries[countryId].cards.find(c => c.id === cardId);
                if (!gameState.collectedCards.find(c => c.id === cardId)) {
                    gameState.collectedCards.push({
                        id: cardId,
                        name: cardData.name,
                        icon: cardData.icon,
                        rarity: cardData.rarity,
                        description: cardData.description,
                        country: countryId
                    });
                    showNotification(`ğŸ‰ ã‚«ãƒ¼ãƒ‰ã€Œ${cardData.name}ã€ã‚’ç²å¾—ã—ã¾ã—ãŸï¼`);
                }
            }
            
            updateCountryProgress(countryId);
            visitCountry(countryId); // ç”»é¢ã‚’æ›´æ–°
        }

        // å›½ã®é€²æ—ã‚’æ›´æ–°
        function updateCountryProgress(countryId) {
            const country = gameState.visitedCountries[countryId];
            const totalCards = countries[countryId].cards.length;
            let completed = 0;
            let totalProgress = 0;
            
            countries[countryId].cards.forEach(card => {
                const progress = country.cards[card.id] || 0;
                totalProgress += progress;
                if (progress >= 100) completed++;
            });
            
            const avgProgress = totalProgress / totalCards;
            document.getElementById('detailProgress').style.width = avgProgress + '%';
            document.getElementById('detailProgressText').textContent = `${Math.round(avgProgress)}% å®Œäº† (${completed}/${totalCards} ã‚«ãƒ¼ãƒ‰ç²å¾—)`;
        }

        // ã•ã‚‰ã«æ¢æ¤œ
        function continueExploration() {
            showNotification('ğŸ” ã•ã‚‰ã«è©³ã—ãèª¿æŸ»ã‚’ç¶šã‘ã¦ã„ã¾ã™...');
            // ã“ã“ã§è¿½åŠ ã®èª¿æŸ»ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤ºã§ãã‚‹
        }

        // éƒ½å¸‚å»ºè¨­ã®åˆæœŸåŒ–
        function initializeCityBuilder() {
            initializeCityGrid();
            updateBuildOptions();
            updateResourceDisplay();
            initializeARView();
        }

        // éƒ½å¸‚ã‚°ãƒªãƒƒãƒ‰ã®åˆæœŸåŒ–
        function initializeCityGrid() {
            const grid = document.getElementById('cityGrid');
            grid.innerHTML = '';
            
            for (let i = 0; i < 36; i++) {
                const cell = document.createElement('div');
                cell.className = 'grid-cell';
                cell.innerHTML = 'ï¼‹';
                cell.onclick = () => selectGridCell(i, cell);
                grid.appendChild(cell);
            }
        }

        // ã‚°ãƒªãƒƒãƒ‰ã‚»ãƒ«é¸æŠ
        function selectGridCell(index, cellElement) {
            document.querySelectorAll('.grid-cell').forEach(cell => {
                cell.classList.remove('selected');
            });
            
            cellElement.classList.add('selected');
            gameState.selectedCell = index;
            
            showNotification('ğŸ“ å»ºè¨­å ´æ‰€ã‚’é¸æŠã—ã¾ã—ãŸ');
        }

        // å»ºè¨­ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æ›´æ–°
        function updateBuildOptions() {
            const container = document.getElementById('buildOptions');
            container.innerHTML = '';
            
            Object.entries(facilities).forEach(([id, facility]) => {
                const canBuild = canBuildFacility(id);
                const option = document.createElement('div');
                option.className = `build-option ${canBuild ? 'available' : ''}`;
                option.innerHTML = `
                    <div style="font-size: 2em; margin-bottom: 10px;">${facility.icon}</div>
                    <h4>${facility.name}</h4>
                    <p>ğŸ’° ${facility.cost.toLocaleString()}</p>
                    <div style="font-size: 0.9em; opacity: 0.8;">
                        ${canBuild ? 'âœ… å»ºè¨­å¯èƒ½' : 'âŒ æ¡ä»¶æœªé”æˆ'}
                    </div>
                `;
                
                if (canBuild) {
                    option.onclick = () => buildFacility(id);
                }
                
                container.appendChild(option);
            });
        }

        // æ–½è¨­å»ºè¨­ã®æ¡ä»¶ãƒã‚§ãƒƒã‚¯
        function canBuildFacility(facilityId) {
            const facility = facilities[facilityId];
            return facility.requirements.every(req => 
                gameState.collectedCards.some(card => card.id === req)
            );
        }

        // æ–½è¨­ã‚’å»ºè¨­
        function buildFacility(facilityId) {
            if (gameState.selectedCell === null) {
                showNotification('âŒ ã¾ãšå»ºè¨­å ´æ‰€ã‚’é¸ã‚“ã§ãã ã•ã„');
                return;
            }
            
            const facility = facilities[facilityId];
            
            if (gameState.resources.money < facility.cost) {
                showNotification('âŒ äºˆç®—ãŒè¶³ã‚Šã¾ã›ã‚“');
                return;
            }
            
            // å»ºè¨­å‡¦ç†
            gameState.resources.money -= facility.cost;
            Object.entries(facility.effects).forEach(([resource, value]) => {
                gameState.resources[resource] = Math.min(100, gameState.resources[resource] + value);
            });
            
            // ã‚°ãƒªãƒƒãƒ‰æ›´æ–°
            const cell = document.querySelectorAll('.grid-cell')[gameState.selectedCell];
            cell.classList.add('built');
            cell.innerHTML = facility.icon;
            cell.title = facility.name;
            
            gameState.builtFacilities.push({
                id: facilityId,
                cell: gameState.selectedCell,
                name: facility.name
            });
            
            updateResourceDisplay();
            updateBuildOptions();
            updateARView();
            showNotification(`ğŸ—ï¸ ${facility.name}ã‚’å»ºè¨­ã—ã¾ã—ãŸï¼`);
            
            gameState.selectedCell = null;
            document.querySelectorAll('.grid-cell').forEach(cell => {
                cell.classList.remove('selected');
            });
        }

        // ãƒªã‚½ãƒ¼ã‚¹è¡¨ç¤ºã®æ›´æ–°
        function updateResourceDisplay() {
            document.getElementById('money').textContent = gameState.resources.money.toLocaleString();
            document.getElementById('environment').textContent = gameState.resources.environment + '%';
            document.getElementById('happiness').textContent = gameState.resources.happiness + '%';
            document.getElementById('energy').textContent = gameState.resources.energy + '%';
        }

        // æ¬¡ã®ã‚¿ãƒ¼ãƒ³
        function nextTurn() {
            gameState.currentTurn++;
            gameState.resources.money += 50000; // ã‚¿ãƒ¼ãƒ³åå…¥
            
            // ãƒ©ãƒ³ãƒ€ãƒ ã‚¤ãƒ™ãƒ³ãƒˆ
            const events = [
                { message: 'ğŸŒ§ï¸ å¤§é›¨ã§ã‚¨ãƒãƒ«ã‚®ãƒ¼ç”Ÿç”£ãŒå¢—åŠ ', effect: { energy: 10 } },
                { message: 'ğŸ‰ å¸‚æ°‘ç¥­ã‚Šã§å¹¸ç¦åº¦ä¸Šæ˜‡', effect: { happiness: 8 } },
                { message: 'ğŸ“ˆ è¦³å…‰å®¢ãŒå¢—åŠ ', effect: { money: 100000 } },
                { message: 'ğŸŒªï¸ åµã§æ–½è¨­ãŒè¢«å®³', effect: { energy: -15, happiness: -5 } }
            ];
            
            const randomEvent = events[Math.floor(Math.random() * events.length)];
            showNotification(randomEvent.message);
            
            // åŠ¹æœé©ç”¨
            Object.keys(randomEvent.effect).forEach(resource => {
                if (resource === 'money') {
                    gameState.resources[resource] += randomEvent.effect[resource];
                } else {
                    gameState.resources[resource] = Math.max(0, 
                        Math.min(100, gameState.resources[resource] + randomEvent.effect[resource])
                    );
                }
            });
            
            updateResourceDisplay();
            showNotification(`â° ã‚¿ãƒ¼ãƒ³ ${gameState.currentTurn} ãŒçµ‚äº†ã—ã¾ã—ãŸ`);
        }

        // ARãƒ“ãƒ¥ãƒ¼ã®åˆæœŸåŒ–
        function initializeARView() {
            updateARView();
        }

        // ARãƒ“ãƒ¥ãƒ¼ã®æ›´æ–°
        function updateARView() {
            const viewport = document.getElementById('arViewport');
            viewport.innerHTML = '';
            
            gameState.builtFacilities.forEach((facility, index) => {
                const building = document.createElement('div');
                building.className = 'ar-building';
                building.innerHTML = facilities[facility.id].icon;
                building.style.fontSize = '2em';
                building.style.left = (20 + (index % 3) * 30) + '%';
                building.style.bottom = (20 + Math.floor(index / 3) * 25) + '%';
                building.title = facility.name;
                viewport.appendChild(building);
            });
            
            if (gameState.builtFacilities.length === 0) {
                viewport.innerHTML = `
                    <div style="text-align: center;">
                        <div style="font-size: 3em; margin-bottom: 10px;">ğŸ—ï¸</div>
                        <p>æ–½è¨­ã‚’å»ºè¨­ã™ã‚‹ã¨ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>
                    </div>
                `;
            }
        }

        // ARã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        function simulateAR() {
            showNotification('ğŸ® ARã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹... ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã§å®Ÿéš›ã®ARä½“é¨“ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ï¼');
            document.getElementById('arViewport').style.background = 'linear-gradient(45deg, #00b894, #0984e3)';
            setTimeout(() => {
                document.getElementById('arViewport').style.background = 'linear-gradient(45deg, #1a2a6c, #b21f1f)';
            }, 2000);
        }

        // ã‚«ãƒ¼ãƒ‰ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®æ›´æ–°
        function updateCardCollection() {
            const container = document.getElementById('cardsContainer');
            const totalCards = document.getElementById('totalCards');
            const completion = document.getElementById('completion');
            
            container.innerHTML = '';
            
            // ã™ã¹ã¦ã®å›½ã®ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤º
            Object.values(countries).forEach(country => {
                country.cards.forEach(card => {
                    const collected = gameState.collectedCards.find(c => c.id === card.id);
                    const cardEl = document.createElement('div');
                    cardEl.className = `card ${collected ? '' : 'disabled'}`;
                    cardEl.innerHTML = `
                        <div class="card-rarity rarity-${card.rarity}">${getRarityText(card.rarity)}</div>
                        <div class="card-icon">${card.icon}</div>
                        <h3>${card.name}</h3>
                        <p>${card.description}</p>
                        <div style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">
                            ${collected ? 'âœ… æ‰€æŒæ¸ˆã¿' : 'ğŸ”’ æœªç²å¾—'}
                        </div>
                    `;
                    container.appendChild(cardEl);
                });
            });
            
            // çµ±è¨ˆæ›´æ–°
            const totalCardCount = Object.values(countries).reduce((sum, country) => sum + country.cards.length, 0);
            const collectedCount = gameState.collectedCards.length;
            totalCards.textContent = `${collectedCount}/${totalCardCount}`;
            completion.textContent = `${Math.round((collectedCount / totalCardCount) * 100)}%`;
        }

        // ãƒ¬ã‚¢ãƒªãƒ†ã‚£ãƒ†ã‚­ã‚¹ãƒˆ
        function getRarityText(rarity) {
            const texts = { common: 'ãƒãƒ¼ãƒãƒ«', rare: 'ãƒ¬ã‚¢', epic: 'ã‚¨ãƒ”ãƒƒã‚¯' };
            return texts[rarity] || rarity;
        }

        // é€šçŸ¥æ©Ÿèƒ½
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }

        // åˆæœŸåŒ–
        window.onload = function() {
            showNotification('ğŸ® SDGs World Builderã‚’é–‹å§‹ã—ã¾ã—ãŸï¼');
        };
    </script>
</body>
</html>
