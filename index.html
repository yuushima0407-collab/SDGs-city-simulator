<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDGs World Builder - Advanced</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* 画面管理 */
        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        /* ヘッダー */
        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #00b894, #00cec9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* ナビゲーション */
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .nav-tab.active {
            background: #00b894;
            border-color: #00cec9;
        }

        /* カードシステム */
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }

        .card:hover::before {
            left: 100%;
        }

        .card:hover {
            transform: translateY(-5px) scale(1.02);
            border-color: #00cec9;
            box-shadow: 0 15px 30px rgba(0, 206, 201, 0.3);
        }

        .card.disabled {
            opacity: 0.4;
            cursor: not-allowed;
            filter: grayscale(1);
        }

        .card.new {
            border-color: #fdcb6e;
            animation: pulse 2s infinite;
        }

        .card-icon {
            font-size: 3em;
            margin-bottom: 15px;
            text-align: center;
        }

        .card-rarity {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.7em;
            font-weight: bold;
        }

        .rarity-common { background: #636e72; }
        .rarity-rare { background: #0984e3; }
        .rarity-epic { background: #6c5ce7; }
        .rarity-legendary { background: #fdcb6e; color: #000; }

        /* 技術ツリー */
        .tech-tree {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .tech-level {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
        }

        .tech-level h4 {
            color: #00cec9;
            margin-bottom: 10px;
            border-bottom: 2px solid #00cec9;
            padding-bottom: 5px;
        }

        .tech-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            margin: 8px 0;
            border-radius: 8px;
            border-left: 4px solid #00b894;
            transition: all 0.3s ease;
        }

        .tech-item.unlocked {
            background: rgba(0, 184, 148, 0.2);
            border-left-color: #fdcb6e;
        }

        .tech-item.available {
            cursor: pointer;
            border-left-color: #74b9ff;
        }

        .tech-item.available:hover {
            background: rgba(116, 185, 255, 0.2);
            transform: translateX(5px);
        }

        /* ARプレビュー */
        .ar-preview {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            border: 2px dashed #00cec9;
        }

        .ar-placeholder {
            width: 100%;
            height: 300px;
            background: linear-gradient(45deg, #1a2a6c, #b21f1f);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            margin: 15px 0;
        }

        /* 達成度 */
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .achievement {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .achievement.unlocked {
            background: rgba(253, 203, 110, 0.2);
            border: 2px solid #fdcb6e;
        }

        .achievement-icon {
            font-size: 2em;
            flex-shrink: 0;
        }

        .achievement-progress {
            flex-grow: 1;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin: 5px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00b894, #00cec9);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* リソースバー */
        .resources-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .resource {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .resource:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.15);
        }

        .resource-value {
            font-size: 1.8em;
            font-weight: bold;
            margin: 8px 0;
        }

        /* ボタン */
        .btn {
            background: linear-gradient(45deg, #00b894, #00cec9);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
            font-size: 1em;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 184, 148, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .btn-ar {
            background: linear-gradient(45deg, #6c5ce7, #a29bfe);
        }

        /* アニメーション */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* 通知 */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            z-index: 1000;
            animation: slideIn 0.5s ease;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            max-width: 400px;
        }

        /* グリッドシステム */
        .city-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            margin: 20px 0;
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
        }

        .grid-cell {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.5em;
        }

        .grid-cell:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .grid-cell.built {
            background: rgba(0, 184, 148, 0.3);
        }

        .grid-cell.selected {
            background: rgba(0, 206, 201, 0.5);
            box-shadow: 0 0 15px rgba(0, 206, 201, 0.5);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- カードコレクション画面 -->
        <div id="cardCollection" class="screen active">
            <div class="header">
                <h1>🃏 SDGsカードコレクション</h1>
                <p>世界中の持続可能な技術を集めよう！</p>
            </div>

            <div class="nav-tabs">
                <div class="nav-tab active" onclick="showCardTab('all')">すべてのカード</div>
                <div class="nav-tab" onclick="showCardTab('japan')">🇯🇵 日本</div>
                <div class="nav-tab" onclick="showCardTab('germany')">🇩🇪 ドイツ</div>
                <div class="nav-tab" onclick="showCardTab('rwanda')">🇷🇼 ルワンダ</div>
                <div class="nav-tab" onclick="showCardTab('singapore')">🇸🇬 シンガポール</div>
                <div class="nav-tab" onclick="showCardTab('norway')">🇳🇴 ノルウェー</div>
            </div>

            <div class="resources-bar">
                <div class="resource">
                    <div>🃏</div>
                    <div class="resource-value" id="totalCards">5/25</div>
                    <div>収集カード</div>
                </div>
                <div class="resource">
                    <div>🏆</div>
                    <div class="resource-value" id="completion">20%</div>
                    <div>コンプリート率</div>
                </div>
                <div class="resource">
                    <div>⭐</div>
                    <div class="resource-value" id="collectionScore">150</div>
                    <div>コレクションスコア</div>
                </div>
            </div>

            <div class="cards-container" id="cardsContainer">
                <!-- カードはJavaScriptで動的に生成 -->
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="showScreen('countrySelect')">🌍 国を探検</button>
                <button class="btn btn-secondary" onclick="showScreen('techTree')">🔬 技術ツリー</button>
                <button class="btn btn-secondary" onclick="showScreen('cityBuilder')">🏙️ 都市建設</button>
                <button class="btn btn-ar" onclick="showScreen('arView')">👁️ ARで見る</button>
            </div>
        </div>

        <!-- 技術ツリー画面 -->
        <div id="techTree" class="screen">
            <div class="header">
                <h1>🔬 技術開発ツリー</h1>
                <p>カードを組み合わせて新しい技術を開発しよう</p>
            </div>

            <div class="tech-tree">
                <div class="tech-level">
                    <h4>🌱 レベル1: 基本技術</h4>
                    <div class="tech-item unlocked" onclick="researchTech('basic_recycling')">
                        <strong>基本リサイクル</strong>
                        <div>リサイクル率+20%</div>
                        <small>✅ 解放済み</small>
                    </div>
                    <div class="tech-item available" onclick="researchTech('solar_power')">
                        <strong>太陽光発電</strong>
                        <div>エネルギー+15% 環境+10%</div>
                        <small>🔓 解放可能</small>
                    </div>
                </div>

                <div class="tech-level">
                    <h4>🚀 レベル2: 高度技術</h4>
                    <div class="tech-item" onclick="researchTech('smart_grid')">
                        <strong>スマートグリッド</strong>
                        <div>🇯🇵日本 + 🇩🇪ドイツが必要</div>
                        <small>🔒 カード不足</small>
                    </div>
                    <div class="tech-item" onclick="researchTech('water_recycling')">
                        <strong>高度水循環</strong>
                        <div>🇸🇬シンガポール + 🇯🇵日本が必要</div>
                        <small>🔒 カード不足</small>
                    </div>
                </div>

                <div class="tech-level">
                    <h4>🌟 レベル3: 未来技術</h4>
                    <div class="tech-item" onclick="researchTech('carbon_capture')">
                        <strong>二酸化炭素回収</strong>
                        <div>すべての国のカードが必要</div>
                        <small>🔒 未解放</small>
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="showScreen('cardCollection')">🃏 カード図鑑</button>
                <button class="btn btn-secondary" onclick="showScreen('achievements')">🏆 実績</button>
            </div>
        </div>

        <!-- ARビューワー -->
        <div id="arView" class="screen">
            <div class="header">
                <h1>👁️ AR都市プレビュー</h1>
                <p>スマートフォンを動かして都市を360度見よう</p>
            </div>

            <div class="ar-preview">
                <div class="ar-placeholder">
                    📱 スマートフォンで表示
                </div>
                <p>スマートフォンでこのページを開くと、AR機能が利用できます</p>
                <div class="cards-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0;">
                    <div class="card" onclick="placeARBuilding('solar')">
                        <div class="card-icon">☀️</div>
                        <h4>太陽光発電所</h4>
                    </div>
                    <div class="card" onclick="placeARBuilding('wind')">
                        <div class="card-icon">🌬️</div>
                        <h4>風力発電</h4>
                    </div>
                    <div class="card" onclick="placeARBuilding('recycling')">
                        <div class="card-icon">♻️</div>
                        <h4>リサイクル施設</h4>
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="showScreen('cardCollection')">← 戻る</button>
                <button class="btn btn-ar" onclick="simulateAR()">🎮 ARをシミュレート</button>
            </div>
        </div>

        <!-- 実績画面 -->
        <div id="achievements" class="screen">
            <div class="header">
                <h1>🏆 実績と記録</h1>
                <p>あなたのSDGsへの貢献を称えましょう</p>
            </div>

            <div class="achievements-grid">
                <div class="achievement unlocked">
                    <div class="achievement-icon">🌍</div>
                    <div class="achievement-progress">
                        <strong>世界探検家</strong>
                        <div>3カ国を訪問</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 60%"></div>
                        </div>
                        <small>5カ国で達成</small>
                    </div>
                </div>

                <div class="achievement">
                    <div class="achievement-icon">🏙️</div>
                    <div class="achievement-progress">
                        <strong>都市設計士</strong>
                        <div>5つの施設を建設</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 40%"></div>
                        </div>
                        <small>3/5 施設</small>
                    </div>
                </div>

                <div class="achievement unlocked">
                    <div class="achievement-icon">🔬</div>
                    <div class="achievement-progress">
                        <strong>技術革新者</strong>
                        <div>最初の技術を開発</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 100%"></div>
                        </div>
                        <small>達成済み！</small>
                    </div>
                </div>

                <div class="achievement">
                    <div class="achievement-icon">💚</div>
                    <div class="achievement-progress">
                        <strong>環境保護者</strong>
                        <div>環境指標80%達成</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 65%"></div>
                        </div>
                        <small>現在: 65%</small>
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="showScreen('techTree')">🔬 技術ツリー</button>
                <button class="btn btn-secondary" onclick="showScreen('cardCollection')">🃏 カード図鑑</button>
            </div>
        </div>

        <!-- 既存の画面（国選択、都市建設）は前回のコードを統合 -->
    </div>

    <script>
        // 拡張ゲーム状態
        const advancedGameState = {
            currentScreen: 'cardCollection',
            collectedCards: [
                { id: 'japan_recycling', country: 'japan', name: '日本のごみ分別', rarity: 'rare', description: '高度な分別技術でリサイクル率向上', unlocked: true, new: true },
                { id: 'germany_energy', country: 'germany', name: 'ドイツのエネルギー転換', rarity: 'epic', description: '再生可能エネルギー推進政策', unlocked: true, new: false },
                { id: 'rwanda_plastic', country: 'rwanda', name: 'ルワンダのプラスチック禁止', rarity: 'common', description: '厳格なプラスチック規制', unlocked: true, new: true },
                { id: 'singapore_water', country: 'singapore', name: 'シンガポールの水管理', rarity: 'rare', description: 'NEWaterによる水の自給', unlocked: true, new: false },
                { id: 'norway_ev', country: 'norway', name: 'ノルウェーのEV普及', rarity: 'epic', description: '電気自動車の積極的導入', unlocked: true, new: true }
            ],
            researchedTechs: ['basic_recycling'],
            achievements: {
                countries_visited: 3,
                facilities_built: 3,
                techs_researched: 1,
                environment_score: 65
            },
            arBuildings: []
        };

        // 利用可能なカードデータ
        const allCards = [
            // 日本のカード
            { id: 'japan_recycling', country: 'japan', name: '日本のごみ分別', rarity: 'rare', icon: '🗑️', description: '高度な分別技術でリサイクル率80%を達成' },
            { id: 'japan_disaster', country: 'japan', name: '日本の防災技術', rarity: 'epic', icon: '🏯', description: '地震対策と早期警戒システム' },
            { id: 'japan_transit', country: 'japan', name: '日本の公共交通', rarity: 'rare', icon: '🚆', description: '世界最高レベルの鉄道ネットワーク' },
            
            // ドイツのカード
            { id: 'germany_energy', country: 'germany', name: 'エネルギー転換', rarity: 'epic', icon: '⚡', description: '再生可能エネルギー46%を達成' },
            { id: 'germany_recycling', country: 'germany', name: 'デポジット制度', rarity: 'common', icon: '♻️', description: '容器の回収率98%を実現' },
            
            // ルワンダのカード
            { id: 'rwanda_plastic', country: 'rwanda', name: 'プラスチック禁止', rarity: 'common', icon: '🚫', description: '2008年よりビニール袋を全面禁止' },
            { id: 'rwanda_clean', country: 'rwanda', name: '清潔政策', rarity: 'rare', icon: '✨', description: 'アフリカで最も清潔な都市に' },
            
            // シンガポールのカード
            { id: 'singapore_water', country: 'singapore', name: 'NEWater', rarity: 'rare', icon: '💧', description: '下水の高度再生で水の40%を供給' },
            { id: 'singapore_green', country: 'singapore', name: 'ガーデンシティ', rarity: 'epic', icon: '🌿', description: '国土の47%が緑地' },
            
            // ノルウェーのカード
            { id: 'norway_ev', country: 'norway', name: 'EV革命', rarity: 'epic', icon: '🚗', description: '新車販売の80%が電気自動車' },
            { id: 'norway_hydro', country: 'norway', name: '水力発電', rarity: 'rare', icon: '💦', description: '電力の95%を水力で賄う' }
        ];

        // 画面表示
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
            advancedGameState.currentScreen = screenId;
            
            if (screenId === 'cardCollection') {
                updateCardCollection();
            } else if (screenId === 'techTree') {
                updateTechTree();
            } else if (screenId === 'achievements') {
                updateAchievements();
            }
        }

        // カードコレクションの更新
        function updateCardCollection() {
            const container = document.getElementById('cardsContainer');
            const totalCards = document.getElementById('totalCards');
            const completion = document.getElementById('completion');
            const score = document.getElementById('collectionScore');
            
            // カード表示
            container.innerHTML = '';
            
            allCards.forEach(card => {
                const collected = advancedGameState.collectedCards.find(c => c.id === card.id);
                const cardElement = document.createElement('div');
                cardElement.className = `card ${collected ? '' : 'disabled'} ${collected?.new ? 'new' : ''}`;
                cardElement.innerHTML = `
                    <div class="card-rarity rarity-${card.rarity}">${getRarityText(card.rarity)}</div>
                    <div class="card-icon">${card.icon}</div>
                    <h3>${card.name}</h3>
                    <p>${card.description}</p>
                    <div style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">
                        ${collected ? '✅ 所持済み' : '🔒 未所持'}
                    </div>
                `;
                
                if (collected) {
                    cardElement.onclick = () => showCardDetail(card);
                }
                
                container.appendChild(cardElement);
            });
            
            // 統計更新
            const collectedCount = advancedGameState.collectedCards.length;
            totalCards.textContent = `${collectedCount}/${allCards.length}`;
            completion.textContent = `${Math.round((collectedCount / allCards.length) * 100)}%`;
            score.textContent = calculateCollectionScore();
        }

        function getRarityText(rarity) {
            const texts = { common: 'ノーマル', rare: 'レア', epic: 'エピック', legendary: 'レジェンド' };
            return texts[rarity] || rarity;
        }

        function calculateCollectionScore() {
            const scores = { common: 10, rare: 30, epic: 100, legendary: 300 };
            return advancedGameState.collectedCards.reduce((score, card) => {
                return score + (scores[card.rarity] || 0);
            }, 0);
        }

        // カードタブ表示
        function showCardTab(country) {
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // ここで国別フィルタリングを実装
            updateCardCollection(); // 簡易実装
        }

        // 技術研究
        function researchTech(techId) {
            const techElement = event.target.closest('.tech-item');
            if (techElement.classList.contains('available')) {
                advancedGameState.researchedTechs.push(techId);
                techElement.classList.remove('available');
                techElement.classList.add('unlocked');
                techElement.querySelector('small').textContent = '✅ 研究完了';
                showNotification(`🔬 新しい技術「${getTechName(techId)}」を開発しました！`);
                updateAchievements();
            }
        }

        function getTechName(techId) {
            const names = {
                'basic_recycling': '基本リサイクル',
                'solar_power': '太陽光発電',
                'smart_grid': 'スマートグリッド',
                'water_recycling': '高度水循環',
                'carbon_capture': '二酸化炭素回収'
            };
            return names[techId] || techId;
        }

        // AR機能
        function placeARBuilding(type) {
            advancedGameState.arBuildings.push(type);
            showNotification(`🏗️ ARで${getBuildingName(type)}を設置しました`);
        }

        function getBuildingName(type) {
            const names = { solar: '太陽光発電所', wind: '風力発電', recycling: 'リサイクル施設' };
            return names[type] || type;
        }

        function simulateAR() {
            showNotification('🎮 ARシミュレーションを開始... スマートフォンで実際のARをお楽しみください！');
        }

        // 実績更新
        function updateAchievements() {
            // 実績進捗を更新
            advancedGameState.achievements.techs_researched = advancedGameState.researchedTechs.length;
            // ここで実績UIを更新
        }

        // カード詳細表示
        function showCardDetail(card) {
            showNotification(`🃏 ${card.name}: ${card.description}`);
            // 新しいフラグを解除
            const collectedCard = advancedGameState.collectedCards.find(c => c.id === card.id);
            if (collectedCard) {
                collectedCard.new = false;
            }
            updateCardCollection();
        }

        // 技術ツリー更新
        function updateTechTree() {
            // 技術ツリーの状態を更新
            document.querySelectorAll('.tech-item').forEach(item => {
                const techId = item.getAttribute('onclick')?.match(/'(.*?)'/)?.[1];
                if (techId && advancedGameState.researchedTechs.includes(techId)) {
                    item.classList.remove('available');
                    item.classList.add('unlocked');
                    item.querySelector('small').textContent = '✅ 研究完了';
                }
            });
        }

        // 通知機能
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }

        // 初期化
        window.onload = function() {
            updateCardCollection();
            showNotification('🎉 新しいカードが追加されました！');
        };
    </script>
</body>
</html>
