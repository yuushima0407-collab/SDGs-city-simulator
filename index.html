<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDGs World Builder - Advanced</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* ç”»é¢ç®¡ç† */
        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #00b894, #00cec9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .nav-tab.active {
            background: #00b894;
            border-color: #00cec9;
        }

        /* ã‚«ãƒ¼ãƒ‰ã‚·ã‚¹ãƒ†ãƒ  */
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }

        .card:hover::before {
            left: 100%;
        }

        .card:hover {
            transform: translateY(-5px) scale(1.02);
            border-color: #00cec9;
            box-shadow: 0 15px 30px rgba(0, 206, 201, 0.3);
        }

        .card.disabled {
            opacity: 0.4;
            cursor: not-allowed;
            filter: grayscale(1);
        }

        .card.new {
            border-color: #fdcb6e;
            animation: pulse 2s infinite;
        }

        .card-icon {
            font-size: 3em;
            margin-bottom: 15px;
            text-align: center;
        }

        .card-rarity {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.7em;
            font-weight: bold;
        }

        .rarity-common { background: #636e72; }
        .rarity-rare { background: #0984e3; }
        .rarity-epic { background: #6c5ce7; }
        .rarity-legendary { background: #fdcb6e; color: #000; }

        /* æŠ€è¡“ãƒ„ãƒªãƒ¼ */
        .tech-tree {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .tech-level {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
        }

        .tech-level h4 {
            color: #00cec9;
            margin-bottom: 10px;
            border-bottom: 2px solid #00cec9;
            padding-bottom: 5px;
        }

        .tech-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            margin: 8px 0;
            border-radius: 8px;
            border-left: 4px solid #00b894;
            transition: all 0.3s ease;
        }

        .tech-item.unlocked {
            background: rgba(0, 184, 148, 0.2);
            border-left-color: #fdcb6e;
        }

        .tech-item.available {
            cursor: pointer;
            border-left-color: #74b9ff;
        }

        .tech-item.available:hover {
            background: rgba(116, 185, 255, 0.2);
            transform: translateX(5px);
        }

        /* ARãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */
        .ar-preview {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            border: 2px dashed #00cec9;
        }

        .ar-placeholder {
            width: 100%;
            height: 300px;
            background: linear-gradient(45deg, #1a2a6c, #b21f1f);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            margin: 15px 0;
        }

        /* é”æˆåº¦ */
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .achievement {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .achievement.unlocked {
            background: rgba(253, 203, 110, 0.2);
            border: 2px solid #fdcb6e;
        }

        .achievement-icon {
            font-size: 2em;
            flex-shrink: 0;
        }

        .achievement-progress {
            flex-grow: 1;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin: 5px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00b894, #00cec9);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* ãƒªã‚½ãƒ¼ã‚¹ãƒãƒ¼ */
        .resources-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .resource {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .resource:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.15);
        }

        .resource-value {
            font-size: 1.8em;
            font-weight: bold;
            margin: 8px 0;
        }

        /* ãƒœã‚¿ãƒ³ */
        .btn {
            background: linear-gradient(45deg, #00b894, #00cec9);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
            font-size: 1em;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 184, 148, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .btn-ar {
            background: linear-gradient(45deg, #6c5ce7, #a29bfe);
        }

        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* é€šçŸ¥ */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            z-index: 1000;
            animation: slideIn 0.5s ease;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            max-width: 400px;
        }

        /* ã‚°ãƒªãƒƒãƒ‰ã‚·ã‚¹ãƒ†ãƒ  */
        .city-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            margin: 20px 0;
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
        }

        .grid-cell {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.5em;
        }

        .grid-cell:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .grid-cell.built {
            background: rgba(0, 184, 148, 0.3);
        }

        .grid-cell.selected {
            background: rgba(0, 206, 201, 0.5);
            box-shadow: 0 0 15px rgba(0, 206, 201, 0.5);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- ã‚«ãƒ¼ãƒ‰ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ç”»é¢ -->
        <div id="cardCollection" class="screen active">
            <div class="header">
                <h1>ğŸƒ SDGsã‚«ãƒ¼ãƒ‰ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³</h1>
                <p>ä¸–ç•Œä¸­ã®æŒç¶šå¯èƒ½ãªæŠ€è¡“ã‚’é›†ã‚ã‚ˆã†ï¼</p>
            </div>

            <div class="nav-tabs">
                <div class="nav-tab active" onclick="showCardTab('all')">ã™ã¹ã¦ã®ã‚«ãƒ¼ãƒ‰</div>
                <div class="nav-tab" onclick="showCardTab('japan')">ğŸ‡¯ğŸ‡µ æ—¥æœ¬</div>
                <div class="nav-tab" onclick="showCardTab('germany')">ğŸ‡©ğŸ‡ª ãƒ‰ã‚¤ãƒ„</div>
                <div class="nav-tab" onclick="showCardTab('rwanda')">ğŸ‡·ğŸ‡¼ ãƒ«ãƒ¯ãƒ³ãƒ€</div>
                <div class="nav-tab" onclick="showCardTab('singapore')">ğŸ‡¸ğŸ‡¬ ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ«</div>
                <div class="nav-tab" onclick="showCardTab('norway')">ğŸ‡³ğŸ‡´ ãƒãƒ«ã‚¦ã‚§ãƒ¼</div>
            </div>

            <div class="resources-bar">
                <div class="resource">
                    <div>ğŸƒ</div>
                    <div class="resource-value" id="totalCards">5/25</div>
                    <div>åé›†ã‚«ãƒ¼ãƒ‰</div>
                </div>
                <div class="resource">
                    <div>ğŸ†</div>
                    <div class="resource-value" id="completion">20%</div>
                    <div>ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆç‡</div>
                </div>
                <div class="resource">
                    <div>â­</div>
                    <div class="resource-value" id="collectionScore">150</div>
                    <div>ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚¹ã‚³ã‚¢</div>
                </div>
            </div>

            <div class="cards-container" id="cardsContainer">
                <!-- ã‚«ãƒ¼ãƒ‰ã¯JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="showScreen('countrySelect')">ğŸŒ å›½ã‚’æ¢æ¤œ</button>
                <button class="btn btn-secondary" onclick="showScreen('techTree')">ğŸ”¬ æŠ€è¡“ãƒ„ãƒªãƒ¼</button>
                <button class="btn btn-secondary" onclick="showScreen('cityBuilder')">ğŸ™ï¸ éƒ½å¸‚å»ºè¨­</button>
                <button class="btn btn-ar" onclick="showScreen('arView')">ğŸ‘ï¸ ARã§è¦‹ã‚‹</button>
            </div>
        </div>

        <!-- æŠ€è¡“ãƒ„ãƒªãƒ¼ç”»é¢ -->
        <div id="techTree" class="screen">
            <div class="header">
                <h1>ğŸ”¬ æŠ€è¡“é–‹ç™ºãƒ„ãƒªãƒ¼</h1>
                <p>ã‚«ãƒ¼ãƒ‰ã‚’çµ„ã¿åˆã‚ã›ã¦æ–°ã—ã„æŠ€è¡“ã‚’é–‹ç™ºã—ã‚ˆã†</p>
            </div>

            <div class="tech-tree">
                <div class="tech-level">
                    <h4>ğŸŒ± ãƒ¬ãƒ™ãƒ«1: åŸºæœ¬æŠ€è¡“</h4>
                    <div class="tech-item unlocked" onclick="researchTech('basic_recycling')">
                        <strong>åŸºæœ¬ãƒªã‚µã‚¤ã‚¯ãƒ«</strong>
                        <div>ãƒªã‚µã‚¤ã‚¯ãƒ«ç‡+20%</div>
                        <small>âœ… è§£æ”¾æ¸ˆã¿</small>
                    </div>
                    <div class="tech-item available" onclick="researchTech('solar_power')">
                        <strong>å¤ªé™½å…‰ç™ºé›»</strong>
                        <div>ã‚¨ãƒãƒ«ã‚®ãƒ¼+15% ç’°å¢ƒ+10%</div>
                        <small>ğŸ”“ è§£æ”¾å¯èƒ½</small>
                    </div>
                </div>

                <div class="tech-level">
                    <h4>ğŸš€ ãƒ¬ãƒ™ãƒ«2: é«˜åº¦æŠ€è¡“</h4>
                    <div class="tech-item" onclick="researchTech('smart_grid')">
                        <strong>ã‚¹ãƒãƒ¼ãƒˆã‚°ãƒªãƒƒãƒ‰</strong>
                        <div>ğŸ‡¯ğŸ‡µæ—¥æœ¬ + ğŸ‡©ğŸ‡ªãƒ‰ã‚¤ãƒ„ãŒå¿…è¦</div>
                        <small>ğŸ”’ ã‚«ãƒ¼ãƒ‰ä¸è¶³</small>
                    </div>
                    <div class="tech-item" onclick="researchTech('water_recycling')">
                        <strong>é«˜åº¦æ°´å¾ªç’°</strong>
                        <div>ğŸ‡¸ğŸ‡¬ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ« + ğŸ‡¯ğŸ‡µæ—¥æœ¬ãŒå¿…è¦</div>
                        <small>ğŸ”’ ã‚«ãƒ¼ãƒ‰ä¸è¶³</small>
                    </div>
                </div>

                <div class="tech-level">
                    <h4>ğŸŒŸ ãƒ¬ãƒ™ãƒ«3: æœªæ¥æŠ€è¡“</h4>
                    <div class="tech-item" onclick="researchTech('carbon_capture')">
                        <strong>äºŒé…¸åŒ–ç‚­ç´ å›å</strong>
                        <div>ã™ã¹ã¦ã®å›½ã®ã‚«ãƒ¼ãƒ‰ãŒå¿…è¦</div>
                        <small>ğŸ”’ æœªè§£æ”¾</small>
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="showScreen('cardCollection')">ğŸƒ ã‚«ãƒ¼ãƒ‰å›³é‘‘</button>
                <button class="btn btn-secondary" onclick="showScreen('achievements')">ğŸ† å®Ÿç¸¾</button>
            </div>
        </div>

        <!-- ARãƒ“ãƒ¥ãƒ¼ãƒ¯ãƒ¼ -->
        <div id="arView" class="screen">
            <div class="header">
                <h1>ğŸ‘ï¸ ARéƒ½å¸‚ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h1>
                <p>ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã‚’å‹•ã‹ã—ã¦éƒ½å¸‚ã‚’360åº¦è¦‹ã‚ˆã†</p>
            </div>

            <div class="ar-preview">
                <div class="ar-placeholder">
                    ğŸ“± ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã§è¡¨ç¤º
                </div>
                <p>ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã§ã“ã®ãƒšãƒ¼ã‚¸ã‚’é–‹ãã¨ã€ARæ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã™</p>
                <div class="cards-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0;">
                    <div class="card" onclick="placeARBuilding('solar')">
                        <div class="card-icon">â˜€ï¸</div>
                        <h4>å¤ªé™½å…‰ç™ºé›»æ‰€</h4>
                    </div>
                    <div class="card" onclick="placeARBuilding('wind')">
                        <div class="card-icon">ğŸŒ¬ï¸</div>
                        <h4>é¢¨åŠ›ç™ºé›»</h4>
                    </div>
                    <div class="card" onclick="placeARBuilding('recycling')">
                        <div class="card-icon">â™»ï¸</div>
                        <h4>ãƒªã‚µã‚¤ã‚¯ãƒ«æ–½è¨­</h4>
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="showScreen('cardCollection')">â† æˆ»ã‚‹</button>
                <button class="btn btn-ar" onclick="simulateAR()">ğŸ® ARã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ</button>
            </div>
        </div>

        <!-- å®Ÿç¸¾ç”»é¢ -->
        <div id="achievements" class="screen">
            <div class="header">
                <h1>ğŸ† å®Ÿç¸¾ã¨è¨˜éŒ²</h1>
                <p>ã‚ãªãŸã®SDGsã¸ã®è²¢çŒ®ã‚’ç§°ãˆã¾ã—ã‚‡ã†</p>
            </div>

            <div class="achievements-grid">
                <div class="achievement unlocked">
                    <div class="achievement-icon">ğŸŒ</div>
                    <div class="achievement-progress">
                        <strong>ä¸–ç•Œæ¢æ¤œå®¶</strong>
                        <div>3ã‚«å›½ã‚’è¨ªå•</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 60%"></div>
                        </div>
                        <small>5ã‚«å›½ã§é”æˆ</small>
                    </div>
                </div>

                <div class="achievement">
                    <div class="achievement-icon">ğŸ™ï¸</div>
                    <div class="achievement-progress">
                        <strong>éƒ½å¸‚è¨­è¨ˆå£«</strong>
                        <div>5ã¤ã®æ–½è¨­ã‚’å»ºè¨­</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 40%"></div>
                        </div>
                        <small>3/5 æ–½è¨­</small>
                    </div>
                </div>

                <div class="achievement unlocked">
                    <div class="achievement-icon">ğŸ”¬</div>
                    <div class="achievement-progress">
                        <strong>æŠ€è¡“é©æ–°è€…</strong>
                        <div>æœ€åˆã®æŠ€è¡“ã‚’é–‹ç™º</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 100%"></div>
                        </div>
                        <small>é”æˆæ¸ˆã¿ï¼</small>
                    </div>
                </div>

                <div class="achievement">
                    <div class="achievement-icon">ğŸ’š</div>
                    <div class="achievement-progress">
                        <strong>ç’°å¢ƒä¿è­·è€…</strong>
                        <div>ç’°å¢ƒæŒ‡æ¨™80%é”æˆ</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 65%"></div>
                        </div>
                        <small>ç¾åœ¨: 65%</small>
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="showScreen('techTree')">ğŸ”¬ æŠ€è¡“ãƒ„ãƒªãƒ¼</button>
                <button class="btn btn-secondary" onclick="showScreen('cardCollection')">ğŸƒ ã‚«ãƒ¼ãƒ‰å›³é‘‘</button>
            </div>
        </div>

        <!-- æ—¢å­˜ã®ç”»é¢ï¼ˆå›½é¸æŠã€éƒ½å¸‚å»ºè¨­ï¼‰ã¯å‰å›ã®ã‚³ãƒ¼ãƒ‰ã‚’çµ±åˆ -->
    </div>

    <script>
        // æ‹¡å¼µã‚²ãƒ¼ãƒ çŠ¶æ…‹
        const advancedGameState = {
            currentScreen: 'cardCollection',
            collectedCards: [
                { id: 'japan_recycling', country: 'japan', name: 'æ—¥æœ¬ã®ã”ã¿åˆ†åˆ¥', rarity: 'rare', description: 'é«˜åº¦ãªåˆ†åˆ¥æŠ€è¡“ã§ãƒªã‚µã‚¤ã‚¯ãƒ«ç‡å‘ä¸Š', unlocked: true, new: true },
                { id: 'germany_energy', country: 'germany', name: 'ãƒ‰ã‚¤ãƒ„ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼è»¢æ›', rarity: 'epic', description: 'å†ç”Ÿå¯èƒ½ã‚¨ãƒãƒ«ã‚®ãƒ¼æ¨é€²æ”¿ç­–', unlocked: true, new: false },
                { id: 'rwanda_plastic', country: 'rwanda', name: 'ãƒ«ãƒ¯ãƒ³ãƒ€ã®ãƒ—ãƒ©ã‚¹ãƒãƒƒã‚¯ç¦æ­¢', rarity: 'common', description: 'å³æ ¼ãªãƒ—ãƒ©ã‚¹ãƒãƒƒã‚¯è¦åˆ¶', unlocked: true, new: true },
                { id: 'singapore_water', country: 'singapore', name: 'ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ«ã®æ°´ç®¡ç†', rarity: 'rare', description: 'NEWaterã«ã‚ˆã‚‹æ°´ã®è‡ªçµ¦', unlocked: true, new: false },
                { id: 'norway_ev', country: 'norway', name: 'ãƒãƒ«ã‚¦ã‚§ãƒ¼ã®EVæ™®åŠ', rarity: 'epic', description: 'é›»æ°—è‡ªå‹•è»Šã®ç©æ¥µçš„å°å…¥', unlocked: true, new: true }
            ],
            researchedTechs: ['basic_recycling'],
            achievements: {
                countries_visited: 3,
                facilities_built: 3,
                techs_researched: 1,
                environment_score: 65
            },
            arBuildings: []
        };

        // åˆ©ç”¨å¯èƒ½ãªã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿
        const allCards = [
            // æ—¥æœ¬ã®ã‚«ãƒ¼ãƒ‰
            { id: 'japan_recycling', country: 'japan', name: 'æ—¥æœ¬ã®ã”ã¿åˆ†åˆ¥', rarity: 'rare', icon: 'ğŸ—‘ï¸', description: 'é«˜åº¦ãªåˆ†åˆ¥æŠ€è¡“ã§ãƒªã‚µã‚¤ã‚¯ãƒ«ç‡80%ã‚’é”æˆ' },
            { id: 'japan_disaster', country: 'japan', name: 'æ—¥æœ¬ã®é˜²ç½æŠ€è¡“', rarity: 'epic', icon: 'ğŸ¯', description: 'åœ°éœ‡å¯¾ç­–ã¨æ—©æœŸè­¦æˆ’ã‚·ã‚¹ãƒ†ãƒ ' },
            { id: 'japan_transit', country: 'japan', name: 'æ—¥æœ¬ã®å…¬å…±äº¤é€š', rarity: 'rare', icon: 'ğŸš†', description: 'ä¸–ç•Œæœ€é«˜ãƒ¬ãƒ™ãƒ«ã®é‰„é“ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯' },
            
            // ãƒ‰ã‚¤ãƒ„ã®ã‚«ãƒ¼ãƒ‰
            { id: 'germany_energy', country: 'germany', name: 'ã‚¨ãƒãƒ«ã‚®ãƒ¼è»¢æ›', rarity: 'epic', icon: 'âš¡', description: 'å†ç”Ÿå¯èƒ½ã‚¨ãƒãƒ«ã‚®ãƒ¼46%ã‚’é”æˆ' },
            { id: 'germany_recycling', country: 'germany', name: 'ãƒ‡ãƒã‚¸ãƒƒãƒˆåˆ¶åº¦', rarity: 'common', icon: 'â™»ï¸', description: 'å®¹å™¨ã®å›åç‡98%ã‚’å®Ÿç¾' },
            
            // ãƒ«ãƒ¯ãƒ³ãƒ€ã®ã‚«ãƒ¼ãƒ‰
            { id: 'rwanda_plastic', country: 'rwanda', name: 'ãƒ—ãƒ©ã‚¹ãƒãƒƒã‚¯ç¦æ­¢', rarity: 'common', icon: 'ğŸš«', description: '2008å¹´ã‚ˆã‚Šãƒ“ãƒ‹ãƒ¼ãƒ«è¢‹ã‚’å…¨é¢ç¦æ­¢' },
            { id: 'rwanda_clean', country: 'rwanda', name: 'æ¸…æ½”æ”¿ç­–', rarity: 'rare', icon: 'âœ¨', description: 'ã‚¢ãƒ•ãƒªã‚«ã§æœ€ã‚‚æ¸…æ½”ãªéƒ½å¸‚ã«' },
            
            // ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ«ã®ã‚«ãƒ¼ãƒ‰
            { id: 'singapore_water', country: 'singapore', name: 'NEWater', rarity: 'rare', icon: 'ğŸ’§', description: 'ä¸‹æ°´ã®é«˜åº¦å†ç”Ÿã§æ°´ã®40%ã‚’ä¾›çµ¦' },
            { id: 'singapore_green', country: 'singapore', name: 'ã‚¬ãƒ¼ãƒ‡ãƒ³ã‚·ãƒ†ã‚£', rarity: 'epic', icon: 'ğŸŒ¿', description: 'å›½åœŸã®47%ãŒç·‘åœ°' },
            
            // ãƒãƒ«ã‚¦ã‚§ãƒ¼ã®ã‚«ãƒ¼ãƒ‰
            { id: 'norway_ev', country: 'norway', name: 'EVé©å‘½', rarity: 'epic', icon: 'ğŸš—', description: 'æ–°è»Šè²©å£²ã®80%ãŒé›»æ°—è‡ªå‹•è»Š' },
            { id: 'norway_hydro', country: 'norway', name: 'æ°´åŠ›ç™ºé›»', rarity: 'rare', icon: 'ğŸ’¦', description: 'é›»åŠ›ã®95%ã‚’æ°´åŠ›ã§è³„ã†' }
        ];

        // ç”»é¢è¡¨ç¤º
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
            advancedGameState.currentScreen = screenId;
            
            if (screenId === 'cardCollection') {
                updateCardCollection();
            } else if (screenId === 'techTree') {
                updateTechTree();
            } else if (screenId === 'achievements') {
                updateAchievements();
            }
        }

        // ã‚«ãƒ¼ãƒ‰ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®æ›´æ–°
        function updateCardCollection() {
            const container = document.getElementById('cardsContainer');
            const totalCards = document.getElementById('totalCards');
            const completion = document.getElementById('completion');
            const score = document.getElementById('collectionScore');
            
            // ã‚«ãƒ¼ãƒ‰è¡¨ç¤º
            container.innerHTML = '';
            
            allCards.forEach(card => {
                const collected = advancedGameState.collectedCards.find(c => c.id === card.id);
                const cardElement = document.createElement('div');
                cardElement.className = `card ${collected ? '' : 'disabled'} ${collected?.new ? 'new' : ''}`;
                cardElement.innerHTML = `
                    <div class="card-rarity rarity-${card.rarity}">${getRarityText(card.rarity)}</div>
                    <div class="card-icon">${card.icon}</div>
                    <h3>${card.name}</h3>
                    <p>${card.description}</p>
                    <div style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">
                        ${collected ? 'âœ… æ‰€æŒæ¸ˆã¿' : 'ğŸ”’ æœªæ‰€æŒ'}
                    </div>
                `;
                
                if (collected) {
                    cardElement.onclick = () => showCardDetail(card);
                }
                
                container.appendChild(cardElement);
            });
            
            // çµ±è¨ˆæ›´æ–°
            const collectedCount = advancedGameState.collectedCards.length;
            totalCards.textContent = `${collectedCount}/${allCards.length}`;
            completion.textContent = `${Math.round((collectedCount / allCards.length) * 100)}%`;
            score.textContent = calculateCollectionScore();
        }

        function getRarityText(rarity) {
            const texts = { common: 'ãƒãƒ¼ãƒãƒ«', rare: 'ãƒ¬ã‚¢', epic: 'ã‚¨ãƒ”ãƒƒã‚¯', legendary: 'ãƒ¬ã‚¸ã‚§ãƒ³ãƒ‰' };
            return texts[rarity] || rarity;
        }

        function calculateCollectionScore() {
            const scores = { common: 10, rare: 30, epic: 100, legendary: 300 };
            return advancedGameState.collectedCards.reduce((score, card) => {
                return score + (scores[card.rarity] || 0);
            }, 0);
        }

        // ã‚«ãƒ¼ãƒ‰ã‚¿ãƒ–è¡¨ç¤º
        function showCardTab(country) {
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // ã“ã“ã§å›½åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚’å®Ÿè£…
            updateCardCollection(); // ç°¡æ˜“å®Ÿè£…
        }

        // æŠ€è¡“ç ”ç©¶
        function researchTech(techId) {
            const techElement = event.target.closest('.tech-item');
            if (techElement.classList.contains('available')) {
                advancedGameState.researchedTechs.push(techId);
                techElement.classList.remove('available');
                techElement.classList.add('unlocked');
                techElement.querySelector('small').textContent = 'âœ… ç ”ç©¶å®Œäº†';
                showNotification(`ğŸ”¬ æ–°ã—ã„æŠ€è¡“ã€Œ${getTechName(techId)}ã€ã‚’é–‹ç™ºã—ã¾ã—ãŸï¼`);
                updateAchievements();
            }
        }

        function getTechName(techId) {
            const names = {
                'basic_recycling': 'åŸºæœ¬ãƒªã‚µã‚¤ã‚¯ãƒ«',
                'solar_power': 'å¤ªé™½å…‰ç™ºé›»',
                'smart_grid': 'ã‚¹ãƒãƒ¼ãƒˆã‚°ãƒªãƒƒãƒ‰',
                'water_recycling': 'é«˜åº¦æ°´å¾ªç’°',
                'carbon_capture': 'äºŒé…¸åŒ–ç‚­ç´ å›å'
            };
            return names[techId] || techId;
        }

        // ARæ©Ÿèƒ½
        function placeARBuilding(type) {
            advancedGameState.arBuildings.push(type);
            showNotification(`ğŸ—ï¸ ARã§${getBuildingName(type)}ã‚’è¨­ç½®ã—ã¾ã—ãŸ`);
        }

        function getBuildingName(type) {
            const names = { solar: 'å¤ªé™½å…‰ç™ºé›»æ‰€', wind: 'é¢¨åŠ›ç™ºé›»', recycling: 'ãƒªã‚µã‚¤ã‚¯ãƒ«æ–½è¨­' };
            return names[type] || type;
        }

        function simulateAR() {
            showNotification('ğŸ® ARã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹... ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã§å®Ÿéš›ã®ARã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ï¼');
        }

        // å®Ÿç¸¾æ›´æ–°
        function updateAchievements() {
            // å®Ÿç¸¾é€²æ—ã‚’æ›´æ–°
            advancedGameState.achievements.techs_researched = advancedGameState.researchedTechs.length;
            // ã“ã“ã§å®Ÿç¸¾UIã‚’æ›´æ–°
        }

        // ã‚«ãƒ¼ãƒ‰è©³ç´°è¡¨ç¤º
        function showCardDetail(card) {
            showNotification(`ğŸƒ ${card.name}: ${card.description}`);
            // æ–°ã—ã„ãƒ•ãƒ©ã‚°ã‚’è§£é™¤
            const collectedCard = advancedGameState.collectedCards.find(c => c.id === card.id);
            if (collectedCard) {
                collectedCard.new = false;
            }
            updateCardCollection();
        }

        // æŠ€è¡“ãƒ„ãƒªãƒ¼æ›´æ–°
        function updateTechTree() {
            // æŠ€è¡“ãƒ„ãƒªãƒ¼ã®çŠ¶æ…‹ã‚’æ›´æ–°
            document.querySelectorAll('.tech-item').forEach(item => {
                const techId = item.getAttribute('onclick')?.match(/'(.*?)'/)?.[1];
                if (techId && advancedGameState.researchedTechs.includes(techId)) {
                    item.classList.remove('available');
                    item.classList.add('unlocked');
                    item.querySelector('small').textContent = 'âœ… ç ”ç©¶å®Œäº†';
                }
            });
        }

        // é€šçŸ¥æ©Ÿèƒ½
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }

        // åˆæœŸåŒ–
        window.onload = function() {
            updateCardCollection();
            showNotification('ğŸ‰ æ–°ã—ã„ã‚«ãƒ¼ãƒ‰ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸï¼');
        };
    </script>
</body>
</html>
